define("zenjs/util/number",[],function(){return{makeRandomString:function(t){var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";t=t||10;for(var n=0;n<t;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e}}}),define("bower_components/pop/pop",["require","zenjs/events","zenjs/util/number"],function(t){var e=function(){},i=t("zenjs/events"),n=t("zenjs/util/number");return window.zenjs=window.zenjs||{},i.extend({init:function(t){this._window=$(window);var i=n.makeRandomString();$("body").append('<div id="'+i+'"                 style="display:none; height: 100%;                 position: fixed; top: 0; left: 0; right: 0;                background-color: rgba(0, 0, 0, '+(t.transparent||".7")+');z-index:1000;opacity:0;transition: opacity ease 0.2s;"></div>'),this.nBg=$("#"+i),this.nBg.on("click",$.proxy(function(){this.isCanNotHide||this.hide()},this));var o=n.makeRandomString();$("body").append('<div id="'+o+'" class="'+(t.className||"")+'" style="overflow:hidden;visibility: hidden;"></div>'),this.nPopContainer=$("#"+o),this.nPopContainer.hide(),this.nPopContainer.css({opacity:0,position:"absolute","z-index":1e3}),t.contentViewClass&&(this.contentViewClass=t.contentViewClass,this.contentViewOptions=$.extend({el:this.nPopContainer},t.contentViewOptions||{}),this.contentView=new this.contentViewClass($.extend({onHide:$.proxy(this.hide,this)},this.contentViewOptions)),this.contentView.onHide=$.proxy(this.hide,this)),this.animationTime=t.animationTime||300,this.isCanNotHide=t.isCanNotHide,this.doNotRemoveOnHide=t.doNotRemoveOnHide||!1,this.onShow=t.onShow||e,this.onHide=t.onHide||e,this.onFinishHide=t.onFinishHide||e,this.html=t.html},render:function(t){return this.renderOptions=t||{},this.contentViewClass?this.contentView.render(this.renderOptions):this.html&&this.nPopContainer.html(this.html),this},show:function(){return this.nBg.show().css({opacity:"1","transition-property":"none"}),this.nPopContainer.show(),this.trigger("pop:show:before"),setTimeout($.proxy(function(){this.trigger("pop:show:after"),this.nPopContainer.show().css("visibility","visible"),this._doShow&&this._doShow(),this.onShow()},this),200),this},hide:function(t){t=t||{};var e=t.doNotRemove||this.doNotRemoveOnHide||!1;this._doHide&&this._doHide(),this.trigger("pop:hide:before"),setTimeout($.proxy(function(){this.nBg.css({opacity:0,"transition-property":"opacity"}),this.trigger("pop:hide:after"),setTimeout($.proxy(function(){this.nBg.hide(),this.nPopContainer.hide(),e||this.destroy()},this),200)},this),this.animationTime),this.onHide()},destroy:function(){return this.nPopContainer.remove(),this.nBg.remove(),this.contentView&&this.contentView.remove(),this}})}),define("bower_components/pop/pop_forbid_scroll",["require","./pop"],function(t){return window.zenjs=window.zenjs||{},t("./pop").extend({init:function(t){this._super(t),t.doNotForbidScroll||(this.on("pop:show:before",$.proxy(this.onBeforePopShow,this)),this.on("pop:show:after",$.proxy(this.onAfterPopShow,this)),this.on("pop:hide:after",$.proxy(this.onAfterPopHide,this)))},onBeforePopShow:function(){this.top=this._window.scrollTop()},onAfterPopShow:function(){this._window.scrollTop(0),this.startShow()},onAfterPopHide:function(){var t,e=function(i){if(t!==this._window.scrollTop()&&i>0)return this._window.scrollTop(t),void setTimeout($.proxy(e,this,i-1));setTimeout($.proxy(this.onFinishHide,this),50)};return function(){this.startHide(),t=this.top,this._window.scrollTop(t),$.proxy(e,this)(2),setTimeout($.proxy(function(){window.zenjs.popList.length<1&&$("html").css("position",this.htmlPosition)},this),200)}}(),startShow:function(){var t=window.zenjs.popList;if(t||(t=window.zenjs.popList=[]),0===t.length){var e=$("body"),i=$("html");this.htmlPosition=i.css("position"),i.css("position","relative"),this.bodyCss=(e.prop("style")||{}).cssText,this.htmlCss=(i.prop("style")||{}).cssText,$("body,html").css({overflow:"hidden",height:this._window.height(),"padding-bottom":0,"margin-bottom":0})}t.indexOf(this)<0&&t.push(this)},startHide:function(){var t=window.zenjs.popList,e=t.indexOf(this);e>-1&&t.splice(e,1),t.length<1&&($("html").attr("style",this.htmlCss||""),$("body").attr("style",this.bodyCss||""))}})}),define("bower_components/pop/popout",["require","./pop_forbid_scroll"],function(t){return t("./pop_forbid_scroll").extend({init:function(t){t=t||{},this._super(t),this.css=$.extend({transition:"opacity ease "+this.animationTime+"ms",top:"50%",left:"50%","-webkit-transform":"translate3d(-50%, -50%, 0)",transform:"translateY(-50%, -50%, 0)"},t.css||{}),this.nPopContainer.css(this.css)},_doShow:function(){$(".js-popout-close").click($.proxy(function(t){this.hide()},this)),this.nPopContainer.css("opacity",1),this.nPopContainer.show()},_doHide:function(t){this.nPopContainer.css({opacity:0})}})}),define("bower_components/pop/popout_box",["require","./popout"],function(t){var e=function(){};return t("./popout").extend({init:function(t){this._super(t),this._onOKClicked=t.onOKClicked||e,this._onCancelClicked=t.onCancelClicked||e,this.preventHideOnOkClicked=t.preventHideOnOkClicked||!1,this.width=t.width,this.setEventListener()},setEventListener:function(){this.nPopContainer.on("click",".js-ok",$.proxy(this.onOKClicked,this)),this.nPopContainer.on("click",".js-cancel",$.proxy(this.onCancelClicked,this))},_doShow:function(){this.boxCss={"border-radius":"4px",background:"white",width:this.width||"270px",padding:"15px"},this.nPopContainer.css(this.boxCss).addClass("popout-box"),this._super()},_doHide:function(t){this._super()},onOKClicked:function(t){this._onOKClicked(t),!this.preventHideOnOkClicked&&this.hide()},onCancelClicked:function(t){this._onCancelClicked(t),this.hide()}})}),define("bower_components/pop/popup",["require","./pop_forbid_scroll"],function(t){return t("./pop_forbid_scroll").extend({init:function(t){this._super(t),this.onClickBg=t.onClickBg||function(){},this.onBeforePopupShow=t.onBeforePopupShow||function(){},this.onAfterPopupHide=t.onAfterPopupHide||function(){},this.nPopContainer.css($.extend({left:0,right:0,bottom:0,background:"white"},t.containerCss||{})),this.nPopContainer.css("opacity","0"),this.nPopContainer.on("focus","input, textarea",function(t){var e=$(this),i=$(window),n=i.scrollTop(),o=e.offset().top;(o-n<0||o-n>100)&&setTimeout(function(){var t=o-70;i.scrollTop(t)},400)})},_doShow:function(){this.nPopContainer.addClass("popup"),this.contentView&&this.contentView.height?this.height=this.contentView.height():this.contentView||(this.height=this.nPopContainer.height()),this.onBeforePopupShow(),$(".js-close").click($.proxy(function(t){this.hide()},this)),this.nPopContainer.css({height:this.height+"px",transform:"translate3d(0,100%,0)","-webkit-transform":"translate3d(0,100%,0)"}),this.bodyPadding=$("body").css("padding"),$("body").css("padding","0px"),setTimeout($.proxy(function(){this.nPopContainer.css({transform:"translate3d(0,0,0)","-webkit-transform":"translate3d(0,0,0)","-webkit-transition":"all ease "+this.animationTime+"ms",transition:"all ease "+this.animationTime+"ms",opacity:1})},this)),setTimeout($.proxy(function(){this.contentView&&this.contentView.onAfterPopupShow&&this.contentView.onAfterPopupShow()},this),this.animationTime)},_doHide:function(t){this.nPopContainer.css({transform:"translate3d(0,100%,0)","-webkit-transform":"translate3d(0,100%,0)",opacity:0}),setTimeout($.proxy(function(){$("body").css("padding",this.bodyPadding),this.onAfterPopupHide()},this),this.animationTime)}})}),define("text!bower_components/pop/pop_alert/box.html",[],function(){return'<div class="alert-content font-size-14" style="line-height: 1.4; padding: 5px 0;">\n    <%= data.box_content %>\n</div>\n<hr style="margin: 10px 0 11px;">\n<p class="js-ok confirm center c-green" style="line-height: 22px;">\n    <%= data.box_confirm %>\n</p>'}),define("zenjs/util/template",["require","jquery"],function(t){var e=t("jquery"),i=function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},e=["&","<",">",'"',"'"],i=new RegExp("["+e.join("")+"]","g");return function(e){return null==e?"":(""+e).replace(i,function(e){return t[e]})}}(),n={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},o={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};return function(t,s,a){var r;a=e.extend({},n,a);var d=new RegExp([(a.escape||/(.)^/).source,(a.interpolate||/(.)^/).source,(a.evaluate||/(.)^/).source].join("|")+"|$","g"),c=0,h="__p+='";t.replace(d,function(e,i,n,s,a){return h+=t.slice(c,a).replace(/\\|'|\r|\n|\t|\u2028|\u2029/g,function(t){return"\\"+o[t]}),i&&(h+="'+\n((__t=("+i+"))==null?'':escapeFunc(__t))+\n'"),n&&(h+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),s&&(h+="';\n"+s+"\n__p+='"),c=a+e.length,e}),h+="';\n",a.variable||(h="with(obj||{}){\n"+h+"}\n"),h="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+h+"return __p;\n";try{r=new Function(a.variable||"obj","escapeFunc",h)}catch(t){throw t.source=h,t}if(s)return r(s,i);var l=function(t){return r.call(this,t,i)};return l.source="function("+(a.variable||"obj")+"){\n"+h+"}",l}}),define("bower_components/pop/pop_alert/popout_alert",["require","../popout_box","text!../pop_alert/box.html","zenjs/util/template"],function(t){var e=t("../popout_box"),i=t("text!../pop_alert/box.html"),n=t("zenjs/util/template"),o=n(i),s=e.extend({init:function(t){this._super(t),this.isCanNotHide=!0,this.box_content=t.content||"",this.box_confirm=t.confirmText||"我知道了"},render:function(t){return this.html||(this.html=o({data:{box_content:this.box_content,box_confirm:this.box_confirm}})),this._super(t),this.nPopContainer.addClass("popout-alert"),this},_doShow:function(){this._super()},_doHide:function(t){this._super()}}),a=null;return{show:function(t,e){e=e||{},a&&this.hide(),e.content=t,a=new s(e).render().show()},hide:function(){a&&(a.hide(),a=null)}}}),window.Utils=window.Utils||{},$.extend(window.Utils,{validMobile:function(t){return t=""+t,/^((\+86)|(86))?(1)\d{10}$/.test(t)},validPhone:function(t){return t=""+t,/^0[0-9\-]{10,13}$/.test(t)},validNumber:function(t){return/^\d+$/.test(t)},validHKPhone:function(t){return/^(5|6|8|9)\d{7}$/.test(t+"")},validTWPhone:function(t){return/^09\d{2}-?\d{3}-?\d{3}$/.test(t+"")},validEmail:function(t){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(t)},validPostalCode:function(t){return t=""+t,/^\d{6}$/.test(t)}}),define("wap/components/util/valid",function(){}),define("wap/pay/bank/add_card/add/models/card",["wap/components/util/valid","bower_components/pop/pop_alert/popout_alert"],function(t,e){var i=function(){};return Backbone.Model.extend({initialize:function(t){t=t||{}},ajax:function(t){t=t||{};var e=this.toJSON(),n=t.onSubmitBefore||i,o=t.onSubmitSuccess||i,s=t.onSubmitError||i,a=t.onSubmitComplete||i;this.isValid()&&$._ajax({url:"/v2/pay/Umpay/reqSmsVerifyByCardInfo.json",type:"POST",dataType:"json",data:e,beforeSend:function(){n()},success:function(t){var e=t.code,i=t.msg,n=t.data;if(0==e)return void o(n,e,t);s(i,n,t)},complete:function(){a()}})},isValid:function(){var t=function(t){return t.card_id&&t.card_type&&t.trade_no?"credit"!=t.card_type||t.valid_date?"credit"!=t.card_type||t.cvv2?t.card_holder?t.identity_code?!!t.media_id||(motify.log("请填写手机号码"),!1):(motify.log("请填写身份证号码"),!1):(motify.log("请填写持卡人姓名"),!1):(motify.log("请填写安全码"),!1):(motify.log("请填写有效期"),!1):(motify.log("银行卡信息错误"),!1)};return function(){var e=this.toJSON();if(!t(e))return!1;if("credit"==e.card_type){var i=/^(\d{2})\/(\d{2})$/.exec(e.valid_date);if(!i)return motify.log("有效期格式错误"),!1;var n=+i[1],o=+i[2];if(!(n>0&&n<13&&o>0&&o<100))return motify.log("有效期格式错误"),!1;if(!/^\d{3}$/.test(e.cvv2))return motify.log("安全码格式错误"),!1}return/^\d{17}\S{1}$/.test(e.identity_code)?!(!window.Utils.validMobile(e.media_id)&&!window.Utils.validPhone(e.media_id))||(motify.log("请填写正确的手机号码"),!1):(motify.log("请填写正确的身份证号码"),!1)}}()})}),define("text!wap/pay/bank/add_card/add/templates/sms_fetch.html",[],function(){return'<div class="header">\n\t<h2 class="center c-black font-size-16">输入短信验证码</h2>\t\n</div>\n<div class="content wrapper-form">\n\t<div class="form-item">\n        <label for="">验证码</label>\t\n        <input type="text" class="js-code-input" maxlength="6">\n        <button class="js-send-btn tag btn-auth-code tag-green font-size-12">获取验证码</button>\n    </div>\n    <p class="sms-tips font-size-12 c-gray-darker">验证码已发送到银行预留手机：<%= data.media_id %></p>\n</div>\n<div class="action-container">\n\t<div class="btn-2-1">\n\t\t<button class="btn btn-green js-confirm font-size-14" disabled="disabled">确认支付</button>\n\t</div>\n\t<div class="btn-2-1">\n\t\t<button class="btn js-cancel font-size-14">取消</button>\n\t</div>\n</div>'}),define("wap/pay/bank/add_card/add/views/sms_fetch",["zenjs/events","text!wap/pay/bank/add_card/add/templates/sms_fetch.html","zenjs/util/template"],function(t,e,i){var n=i(e);return t.extend({init:function(t){t=t||{},this.$el=$(t.el),this.el=this.$el[0],this.$=function(t){return this.$el.find(t)},this.postData=t.postData||{},this.step=1100,this.setListening()},setListening:function(){this.$el.append(n({data:this.postData})),this.$el.on("click",".js-send-btn",$.proxy(this.onSendBtnClick,this)),this.$el.on("click",".js-confirm",$.proxy(this.onSubmit,this));var t=function(){setTimeout($.proxy(function(){this.onCodeInputChange()||t.call(this)},this),1e3)};t.call(this)},render:function(){this.nCodeInput=this.$(".js-code-input"),this.nSendBtn=this.$(".js-send-btn"),this.nConfirm=this.$(".js-confirm"),this.nSendBtn.attr("disabled","disabled").addClass("disabled"),this.btnCountdown(60)},onSendBtnClick:function(t){this.nSendBtn.attr("disabled","disabled").addClass("disabled"),this.btnCountdown(60),$._ajax({url:"/v2/pay/Umpay/reqSmsVerifyByCardInfo.json",type:"POST",dataType:"json",data:this.postData})},onSubmit:function(t){var e=this;if(t.preventDefault(),!this.submiting){var i=this.nCodeInput.val();if(!/^\d{4}$/g.test(i))return motify.log("验证码错误"),!1;$._ajax({url:"/v2/pay/Umpay/confirmSmsVerifyByCardInfo.json",type:"POST",dataType:"json",data:$.extend({},this.postData,{verify_code:i}),beforeSend:function(){e.submiting=!0,e.nConfirm.attr("disabled","disabled")},success:function(t){var e=t.code,i=t.data||{},n=t.msg;if(0==e)return motify.log("支付成功，页面跳转中",0),void setTimeout(function(){location.href=i.url},800);motify.log(n)},complete:function(){e.submiting=!1,e.nConfirm.removeAttr("disabled")}})}},btnCountdown:function(t){var e=this;this.onTimeChange({second:t}),--t>=0?this.timer=setTimeout(function(){e.btnCountdown(t)},this.step):(this.onTimeEnd(),this.timer="")},onTimeChange:function(t){var e=t.second;this.nSendBtn.html("重新获取("+e+")")},onTimeEnd:function(){this.nSendBtn.removeAttr("disabled").removeClass("disabled").html("获取验证码")},onCodeInputChange:function(t){return this.nCodeInput.val().length>1&&(this.nConfirm.removeAttr("disabled"),!0)},remove:function(){this.$el.remove()}})}),define("zenjs/util/event",["require","jquery"],function(t){var e=t("jquery"),i={getTargetByDataKey:function(t,i){for(var n=e(t.target);!n.data(i)&&0!==n.data(i)&&"BODY"!=(n[0]||{}).nodeName;)n=n.parent();return n},getEventHandler:function(){var t=function(){};return e.extend(!0,t.prototype,i.methods),new t},methods:{events:{},on:function(t,e){return"string"==typeof t&&"[object Function]"===Object.prototype.toString.call(e)&&(this.events[t]||(this.events[t]=[]),this.events[t].push(e))},trigger:function(t){if("string"!=typeof t)return!1;if(!this.events[t])return this.events[t]=[],!1;for(var e=this.events[t],i=Array.prototype.slice.apply(arguments,[1]),n=0,o=e.length;n<o;n++)e[n](i)},off:function(t,e){if(!t&&!e)return void(this.events={});if(!e)return void(this.events[t]=[]);var i=this.events[t],n=i.indexOf(e);i.splice(n,1)}}};return i}),define("zenjs/backbone/tabber",["require","../util/event","backbone"],function(t){var e=t("../util/event"),i=t("backbone"),n=function(){};return i.View.extend({initialize:function(t){this.activeKey=t.activeKey||"type",this.activeClass=t.activeClass||"active",this.hashAsDefaultData=!!t.hashAsDefaultData,this.cbOnClicked=t.onClicked||n,this.cbOnDisabledClicked=t.onDisabledClicked||n,this.initDefault(t)},events:{click:"onClicked"},initDefault:function(t){var e=i.history.getHash();t.hashAsDefaultData&&e?this.active(e):t.defaultData&&t.defaultData.length>0&&this.active(t.defaultData)},onClicked:function(t){if(t.target&&0!==t.target.length){var i=e.getTargetByDataKey(t,this.activeKey),n=""+i.data(this.activeKey);if(void 0===this.firstClick?this.firstClick=!0:this.firstClick=!1,i.blur(),n&&"undefined"!==n&&this.activeData!==n&&n&&n.length>0){if(this.disabled===!0)return void(this.activeData!==n&&this.cbOnDisabledClicked());if(this.hashAsDefaultData){var o=location.href.replace(/(javascript:|#).*$/,"");location.replace(o+"#"+n)}this.$("."+this.activeClass).removeClass(this.activeClass),i.addClass(this.activeClass),this.activeData=n,this.cbOnClicked(_.extend(t||{},{value:n,nTarget:i}))}}},active:function(t,e){this.onClicked(_.extend({target:this.$el.find("[data-"+this.activeKey+'="'+t+'"]:first')},e||{}))},setDisable:function(t){this.disabled=t},setData:function(t){this.activeData=t,this.$("."+this.activeClass).removeClass(this.activeClass),this.$el.find("[data-"+this.activeKey+'="'+this.activeData+'"]:first').addClass(this.activeClass)},getData:function(){return this.activeData}})}),define("zenjs/backbone/base_view",["require","backbone","../core/trigger_method"],function(t){var e=t("backbone"),i=t("../core/trigger_method");return e.View.extend({clean:function(){return this.stopListening(),this},triggerMethod:i})}),define("bower_components/zenlist/list",["require","exports","module","zenjs/backbone/base_view"],function(t,e,i){var n=function(){},o=t("zenjs/backbone/base_view");i.exports=o.extend({initialize:function(t){return this.options=t=t||{},this.items=[],this.itemView=t.itemView,this.itemOptions=t.itemOptions||{},this.collection=t.collection,this.onAfterListChange=t.onAfterListChange||n,this.onAfterListLoad=t.onAfterListLoad||n,this.onAfterListDisplay=t.onAfterListDisplay||n,this.onListEmpty=t.onListEmpty||t.onEmptyList||this._onListEmpty,this.onItemClick=t.onItemClick||n,this.onViewItemAdded=t.onViewItemAdded||n,this.displaySize=t.displaySize||-1,this.emptyHTML=t.emptyHTML||"",this.emptyText=t.emptyText||"列表为空",this},render:function(t){return this.displaySize=(t||{}).displaySize==-1?-1:this.displaySize,this.clean(),this._setupListeners(),this.addAll(),this.onAfterListDisplay({list:this.collection}),this},fetchRender:function(t){return this.collection.fetch({data:t,success:_(function(t,e){this.render(),this.onAfterListLoad(this.collection,e),this.onFetchSuccess&&this.onFetchSuccess()}).bind(this),error:_.bind(function(){this.onAfterListLoad(this.collection,response)},this)}),this},_setupListeners:function(){this.collection&&(this.stopListening(this.collection),this.listenTo(this.collection,"add",this.addItem,this),this.listenTo(this.collection,"reset sort",this.render,this),this.listenTo(this.collection,"remove",this.onItemRemoved,this))},addItemListeners:function(t){var e=this;this.listenTo(t,"all",function(){var e="item:"+arguments[0],i=_.toArray(arguments);i.splice(0,1),i.unshift(e,t),this.trigger.apply(this,i),"item:click"==e&&this.onItemClick()}),this.listenTo(t.model,"change",function(){e.onAfterListChange({list:this.collection})})},addAll:function(){0===this.collection.length?this.fetching||this.triggerMethod("list:empty"):this.collection.each(function(t){this.addItem(t)},this)},removeAll:function(){for(var t=this.items.length-1;t>=0;t--)this.removeView(this.items[t]);this.onAfterListChange({list:this.collection})},addItem:function(t,e,i){if(!(this.displaySize>=0&&this.items.length>=this.displaySize)){1==this.collection.length&&(this.listEl||this.$el).html("");var n=new this.itemView(_.extend({},this.options.itemOptions,{model:t,index:this.collection.indexOf(t)}));this.items.push(n),this.addItemListeners(n),n.render(),this.onViewItemAdded({list:this.items,viewItem:n,model:t});return 0===(i||{}).at?(this.listEl||this.$el).prepend(n.el):(this.listEl||this.$el).append(n.el),n}},removeItem:function(t){var e=this.getViewByModel(t);e&&this.removeView(e)},removeView:function(t){var e;this.stopListening(t),t&&(this.stopListening(t.model),t.remove(),e=this.items.indexOf(t),this.items.splice(e,1)),0===this.collection.length&&(this.fetching||this.triggerMethod("list:empty"))},onItemRemoved:function(t){this.onAfterListChange({list:this.collection,action:"remove",model:t}),this.removeItem(t)},getViewByModel:function(t){return _.find(this.items,function(e,i){return e.model===t})},dispatchEventToAllViews:function(t,e){for(var i=this.items.length-1;i>=0;i--)this.items[i].trigger(t,e)},remove:function(){o.prototype.remove.call(this,arguments),this.removeAll(),this.collection.reset(),delete this.collection},clean:function(){o.prototype.clean.call(this,arguments),this.removeAll(),(this.listEl||this.$el).html(""),this.stopListening(this.collection)},_onListEmpty:function(){this.$el.html(this.emptyHTML||(this.emptyText?'<p style="text-align:center;line-height:60px;">'+this.emptyText+"</p>":""))}})}),define("text!wap/pay/bank/add_card/add/templates/bankItem.html",[],function(){return'<span class="bank-sprite pull-left bank-<%= data.abbreviation %>"></span>\n<p class="bank-item-info"><%= data.name %></p>\n\n'}),define("wap/pay/bank/add_card/add/views/bank_item",["text!wap/pay/bank/add_card/add/templates/bankItem.html"],function(t){var e=function(){},i=_.template(t);return Backbone.View.extend({initialize:function(t){this.onBankTypeChange=t.onBankTypeChange||e},className:"block-item",events:{click:"onClick"},render:function(){this.$el.html(i({data:this.model.toJSON()}))},onClick:function(t){this.onBankTypeChange({name:this.model.get("name"),abbreviation:this.model.get("abbreviation")})}})}),define("wap/pay/bank/add_card/add/collections/bankList",[],function(){return Backbone.Collection.extend({})}),define("text!wap/pay/bank/add_card/add/templates/bankSelContainer.html",[],function(){return'<div class="js-tabber tabber tabber-n2 tabber-bottom green clearfix">\n\t<a href="javascript:;" data-type="credit">信用卡</a>\n\t<a href="javascript:;" data-type="debit">储蓄卡</a>\n</div>\n<div class="js-bank-list">\n\t<div class="js-part-list block-bank-sel block block-list hide" data-type="credit">\n\t</div>\n\t<div class="js-part-list block-bank-sel no-margin-top block block-list hide" data-type="debit">\n\t</div>\n</div>'}),define("wap/pay/bank/add_card/add/views/bank_sel",["zenjs/events","zenjs/backbone/tabber","bower_components/zenlist/list","wap/pay/bank/add_card/add/views/bank_item","wap/pay/bank/add_card/add/collections/bankList","text!wap/pay/bank/add_card/add/templates/bankSelContainer.html"],function(t,e,i,n,o,s){var a=function(){};return Backbone.View.extend({initialize:function(t){t=t||{},this.onBankTypeChange=t.onBankTypeChange||a,this.allCardInfo=t.allCardInfo||{},this.bankList={},this.hide=t.onHide||a},events:{},render:function(t){this.$el.append(s),this.nTabberContainer=this.$(".js-tabber"),this.nListContainer=this.$(".js-bank-list"),this.tabber=new e({el:this.nTabberContainer,activeClass:"active",activeKey:"type",defaultData:"credit",onClicked:_(this.onTabberClicked).bind(this)})},onTabberClicked:function(t){var e=t.value,s=this;this.activeType=e,this.bankList[e]||(this.bankList[e]=new i({el:this.nListContainer.find("[data-type="+e+"]"),itemView:n,itemOptions:{onBankTypeChange:function(t){t=t||{},t.card_type=s.activeType,t.card_type_name="credit"==t.card_type?"信用卡":"储蓄卡",s.onBankTypeChange(t),s.hide()}},collection:new o(this.allCardInfo[e])}).render()),this.activeList&&this.activeList.$el.addClass("hide"),this.activeList=this.bankList[e],this.activeList.$el.removeClass("hide")}})}),define("text!wap/pay/bank/add_card/add/templates/expireIntro.html",[],function(){return'\n<div class="header">\n\t<h2 class="center c-black font-size-16">有效期说明</h2>\t\n</div>\n<div class="content">\n\t<p class="info-pic info-pic-expire"></p>\n\t<p class="font-size-14 line-height-20">有效期位于信用卡正面卡号的下方，标准格式为月份在前，年份在后的一串数字</p>\n</div>'}),define("text!wap/pay/bank/add_card/add/templates/safecodeIntro.html",[],function(){return'<div class="header">\n\t<h2 class="center c-black font-size-16">安全码说明</h2>\t\n</div>\n<div class="content">\n\t<p class="info-pic info-pic-safecode"></p>\n\t<p class="font-size-14 line-height-20">安全码是信用卡背面的最后三位数字</p>\n</div>'}),define("text!wap/pay/bank/add_card/add/templates/phoneIntro.html",[],function(){return'<div class="header">\n\t<h2 class="center c-black font-size-16">手机号说明</h2>\t\n</div>\n<div class="content">\n\t<p class="font-size-14 line-height-20">银行预留的手机号是办理该银行卡时所填写的手机号码。</p>\n\t<br>\n\t<p class="font-size-14 line-height-20">没有预留、手机号忘记或者已停用，请联系银行客服更新处理。</p>\n</div>'}),window.Zepto&&function(t){t.fn.serializeArray=function(){var e,i,n=[],o=function(t){if(t.forEach)return t.forEach(o);n.push({name:e,value:t})};return this[0]&&t.each(this[0].elements,function(n,s){i=s.type,e=s.name,e&&"fieldset"!=s.nodeName.toLowerCase()&&!s.disabled&&"submit"!=i&&"reset"!=i&&"button"!=i&&"file"!=i&&("radio"!=i&&"checkbox"!=i||s.checked)&&o(t(s).val())}),n},t.fn.serialize=function(){var t=[];return this.serializeArray().forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))}),t.join("&")},t.fn.submit=function(e){if(0 in arguments)this.bind("submit",e);else if(this.length){var i=t.Event("submit");this.eq(0).trigger(i),i.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),define("vendor/zepto/form",function(){}),window.Utils=window.Utils||{},define("wap/components/util/form",["vendor/zepto/form"],function(t){window.Utils.getFormData=function(t){var e=t.serializeArray(),i={};return $.map(e,function(t){i[t.name]=t.value}),i}}),require(["zenjs/events","bower_components/pop/popout_box","bower_components/pop/popup","bower_components/pop/pop_alert/popout_alert","wap/pay/bank/add_card/add/models/card","wap/pay/bank/add_card/add/views/sms_fetch","wap/pay/bank/add_card/add/views/bank_sel","text!wap/pay/bank/add_card/add/templates/expireIntro.html","text!wap/pay/bank/add_card/add/templates/safecodeIntro.html","text!wap/pay/bank/add_card/add/templates/phoneIntro.html","wap/components/util/form"],function(t,e,i,n,o,s,a,r,d,c,h){new(t.extend({init:function(t){var e=this;this.$el=$(t.el),this.el=this.$el[0],this.trade_no=window._global.trade_no,this.order_no=window._global.order_no,this.card_id=window._global.card.card_id,this.card_type=window._global.card.card_type,this.bank_name=window._global.card.bank_name,this.abbreviation=window._global.card.abbreviation,this.card_type_name=window._global.card.card_type_name,this.cardModel=new o,this.nExpireTime=this.$el.find(".js-expire-time"),this.setListening(),this.nSubmit=this.$el.find(".js-submit");var e=this;$._ajax({url:"/v2/pay/umpay/bankInfo.json",type:"GET",dataType:"json",success:function(t){0==t.code&&(e.allCardInfo=t.data||{})},complete:function(){e.$el.find(".js-sel-type").addClass("active")}})},setListening:function(){this.$el.on("input",".js-expire-time",$.proxy(this.onExpireTimeKeyUp,this)),this.$el.on("click",".js-info-help",$.proxy(this.onShowInfoHelp,this)),this.$el.on("click",".js-sel-type.active",$.proxy(this.onSelectTypeClick,this)),this.$el.on("click",".js-submit",$.proxy(this.onSubmit,this))},onExpireTimeKeyUp:function(){var t=0;return function(e){var i=this.nExpireTime.val();if(i.length<t)return void(t=i.length);this.expireTime=i.replace(/[\sa-zA-Z\/]/g,"");var n=this.expireTime.replace(/^\d{2}(?=\d*|$)/g,function(t){return t+"/"});t=n.length,this.nExpireTime.val(n);var o=this.nExpireTime[0];"ios"!=window._global.mobile_system&&o.setSelectionRange&&setTimeout(function(){o.setSelectionRange(t,t)},0)}}(),onShowInfoHelp:function(){var t={expiretime:r,safecode:d,phone:c};return function(e){var i=$(e.target),o=i.data("type"),s=t[o]||"";n.show(s)}}(),onSubmit:function(t){var i=this,o={};this.submiting||($.extend(o,window.Utils.getFormData($(".js-form"))),o.card_id=this.card_id,o.card_type=this.card_type,o.bank_name=this.bank_name,o.abbreviation=this.abbreviation,o.card_type_name=this.card_type_name,o.trade_no=this.trade_no,this.cardModel.set(o),this.cardModel.ajax({onSubmitBefore:function(){i.submiting=!0,i.nSubmit.attr("disabled","disabled")},onSubmitSuccess:function(t,n,o){new e({contentViewClass:s,className:"sms-fetch",isCanNotHide:!0,contentViewOptions:{postData:i.cardModel.toJSON()}}).render().show()},onSubmitError:function(t,e,i){n.show(t)},onSubmitComplete:function(){i.submiting=!1,i.nSubmit.removeAttr("disabled")}}))},onSelectTypeClick:function(t){var e=this;new i({contentViewClass:a,contentViewOptions:{allCardInfo:this.allCardInfo,onBankTypeChange:function(t){e.card_type=t.card_type,e.bank_name=t.name,e.abbreviation=t.abbreviation,e.card_type_name=t.card_type_name,e.$el.find(".js-sel-type").html(e.bank_name+" "+e.card_type_name),"credit"==e.card_type?e.$el.find(".js-credit-value-field").removeClass("hide"):e.$el.find(".js-credit-value-field").addClass("hide")}},containerCss:{bottom:0,left:0,right:0,background:"white"}}).render().show()}}))({el:$("body")})}),define("main",function(){});