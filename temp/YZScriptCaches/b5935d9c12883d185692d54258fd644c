define("zenjs/util/event",["require","jquery"],function(t){var e=t("jquery"),i={getTargetByDataKey:function(t,i){for(var a=e(t.target);!a.data(i)&&0!==a.data(i)&&"BODY"!=(a[0]||{}).nodeName;)a=a.parent();return a},getEventHandler:function(){var t=function(){};return e.extend(!0,t.prototype,i.methods),new t},methods:{events:{},on:function(t,e){return"string"==typeof t&&"[object Function]"===Object.prototype.toString.call(e)&&(this.events[t]||(this.events[t]=[]),this.events[t].push(e))},trigger:function(t){if("string"!=typeof t)return!1;if(!this.events[t])return this.events[t]=[],!1;for(var e=this.events[t],i=Array.prototype.slice.apply(arguments,[1]),a=0,s=e.length;a<s;a++)e[a](i)},off:function(t,e){if(!t&&!e)return void(this.events={});if(!e)return void(this.events[t]=[]);var i=this.events[t],a=i.indexOf(e);i.splice(a,1)}}};return i}),define("zenjs/backbone/tabber",["require","../util/event","backbone"],function(t){var e=t("../util/event"),i=t("backbone"),a=function(){};return i.View.extend({initialize:function(t){this.activeKey=t.activeKey||"type",this.activeClass=t.activeClass||"active",this.hashAsDefaultData=!!t.hashAsDefaultData,this.cbOnClicked=t.onClicked||a,this.cbOnDisabledClicked=t.onDisabledClicked||a,this.initDefault(t)},events:{click:"onClicked"},initDefault:function(t){var e=i.history.getHash();t.hashAsDefaultData&&e?this.active(e):t.defaultData&&t.defaultData.length>0&&this.active(t.defaultData)},onClicked:function(t){if(t.target&&0!==t.target.length){var i=e.getTargetByDataKey(t,this.activeKey),a=""+i.data(this.activeKey);if(void 0===this.firstClick?this.firstClick=!0:this.firstClick=!1,i.blur(),a&&"undefined"!==a&&this.activeData!==a&&a&&a.length>0){if(this.disabled===!0)return void(this.activeData!==a&&this.cbOnDisabledClicked());if(this.hashAsDefaultData){var s=location.href.replace(/(javascript:|#).*$/,"");location.replace(s+"#"+a)}this.$("."+this.activeClass).removeClass(this.activeClass),i.addClass(this.activeClass),this.activeData=a,this.cbOnClicked(_.extend(t||{},{value:a,nTarget:i}))}}},active:function(t,e){this.onClicked(_.extend({target:this.$el.find("[data-"+this.activeKey+'="'+t+'"]:first')},e||{}))},setDisable:function(t){this.disabled=t},setData:function(t){this.activeData=t,this.$("."+this.activeClass).removeClass(this.activeClass),this.$el.find("[data-"+this.activeKey+'="'+this.activeData+'"]:first').addClass(this.activeClass)},getData:function(){return this.activeData}})}),require(["zenjs/backbone/tabber"],function(t){var e=window._global,i=$(".js-submit"),a=new t({el:$(".js-type-selector"),defaultData:"gift"}).render();i.click(function(){var t=this,s=$(".js-gift-message").val().trim();return 0===s.length?void motify.log("说点什么吧？"):s.length>80?void motify.log("留言太长啦"):void(t.ajaxing||$._ajax({url:e.message_url,type:"POST",dataType:"json",timeout:5e3,data:{gift_message:s,order_no:e.order_no,kdt_id:e.kdt_id,success_rate:"gift"==a.getData()?1e4:e.rand_success_rate},beforeSend:function(){t.ajaxing=!0,i.html("提交中..")},success:function(a){if(0===a.code)return void(window.location.href=e.share_url);motify.log(a.msg),t.ajaxing=!1,i.html("把礼物放进盒子")},error:function(e,a,s){t.ajaxing=!1,i.html("把礼物放进盒子")}}))})}),define("main",function(){});