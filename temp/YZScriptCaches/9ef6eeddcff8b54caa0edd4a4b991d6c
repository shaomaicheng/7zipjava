define("zenjs/util/number",[],function(){return{makeRandomString:function(t){var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";t=t||10;for(var i=0;i<t;i++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}}}),define("bower_components/pop/pop",["require","zenjs/events","zenjs/util/number"],function(t){var e=function(){},n=t("zenjs/events"),i=t("zenjs/util/number");return window.zenjs=window.zenjs||{},n.extend({init:function(t){this._window=$(window);var n=i.makeRandomString();$("body").append('<div id="'+n+'"                 style="display:none; height: 100%;                 position: fixed; top: 0; left: 0; right: 0;                background-color: rgba(0, 0, 0, '+(t.transparent||".7")+');z-index:1000;opacity:0;transition: opacity ease 0.2s;"></div>'),this.nBg=$("#"+n),this.nBg.on("click",$.proxy(function(){this.isCanNotHide||this.hide()},this));var o=i.makeRandomString();$("body").append('<div id="'+o+'" class="'+(t.className||"")+'" style="overflow:hidden;visibility: hidden;"></div>'),this.nPopContainer=$("#"+o),this.nPopContainer.hide(),this.nPopContainer.css({opacity:0,position:"absolute","z-index":1e3}),t.contentViewClass&&(this.contentViewClass=t.contentViewClass,this.contentViewOptions=$.extend({el:this.nPopContainer},t.contentViewOptions||{}),this.contentView=new this.contentViewClass($.extend({onHide:$.proxy(this.hide,this)},this.contentViewOptions)),this.contentView.onHide=$.proxy(this.hide,this)),this.animationTime=t.animationTime||300,this.isCanNotHide=t.isCanNotHide,this.doNotRemoveOnHide=t.doNotRemoveOnHide||!1,this.onShow=t.onShow||e,this.onHide=t.onHide||e,this.onFinishHide=t.onFinishHide||e,this.html=t.html},render:function(t){return this.renderOptions=t||{},this.contentViewClass?this.contentView.render(this.renderOptions):this.html&&this.nPopContainer.html(this.html),this},show:function(){return this.nBg.show().css({opacity:"1","transition-property":"none"}),this.nPopContainer.show(),this.trigger("pop:show:before"),setTimeout($.proxy(function(){this.trigger("pop:show:after"),this.nPopContainer.show().css("visibility","visible"),this._doShow&&this._doShow(),this.onShow()},this),200),this},hide:function(t){t=t||{};var e=t.doNotRemove||this.doNotRemoveOnHide||!1;this._doHide&&this._doHide(),this.trigger("pop:hide:before"),setTimeout($.proxy(function(){this.nBg.css({opacity:0,"transition-property":"opacity"}),this.trigger("pop:hide:after"),setTimeout($.proxy(function(){this.nBg.hide(),this.nPopContainer.hide(),e||this.destroy()},this),200)},this),this.animationTime),this.onHide()},destroy:function(){return this.nPopContainer.remove(),this.nBg.remove(),this.contentView&&this.contentView.remove(),this}})}),define("wap/components/loading",["bower_components/pop/pop"],function(t){var e,n=t.extend({init:function(t){t=t||{},this._super(t),this.css={position:"fixed",opacity:1,top:"50%",left:"50%","-webkit-transform":"translate3d(-50%, -50%, 0)",transform:"translateY(-50%, -50%, 0)"},this.nPopContainer.css(this.css)}});return{show:function(t){t=t||"处理中",e&&this.hide(),e=new n({html:'<div class="loader-container"><div class="loader center">'+t+"</div></div>",isCanNotHide:!0,transparent:".6"}).render().show()},hide:function(){e&&e.hide(),e=null}}}),window.Zepto&&function(t){t.fn.serializeArray=function(){var e,n,i=[],o=function(t){if(t.forEach)return t.forEach(o);i.push({name:e,value:t})};return this[0]&&t.each(this[0].elements,function(i,s){n=s.type,e=s.name,e&&"fieldset"!=s.nodeName.toLowerCase()&&!s.disabled&&"submit"!=n&&"reset"!=n&&"button"!=n&&"file"!=n&&("radio"!=n&&"checkbox"!=n||s.checked)&&o(t(s).val())}),i},t.fn.serialize=function(){var t=[];return this.serializeArray().forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))}),t.join("&")},t.fn.submit=function(e){if(0 in arguments)this.bind("submit",e);else if(this.length){var n=t.Event("submit");this.eq(0).trigger(n),n.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),define("vendor/zepto/form",function(){}),window.Utils=window.Utils||{},define("wap/components/util/form",["vendor/zepto/form"],function(t){window.Utils.getFormData=function(t){var e=t.serializeArray(),n={};return $.map(e,function(t){n[t.name]=t.value}),n}}),define("bower_components/pop/pop_forbid_scroll",["require","./pop"],function(t){return window.zenjs=window.zenjs||{},t("./pop").extend({init:function(t){this._super(t),t.doNotForbidScroll||(this.on("pop:show:before",$.proxy(this.onBeforePopShow,this)),this.on("pop:show:after",$.proxy(this.onAfterPopShow,this)),this.on("pop:hide:after",$.proxy(this.onAfterPopHide,this)))},onBeforePopShow:function(){this.top=this._window.scrollTop()},onAfterPopShow:function(){this._window.scrollTop(0),this.startShow()},onAfterPopHide:function(){var t,e=function(n){if(t!==this._window.scrollTop()&&n>0)return this._window.scrollTop(t),void setTimeout($.proxy(e,this,n-1));setTimeout($.proxy(this.onFinishHide,this),50)};return function(){this.startHide(),t=this.top,this._window.scrollTop(t),$.proxy(e,this)(2),setTimeout($.proxy(function(){window.zenjs.popList.length<1&&$("html").css("position",this.htmlPosition)},this),200)}}(),startShow:function(){var t=window.zenjs.popList;if(t||(t=window.zenjs.popList=[]),0===t.length){var e=$("body"),n=$("html");this.htmlPosition=n.css("position"),n.css("position","relative"),this.bodyCss=(e.prop("style")||{}).cssText,this.htmlCss=(n.prop("style")||{}).cssText,$("body,html").css({overflow:"hidden",height:this._window.height(),"padding-bottom":0,"margin-bottom":0})}t.indexOf(this)<0&&t.push(this)},startHide:function(){var t=window.zenjs.popList,e=t.indexOf(this);e>-1&&t.splice(e,1),t.length<1&&($("html").attr("style",this.htmlCss||""),$("body").attr("style",this.bodyCss||""))}})}),define("bower_components/pop/popout",["require","./pop_forbid_scroll"],function(t){return t("./pop_forbid_scroll").extend({init:function(t){t=t||{},this._super(t),this.css=$.extend({transition:"opacity ease "+this.animationTime+"ms",top:"50%",left:"50%","-webkit-transform":"translate3d(-50%, -50%, 0)",transform:"translateY(-50%, -50%, 0)"},t.css||{}),this.nPopContainer.css(this.css)},_doShow:function(){$(".js-popout-close").click($.proxy(function(t){this.hide()},this)),this.nPopContainer.css("opacity",1),this.nPopContainer.show()},_doHide:function(t){this.nPopContainer.css({opacity:0})}})}),define("bower_components/pop/popout_box",["require","./popout"],function(t){var e=function(){};return t("./popout").extend({init:function(t){this._super(t),this._onOKClicked=t.onOKClicked||e,this._onCancelClicked=t.onCancelClicked||e,this.preventHideOnOkClicked=t.preventHideOnOkClicked||!1,this.width=t.width,this.setEventListener()},setEventListener:function(){this.nPopContainer.on("click",".js-ok",$.proxy(this.onOKClicked,this)),this.nPopContainer.on("click",".js-cancel",$.proxy(this.onCancelClicked,this))},_doShow:function(){this.boxCss={"border-radius":"4px",background:"white",width:this.width||"270px",padding:"15px"},this.nPopContainer.css(this.boxCss).addClass("popout-box"),this._super()},_doHide:function(t){this._super()},onOKClicked:function(t){this._onOKClicked(t),!this.preventHideOnOkClicked&&this.hide()},onCancelClicked:function(t){this._onCancelClicked(t),this.hide()}})}),define("text!bower_components/pop/pop_alert/box.html",[],function(){return'<div class="alert-content font-size-14" style="line-height: 1.4; padding: 5px 0;">\n    <%= data.box_content %>\n</div>\n<hr style="margin: 10px 0 11px;">\n<p class="js-ok confirm center c-green" style="line-height: 22px;">\n    <%= data.box_confirm %>\n</p>'}),define("zenjs/util/template",["require","jquery"],function(t){var e=t("jquery"),n=function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},e=["&","<",">",'"',"'"],n=new RegExp("["+e.join("")+"]","g");return function(e){return null==e?"":(""+e).replace(n,function(e){return t[e]})}}(),i={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},o={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};return function(t,s,r){var a;r=e.extend({},i,r);var d=new RegExp([(r.escape||/(.)^/).source,(r.interpolate||/(.)^/).source,(r.evaluate||/(.)^/).source].join("|")+"|$","g"),c=0,p="__p+='";t.replace(d,function(e,n,i,s,r){return p+=t.slice(c,r).replace(/\\|'|\r|\n|\t|\u2028|\u2029/g,function(t){return"\\"+o[t]}),n&&(p+="'+\n((__t=("+n+"))==null?'':escapeFunc(__t))+\n'"),i&&(p+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),s&&(p+="';\n"+s+"\n__p+='"),c=r+e.length,e}),p+="';\n",r.variable||(p="with(obj||{}){\n"+p+"}\n"),p="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+p+"return __p;\n";try{a=new Function(r.variable||"obj","escapeFunc",p)}catch(t){throw t.source=p,t}if(s)return a(s,n);var h=function(t){return a.call(this,t,n)};return h.source="function("+(r.variable||"obj")+"){\n"+p+"}",h}}),define("bower_components/pop/pop_alert/popout_alert",["require","../popout_box","text!../pop_alert/box.html","zenjs/util/template"],function(t){var e=t("../popout_box"),n=t("text!../pop_alert/box.html"),i=t("zenjs/util/template"),o=i(n),s=e.extend({init:function(t){this._super(t),this.isCanNotHide=!0,this.box_content=t.content||"",this.box_confirm=t.confirmText||"我知道了"},render:function(t){return this.html||(this.html=o({data:{box_content:this.box_content,box_confirm:this.box_confirm}})),this._super(t),this.nPopContainer.addClass("popout-alert"),this},_doShow:function(){this._super()},_doHide:function(t){this._super()}}),r=null;return{show:function(t,e){e=e||{},r&&this.hide(),e.content=t,r=new s(e).render().show()},hide:function(){r&&(r.hide(),r=null)}}}),define("bower_components/pop/popout_box_ios",["require","./popout_box"],function(t){return t("./popout_box").extend({_doShow:function(){this.boxCss={"border-radius":"4px",background:"white",width:this.width||"290px",padding:"15px 0 0"},this.nPopContainer.css(this.boxCss).addClass("popout-box-ios"),$(".js-popout-close").click($.proxy(function(t){this.hide()},this)),this.nPopContainer.css("opacity",1),this.nPopContainer.show()}})}),define("text!wap/pay/yeepay/add_card/add/templates/expireIntro.html",[],function(){return'\n<div class="header">\n\t<h2 class="center c-black font-size-16">有效期说明</h2>\t\n</div>\n<div class="content">\n\t<p class="info-pic info-pic-expire"></p>\n\t<p class="font-size-14 line-height-20">有效期位于信用卡正面卡号的下方，标准格式为月份在前，年份在后的一串数字</p>\n</div>'}),define("text!wap/pay/yeepay/add_card/add/templates/failIntro.html",[],function(){return'\n<div class="content c-gray-dark font-size-14">\n    <div>网络不给力，获取支付结果失败，你可返回订单页查看支付结果，或重新连接</div>\n</div>\n<div class="action-container">\n    <button class="js-cancel btn c-black font-size-16">返回</button>\n    <button class="js-ok btn c-green font-size-16">重新连接</button>\n</div>'}),define("text!wap/pay/yeepay/add_card/add/templates/safecodeIntro.html",[],function(){return'<div class="header">\n\t<h2 class="center c-black font-size-16">安全码说明</h2>\t\n</div>\n<div class="content">\n\t<p class="info-pic info-pic-safecode"></p>\n\t<p class="font-size-14 line-height-20">安全码是信用卡背面的最后三位数字</p>\n</div>'}),require(["zenjs/util/args","wap/components/loading","wap/components/util/form","bower_components/pop/pop_alert/popout_alert","bower_components/pop/popout_box_ios","text!wap/pay/yeepay/add_card/add/templates/expireIntro.html","text!wap/pay/yeepay/add_card/add/templates/failIntro.html","text!wap/pay/yeepay/add_card/add/templates/safecodeIntro.html"],function(t,e,n,i,o,s,r,a){var d=!1,c=window._global.confirm,p=$(".js-vertify-code-btn"),h=$(".js-btn-pay"),l=function t(e){e>0?(p.attr("disabled","disabled"),p.text("重新发送("+e+"秒)"),setTimeout(function(){t(e-1)},1e3)):(p.removeAttr("disabled"),p.text(p.data("text")))},u=function(t){if(t&&0!==t.length){window._global.infoArr=t;var e=$(".info-hint"),n=!1;f(["block-item-card_holder","block-item-identity_code"],t)&&(n=!0),f(["block-item-valid_date","block-item-cvv2"],t)&&(n=!0),n&&e.removeClass("hide")}},f=function(t,e){var n={"block-item-card_holder":"owner","block-item-identity_code":"idcard","block-item-valid_date":"validthru","block-item-cvv2":"cvv2"},i=!1;for(var o in t){var s=t[o],r=$("."+s),a=r.closest(".block");e.indexOf(n[s])!==-1?(r.removeClass("hide"),i=!0):r.siblings(".block-item").css("border-top","0")}return i&&a.removeClass("hide"),i},m=function(){var t=0,e=$(".js-expire-time");return function(n){var i=e.val();if(i.length<t)return void(t=i.length);this.expireTime=i.replace(/[\sa-zA-Z\/]/g,"");var o=this.expireTime.replace(/^\d{2}(?=\d*|$)/g,function(t){return t+"/"});t=o.length,e.val(o);var s=e[0];"ios"!=window._global.mobile_system&&s.setSelectionRange&&setTimeout(function(){s.setSelectionRange(t,t)},0)}}(),w=function(){var t=1;return function(){d||"disabled"==p.attr("disabled")||$._ajax({url:c.sendSmsUrl,type:"POST",dataType:"json",timeout:5e3,data:{trade_no:c.tradeNo,bind:c.bindId,verfityTimes:t++,media_id:c.phone},beforeSend:function(){d=!0,p.text("正在发送").attr("disabled","disabled")},success:function(t){0==t.code?l(60):(motify.log(t.msg),p.text("发送验证码").removeAttr("disabled"))},error:function(t,e,n){},complete:function(t,e){d=!1}})}}(),b=function(){var t=$(".js-verify-code").val().trim();if(!t||0==t.length)return void motify.log("请输入验证码");var n={trade_no:c.tradeNo,bind_id:c.bindId,real_pay:c.real_pay,verify_code:t,media_id:c.phone};$.extend(n,window.Utils.getFormData($(".js-form")));var i=window._global.infoArr;if(i.indexOf("owner")!==-1&&!n.card_holder)return motify.log("请填写持卡人姓名"),!1;if(i.indexOf("idcard")!==-1&&!n.identity_code)return motify.log("填写身份证号码"),!1;if(i.indexOf("validthru")!==-1&&!n.valid_date)return motify.log("请填写有效期"),!1;if(i.indexOf("cvv2")!==-1&&!n.cvv2)return motify.log("请填写安全码"),!1;var o=$(".js-expire-time").attr("name"),s=n[o];n[o]=s.replace("/",""),d||$._ajax({url:c.agreeConfirmUrl,type:"POST",dataType:"json",timeout:5e3,data:n,beforeSend:function(){d=!0,h.attr("disabled","disabled"),h.html("正在努力加载，请稍等..."),e.show()},success:function(t){0==t.code?setTimeout(_,3e3):(e.hide(),motify.log(t.msg))},error:function(t,e,n){},complete:function(t,e){d=!1,setTimeout(function(){h.removeAttr("disabled"),h.html("确定支付")},2e3)}})},_=function(){$._ajax({url:_global.url.trade+"/v2/pay/yeepay/paystatus.json",type:"GET",dataType:"json",timeout:3e3,data:{trade_no:c.tradeNo},beforeSend:function(){d=!0},success:function(t){var n=t.code,i=t.data,s=t.msg,a=i.pay_status;0===n?"success"===a?window.location.href=i.url:"fail"===a?(e.hide(),motify.log(i.msg||"支付失败")):"unknown"===a&&(e.hide(),new o({isCanNotHide:!0,html:r,onOKClicked:_,onCancelClicked:function(){setTimeout(function(){window.location.href=i.url},0)}}).render().show()):(e.hide(),motify.log(s||"支付失败"))},error:function(t,e,n){},complete:function(t,e){d=!1}})},v=function(){var t={expiretime:s,safecode:a};return function(e){var n=$(e.target),o=n.data("type"),s=t[o]||"";i.show(s)}}();$(".btn-vertify-code-response-area").click(w),$(".js-btn-pay").click(b),$(".js-info-help").click(v),$(".js-expire-time").on("input",m),function(){d||$._ajax({url:c.cardBindPayUrl,type:"POST",dataType:"json",timeout:5e3,data:{trade_no:c.tradeNo,bind_id:c.bindId},beforeSend:function(){d=!0,motify.log("正在发送支付申请，请稍等...")},success:function(t){0==t.code?(d=!1,u(t.data),w()):motify.log(t.msg)},error:function(t,e,n){},complete:function(t,e){d=!1}})}()}),define("main",function(){});