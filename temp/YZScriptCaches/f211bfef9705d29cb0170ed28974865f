define("zenjs/util/number",[],function(){return{makeRandomString:function(t){var i="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";t=t||10;for(var n=0;n<t;n++)i+=e.charAt(Math.floor(Math.random()*e.length));return i}}}),define("bower_components/pop/pop",["require","zenjs/events","zenjs/util/number"],function(t){var i=function(){},e=t("zenjs/events"),n=t("zenjs/util/number");return window.zenjs=window.zenjs||{},e.extend({init:function(t){this._window=$(window);var e=n.makeRandomString();$("body").append('<div id="'+e+'"                 style="display:none; height: 100%;                 position: fixed; top: 0; left: 0; right: 0;                background-color: rgba(0, 0, 0, '+(t.transparent||".7")+');z-index:1000;opacity:0;transition: opacity ease 0.2s;"></div>'),this.nBg=$("#"+e),this.nBg.on("click",$.proxy(function(){this.isCanNotHide||this.hide()},this));var o=n.makeRandomString();$("body").append('<div id="'+o+'" class="'+(t.className||"")+'" style="overflow:hidden;visibility: hidden;"></div>'),this.nPopContainer=$("#"+o),this.nPopContainer.hide(),this.nPopContainer.css({opacity:0,position:"absolute","z-index":1e3}),t.contentViewClass&&(this.contentViewClass=t.contentViewClass,this.contentViewOptions=$.extend({el:this.nPopContainer},t.contentViewOptions||{}),this.contentView=new this.contentViewClass($.extend({onHide:$.proxy(this.hide,this)},this.contentViewOptions)),this.contentView.onHide=$.proxy(this.hide,this)),this.animationTime=t.animationTime||300,this.isCanNotHide=t.isCanNotHide,this.doNotRemoveOnHide=t.doNotRemoveOnHide||!1,this.onShow=t.onShow||i,this.onHide=t.onHide||i,this.onFinishHide=t.onFinishHide||i,this.html=t.html},render:function(t){return this.renderOptions=t||{},this.contentViewClass?this.contentView.render(this.renderOptions):this.html&&this.nPopContainer.html(this.html),this},show:function(){return this.nBg.show().css({opacity:"1","transition-property":"none"}),this.nPopContainer.show(),this.trigger("pop:show:before"),setTimeout($.proxy(function(){this.trigger("pop:show:after"),this.nPopContainer.show().css("visibility","visible"),this._doShow&&this._doShow(),this.onShow()},this),200),this},hide:function(t){t=t||{};var i=t.doNotRemove||this.doNotRemoveOnHide||!1;this._doHide&&this._doHide(),this.trigger("pop:hide:before"),setTimeout($.proxy(function(){this.nBg.css({opacity:0,"transition-property":"opacity"}),this.trigger("pop:hide:after"),setTimeout($.proxy(function(){this.nBg.hide(),this.nPopContainer.hide(),i||this.destroy()},this),200)},this),this.animationTime),this.onHide()},destroy:function(){return this.nPopContainer.remove(),this.nBg.remove(),this.contentView&&this.contentView.remove(),this}})}),define("bower_components/pop/pop_forbid_scroll",["require","./pop"],function(t){return window.zenjs=window.zenjs||{},t("./pop").extend({init:function(t){this._super(t),t.doNotForbidScroll||(this.on("pop:show:before",$.proxy(this.onBeforePopShow,this)),this.on("pop:show:after",$.proxy(this.onAfterPopShow,this)),this.on("pop:hide:after",$.proxy(this.onAfterPopHide,this)))},onBeforePopShow:function(){this.top=this._window.scrollTop()},onAfterPopShow:function(){this._window.scrollTop(0),this.startShow()},onAfterPopHide:function(){var t,i=function(e){if(t!==this._window.scrollTop()&&e>0)return this._window.scrollTop(t),void setTimeout($.proxy(i,this,e-1));setTimeout($.proxy(this.onFinishHide,this),50)};return function(){this.startHide(),t=this.top,this._window.scrollTop(t),$.proxy(i,this)(2),setTimeout($.proxy(function(){window.zenjs.popList.length<1&&$("html").css("position",this.htmlPosition)},this),200)}}(),startShow:function(){var t=window.zenjs.popList;if(t||(t=window.zenjs.popList=[]),0===t.length){var i=$("body"),e=$("html");this.htmlPosition=e.css("position"),e.css("position","relative"),this.bodyCss=(i.prop("style")||{}).cssText,this.htmlCss=(e.prop("style")||{}).cssText,$("body,html").css({overflow:"hidden",height:this._window.height(),"padding-bottom":0,"margin-bottom":0})}t.indexOf(this)<0&&t.push(this)},startHide:function(){var t=window.zenjs.popList,i=t.indexOf(this);i>-1&&t.splice(i,1),t.length<1&&($("html").attr("style",this.htmlCss||""),$("body").attr("style",this.bodyCss||""))}})}),define("bower_components/pop/popup",["require","./pop_forbid_scroll"],function(t){return t("./pop_forbid_scroll").extend({init:function(t){this._super(t),this.onClickBg=t.onClickBg||function(){},this.onBeforePopupShow=t.onBeforePopupShow||function(){},this.onAfterPopupHide=t.onAfterPopupHide||function(){},this.nPopContainer.css($.extend({left:0,right:0,bottom:0,background:"white"},t.containerCss||{})),this.nPopContainer.css("opacity","0"),this.nPopContainer.on("focus","input, textarea",function(t){var i=$(this),e=$(window),n=e.scrollTop(),o=i.offset().top;(o-n<0||o-n>100)&&setTimeout(function(){var t=o-70;e.scrollTop(t)},400)})},_doShow:function(){this.nPopContainer.addClass("popup"),this.contentView&&this.contentView.height?this.height=this.contentView.height():this.contentView||(this.height=this.nPopContainer.height()),this.onBeforePopupShow(),$(".js-close").click($.proxy(function(t){this.hide()},this)),this.nPopContainer.css({height:this.height+"px",transform:"translate3d(0,100%,0)","-webkit-transform":"translate3d(0,100%,0)"}),this.bodyPadding=$("body").css("padding"),$("body").css("padding","0px"),setTimeout($.proxy(function(){this.nPopContainer.css({transform:"translate3d(0,0,0)","-webkit-transform":"translate3d(0,0,0)","-webkit-transition":"all ease "+this.animationTime+"ms",transition:"all ease "+this.animationTime+"ms",opacity:1})},this)),setTimeout($.proxy(function(){this.contentView&&this.contentView.onAfterPopupShow&&this.contentView.onAfterPopupShow()},this),this.animationTime)},_doHide:function(t){this.nPopContainer.css({transform:"translate3d(0,100%,0)","-webkit-transform":"translate3d(0,100%,0)",opacity:0}),setTimeout($.proxy(function(){$("body").css("padding",this.bodyPadding),this.onAfterPopupHide()},this),this.animationTime)}})}),define("text!wap/trade/reviews/comment/templates/add_comment.html",[],function(){return'<div class="top-title clearfix">\n\t<span class="js-cancel pull-left">取消</span>\n\t<span class="js-submit pull-right c-blue">发送</span>\n\t<p class="title center font-size-18">评论</p>\n</div>\n<div class="comment-detail">\n\t<textarea name="comment-text" class="js-comment-detail comment-text" placeholder=""></textarea>\n</div>'}),define("wap/trade/reviews/comment/views/add_comment",["require","zenjs/util/ua","text!wap/trade/reviews/comment/templates/add_comment.html"],function(t){var i=t("zenjs/util/ua"),e=t("text!wap/trade/reviews/comment/templates/add_comment.html"),n=function(){};i.isIOS();return Backbone.View.extend({initialize:function(t){this._hide=t.onHide||n,this.onCommentSuccess=t.onCommentSuccess||n,this.review_id=window._global.review_id},events:{"click .js-cancel":"onCancelClick","click .js-submit":"onSubmitClick"},render:function(t){return this.$el.append(_.template(e)({})),this.nTextarea=this.$(".js-comment-detail"),this.nTextareaResponse=this.$(".js-comment-detail-response"),this},setCommentId:function(t,i){this.commentId=t,this.commentName=i;var e=this.commentName?"回复 "+this.commentName+" :":"我有话要说";this.nTextarea&&this.nTextarea.attr("placeholder",e)},onCancelClick:function(t){this._hide&&this._hide()},onSubmitClick:function(t){var i=this;if(!this.commentSubmiting){var e=this.nTextarea.val();if(!$.trim(e))return void motify.log("说点什么吧");$._ajax({url:"/v2/trade/reviews/comment.json",type:"POST",dataType:"json",data:{comment:e,comment_id:this.commentId,review_id:this.review_id},beforeSend:function(){i.commentSubmiting=!0},success:function(t){var e=+t.code;return 10020==e?void motify.log(t.msg):0!=e?void motify.log(t.msg):(motify.log("评论成功"),void i.onCommentSuccess())},error:function(){motify.log("评论失败")},complete:function(){i.commentSubmiting=!1,i.nTextarea.val(""),i._hide&&i._hide()}})}}})}),define("wap/trade/reviews/comment/views/like",[],function(){var t=function(){};return Backbone.View.extend({events:{"click .js-review-like":"onLikeClick"},initialize:function(i){this.urlMap=i.urlMap||{},this.postData=i.postData||{},this.beforeLike=i.beforeLike||t},onLikeClick:function(t){var i=this,e=this.$(".js-review-like"),n=e.hasClass("active")?"dislike":"like",o=+i.$(".js-like-num").text();this.likeAjaxing||(i.beforeLike(),$._ajax({url:this.urlMap[n],type:"POST",dataType:"json",data:this.postData,beforeSend:function(){i.likeAjaxing=!0},success:function(t){if(0!=t.code)return void motify.log(t.msg);e.removeClass("active"),"like"==n?(e.addClass("active").data("title","喜欢"),i.$(".js-like-num").text(o+1)):(e.data("title","不喜欢"),i.$(".js-like-num").text(o-1))},complete:function(){i.likeAjaxing=!1}}))}})}),define("bower_components/waterfall/pager",["require","zenjs/events"],function(t){var i=t("zenjs/events"),e=function(){};return i.extend({init:function(t){this.$el||(this.$el=$(t.el||t.$el||"<div></div>"),this.el=this.$el[0]),this.nLoading=t.loadingHTML?$(t.loadingHTML).addClass("loading-more"):$('<div class="loading-more"><span></span></div>'),this.nList=this.$el.find(".js-list"),0===this.nList.length&&(this.nList=$('<div class="js-list b-list"></div>'),this.$el.append(this.nList)),"number"==typeof t.total&&(this.total=t.total),this.offset=t.offset||300,this.scrollDirection="down",this.pageIndex=t.pageIndex||0,this.perPage=t.perPage||10,this.postData=t.postData||{},this.checkSize=!0,"boolean"==typeof t.checkSize&&(this.checkSize=t.checkSize),this.idName=t.idName||"id",t.idValue&&(this.idValue=t.idValue),this.jsonKeys=t.jsonKeys||{},this.finishedHTML=t.finishedHTML,this.finishedText=t.finishedText,this.emptyHTML=t.emptyHTML||"",this.emptyText=t.emptyText||"",this.getExtrPostData=t.getExtrPostData||e,this.onFetchError=t.onFetchError||e,this.onListEmpty=this.onListEmpty||t.onEmpty||this._onListEmpty,this.on("finished",t.onFinished||e),this.on("after:list:load",t.onAfterListLoad||t.onDataLoad||e),this.extraData={},this.scrollContainer=t.scrollContainer?$(t.scrollContainer):$("body"),this.scrollEventAccepter=t.scrollEventAccepter?$(t.scrollEventAccepter):$(t.scrollContainer||window),this._onScroll=$.proxy(this.onScroll,this),this.bindScrollFunc()},$:function(t){return this.$el.find(t)},onScroll:function(){function t(){var t=this.nList.offset(),i=this.scrollContainer.offset();return{left:t.left-i.left||0,top:t.top-i.top||0}}return function(){if(!(this.sleeping||this.finished||this.fetching)){if(0===this.total||this.total&&this.total<=this.pageIndex*this.perPage)return void this.doFinishLoading();var i=t.call(this);"down"===this.scrollDirection&&this.nList.height()+i.top-this.scrollEventAccepter.height()-this.scrollContainer.scrollTop()<this.offset&&this.fetchMore&&this.fetchMore(),"up"===this.scrollDirection&&this.scrollContainer.scrollTop()<this.offset&&this.fetchMore&&this.fetchMore()}}}(),fetchMore:function(){return this.sleeping||this.finished||this.fetching?this:(this.showLoading(),this.fetching=!0,this._fetchMore&&this._fetchMore.call(this),this)},onFetchMoreSuccess:function(){this.hideLoading(),this.fetching=!1,this._onFetchMoreSuccess.apply(this,arguments)},fetchRender:function(){return this.fetchMore(),this},_onFetchMoreError:function(){this.fetching=!1,this.hideLoading(),this.onFetchError()},doFinishLoading:function(t){this.finished=!0,this.fetching=!1,this.hideLoading(),this.$el.find(".list-finished").remove(),this.triggerMethod&&this.triggerMethod("finished",this.collection,t)},bindScrollFunc:function(){var t=this;this.scrollFunc&&this.unbindScrollFunc(),this.scrollFunc=function(){t.scrollTimeout&&clearTimeout(t.scrollTimeout),t.scrollTimeout=setTimeout(t._onScroll,200)},this.scrollEventAccepter.on("scroll",this.scrollFunc)},unbindScrollFunc:function(){this.scrollEventAccepter.off("scroll",this.scrollFunc),this.scrollFunc=null},doSleep:function(){this.sleeping=!0,this.unbindScrollFunc()},doWake:function(){this.sleeping=!1,this.bindScrollFunc(),this.fetchMore()},showLoading:function(){this.hasFetching=!0,this.$el.append(this.nLoading)},hideLoading:function(){this.nLoading.remove()},getFinishHtml:function(){return this.finishedHTML?$(this.finishedHTML).addClass("list-finished"):'<div class="list-finished">'+(this.finishedText||"已经没有更多了")+"</div>"},setExtraData:function(t){$.extend(this.extraData,t)},resetWaterfall:function(t){this.finished===!0&&this.$(".list-finished").remove(),this.removeAll&&this.removeAll(),this.nList.empty(),this.collection&&this.collection.reset([],{silent:!0}),this.listEl&&this.listEl.empty(),this.finished=!1,t&&t.pageIndex?this.pageIndex=t.pageIndex:this.pageIndex=0,this.idValue=void 0},_onListEmpty:function(){if(!this.fetching){var t;this.emptyHTML?t=$(this.emptyHTML).addClass("list-finished"):this.emptyText&&(t='<div class="list-finished">'+this.emptyText+"</div>"),this.$el.append(t)}},destroy:function(){this.doSleep(),this.$el.remove(),this.unbindScrollFunc()},remove:function(){this.destroy()}})}),define("bower_components/waterfall/waterfall_html",["require","bower_components/ajax/ajax","jquery","./pager"],function(t){t("bower_components/ajax/ajax");var i=t("jquery"),e=t("./pager");return e.extend({init:function(t){this.$el&&this.$el.find(".list-finished")&&this.$el.find(".list-finished").length>0||(this._super(t),void 0!==t.pageIndex?this.pageIndex=+t.pageIndex:this.pageIndex=1,this.url=t.url||"",this.ajaxType=t.ajaxType||"GET",this.dataType=t.dataType||"json",this.on("finished",this._doFinishLoading),this.onScroll())},_fetchMore:function(){var t=this,e={};this.perPage&&(e[this.jsonKeys.perPage||"perpage"]=this.perPage),this.idValue?e[this.idName]=this.idValue:e[this.jsonKeys.pageIndex||"page"]=this.pageIndex+1;var n=this.getExtrPostData?this.getExtrPostData():{};i._ajax({url:t.url,type:t.ajaxType,dataType:t.dataType,data:i.extend({},t.postData,e,n,t.extraData),timeout:5e3,success:function(i){t.pageIndex++,i&&0==i.code?t.onFetchMoreSuccess({},i||{}):t.doFinishLoading(i)},error:function(i,e,n){t._onFetchMoreError()}})},_onFetchMoreSuccess:function(t,i){var e=(i||{}).data||{};if(e[this.idName]&&(this.idValue=e[this.idName]),this.triggerMethod("after:list:load",e.html||"",i),!e.html)return this.pageIndex--,void this.doFinishLoading(i);this.onScroll()},_doFinishLoading:function(){if(0==this.pageIndex&&this.triggerMethod("list:empty"),this.hasFetching&&this.pageIndex>2){var t=this.getFinishHtml();this.$el.append(t)}}})}),define("bower_components/pop/popout",["require","./pop_forbid_scroll"],function(t){return t("./pop_forbid_scroll").extend({init:function(t){t=t||{},this._super(t),this.css=$.extend({transition:"opacity ease "+this.animationTime+"ms",top:"50%",left:"50%","-webkit-transform":"translate3d(-50%, -50%, 0)",transform:"translateY(-50%, -50%, 0)"},t.css||{}),this.nPopContainer.css(this.css)},_doShow:function(){$(".js-popout-close").click($.proxy(function(t){this.hide()},this)),this.nPopContainer.css("opacity",1),this.nPopContainer.show()},_doHide:function(t){this.nPopContainer.css({opacity:0})}})}),define("bower_components/pop/popout_box",["require","./popout"],function(t){var i=function(){};return t("./popout").extend({init:function(t){this._super(t),this._onOKClicked=t.onOKClicked||i,this._onCancelClicked=t.onCancelClicked||i,this.preventHideOnOkClicked=t.preventHideOnOkClicked||!1,this.width=t.width,this.setEventListener()},setEventListener:function(){this.nPopContainer.on("click",".js-ok",$.proxy(this.onOKClicked,this)),this.nPopContainer.on("click",".js-cancel",$.proxy(this.onCancelClicked,this))},_doShow:function(){this.boxCss={"border-radius":"4px",background:"white",width:this.width||"270px",padding:"15px"},this.nPopContainer.css(this.boxCss).addClass("popout-box"),this._super()},_doHide:function(t){this._super()},onOKClicked:function(t){this._onOKClicked(t),!this.preventHideOnOkClicked&&this.hide()},onCancelClicked:function(t){this._onCancelClicked(t),this.hide()}})}),define("text!wap/trade/reviews/comment/templates/review_success.html",[],function(){return'<div class="header center">\n    <h2>已成功评论</h2>\n</div>\n<p class="content c-black font-size-14"><%= (function(){\n    if( is_weixin ){\n        if( is_open_review ){\n            return \'你的使用心得对朋友购买有很大的帮助哦，快给他们看看吧～\';\n        }\n        return \'由于卖家关闭显示功能，评价仅卖家可见。你可以分享给好友来查看哦～\';\n    }\n\n    if( !is_open_review ){\n        return \'由于卖家关闭评价显示功能，你的评价仅卖家可见哦～\';\n    }\n    if( has_all_reviewed ){\n        return \'评价已提交，你的使用心得对购买的朋友有很大的帮助哦\';\n    }\n    return \'评价已提交，该订单所有商品你已全部评价。继续看看更多好货吧～\';\n})() %></p>\n<div class="pop-action-container clearfix">\n    <% if( is_weixin ){ %>\n        <button class="js-ok pull-left btn-2-1 btn btn-green font-size-14">分享给好友</button>\n        <% if( has_all_reviewed ){ %>\n            <a href="<%= window._global.wap_url.wap + \'/showcase/homepage?kdt_id=\' + kdt_id %>" class="pull-right btn-2-1 btn btn-white font-size-14">再逛逛</a>\n        <% }else{ %>\n            <a href="<%= window._global.wap_url.wap + \'/trade/reviews/readyReviewsList?order_no=\' + order_no + \'&kdt_id=\' + kdt_id %>" class="pull-right btn-2-1 btn btn-white font-size-14">继续评价</a>\n        <% } %>\n    <% } else { %>\n        <% if( has_all_reviewed ){ %>\n            <a href="<%= window._global.wap_url.wap + \'/showcase/homepage?kdt_id=\' + kdt_id %>" class="pull-right btn btn-white btn-block font-size-14">再逛逛</a>\n        <% }else{ %>\n            <a href="<%= window._global.wap_url.wap + \'/trade/reviews/readyReviewsList?order_no=\' + order_no + \'&kdt_id=\' + kdt_id %>" class="pull-right btn btn-white btn-block font-size-14">继续评价</a>\n        <% } %>\n    <% } %>\n</div>'}),require(["zenjs/util/args","bower_components/pop/popup","wap/trade/reviews/comment/views/add_comment","wap/trade/reviews/comment/views/like","bower_components/waterfall/waterfall_html","bower_components/pop/popout_box","text!wap/trade/reviews/comment/templates/review_success.html"],function(t,i,e,n,o,s,h){var r=Backbone.View.extend({initialize:function(t){var i=this;this._global=window._global,this.review_alias=window._global.review_alias,this.nWaterfall=this.$(".js-comment-list"),this.nList=this.nWaterfall.find(".js-list"),this.waterfallHtml=new o({el:this.nWaterfall,url:"/v2/trade/reviews/comment.json",perPage:10,idName:"lastCommentId",idValue:window._global.lastCommentId,finishedHTML:" ",postData:{alias:this.review_alias},onDataLoad:function(t){i.nList.append(t)}}),0==window._global.first_comment_num&&(this.comment_list_empty=!0,this.nList.addClass("border-bottom-0")),this.likeView=new n({el:$(".js-like-container"),urlMap:{like:"/v2/trade/reviews/like.json",dislike:"/v2/trade/reviews/cancelLike.json"},postData:{alias:this.review_alias}})},events:{"click .js-add-comment":"onCommentClick","click .js-share":"onShareClick"},render:function(i){if("1"!=window._global.show_share_guide)return this;var e=t.get("review_share_type"),n="weixin"==window._global.platform;return"1"==e&&n?window.showGuide("share"):new s({html:_.template(h)({order_no:window._global.order_no,kdt_id:window._global.kdt_id,has_all_reviewed:window._global.has_all_reviewed,is_open_review:window._global.customer_reviews,is_weixin:n}),onOKClicked:function(){window.showGuide("share")},className:"review-popout",preventHideOnOkClicked:!0}).render().show(),this},onCommentClick:function(t){var n=$(t.target),o=n.data("commentid"),s=n.data("commentname");this.commentPopup||(this.commentPopup=new i({contentViewClass:e,doNotRemoveOnHide:!0,className:"add-comment-form",contentViewOptions:{onCommentSuccess:_(function(){this.comment_list_empty&&(this.nList.removeClass("border-bottom-0"),this.nWaterfall.find(".js-review-finished").remove(),this.comment_list_empty=!1),this.waterfallHtml.finished=!1,$(window).trigger("scroll")}).bind(this)}}).render(),this.commentView=this.commentPopup.contentView),this.commentView.setCommentId(o,s),this.commentPopup.show()},onShareClick:function(t){window.showGuide("share")}});new r({_global:window._global,el:$("body")}).render()}),define("main",function(){});