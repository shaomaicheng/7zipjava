define("zenjs/util/number",[],function(){return{makeRandomString:function(t){var n="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";t=t||10;for(var o=0;o<t;o++)n+=e.charAt(Math.floor(Math.random()*e.length));return n}}}),define("bower_components/pop/pop",["require","zenjs/events","zenjs/util/number"],function(t){var n=function(){},e=t("zenjs/events"),o=t("zenjs/util/number");return window.zenjs=window.zenjs||{},e.extend({init:function(t){this._window=$(window);var e=o.makeRandomString();$("body").append('<div id="'+e+'"                 style="display:none; height: 100%;                 position: fixed; top: 0; left: 0; right: 0;                background-color: rgba(0, 0, 0, '+(t.transparent||".7")+');z-index:1000;opacity:0;transition: opacity ease 0.2s;"></div>'),this.nBg=$("#"+e),this.nBg.on("click",$.proxy(function(){this.isCanNotHide||this.hide()},this));var i=o.makeRandomString();$("body").append('<div id="'+i+'" class="'+(t.className||"")+'" style="overflow:hidden;visibility: hidden;"></div>'),this.nPopContainer=$("#"+i),this.nPopContainer.hide(),this.nPopContainer.css({opacity:0,position:"absolute","z-index":1e3}),t.contentViewClass&&(this.contentViewClass=t.contentViewClass,this.contentViewOptions=$.extend({el:this.nPopContainer},t.contentViewOptions||{}),this.contentView=new this.contentViewClass($.extend({onHide:$.proxy(this.hide,this)},this.contentViewOptions)),this.contentView.onHide=$.proxy(this.hide,this)),this.animationTime=t.animationTime||300,this.isCanNotHide=t.isCanNotHide,this.doNotRemoveOnHide=t.doNotRemoveOnHide||!1,this.onShow=t.onShow||n,this.onHide=t.onHide||n,this.onFinishHide=t.onFinishHide||n,this.html=t.html},render:function(t){return this.renderOptions=t||{},this.contentViewClass?this.contentView.render(this.renderOptions):this.html&&this.nPopContainer.html(this.html),this},show:function(){return this.nBg.show().css({opacity:"1","transition-property":"none"}),this.nPopContainer.show(),this.trigger("pop:show:before"),setTimeout($.proxy(function(){this.trigger("pop:show:after"),this.nPopContainer.show().css("visibility","visible"),this._doShow&&this._doShow(),this.onShow()},this),200),this},hide:function(t){t=t||{};var n=t.doNotRemove||this.doNotRemoveOnHide||!1;this._doHide&&this._doHide(),this.trigger("pop:hide:before"),setTimeout($.proxy(function(){this.nBg.css({opacity:0,"transition-property":"opacity"}),this.trigger("pop:hide:after"),setTimeout($.proxy(function(){this.nBg.hide(),this.nPopContainer.hide(),n||this.destroy()},this),200)},this),this.animationTime),this.onHide()},destroy:function(){return this.nPopContainer.remove(),this.nBg.remove(),this.contentView&&this.contentView.remove(),this}})}),define("bower_components/pop/pop_forbid_scroll",["require","./pop"],function(t){return window.zenjs=window.zenjs||{},t("./pop").extend({init:function(t){this._super(t),t.doNotForbidScroll||(this.on("pop:show:before",$.proxy(this.onBeforePopShow,this)),this.on("pop:show:after",$.proxy(this.onAfterPopShow,this)),this.on("pop:hide:after",$.proxy(this.onAfterPopHide,this)))},onBeforePopShow:function(){this.top=this._window.scrollTop()},onAfterPopShow:function(){this._window.scrollTop(0),this.startShow()},onAfterPopHide:function(){var t,n=function(e){if(t!==this._window.scrollTop()&&e>0)return this._window.scrollTop(t),void setTimeout($.proxy(n,this,e-1));setTimeout($.proxy(this.onFinishHide,this),50)};return function(){this.startHide(),t=this.top,this._window.scrollTop(t),$.proxy(n,this)(2),setTimeout($.proxy(function(){window.zenjs.popList.length<1&&$("html").css("position",this.htmlPosition)},this),200)}}(),startShow:function(){var t=window.zenjs.popList;if(t||(t=window.zenjs.popList=[]),0===t.length){var n=$("body"),e=$("html");this.htmlPosition=e.css("position"),e.css("position","relative"),this.bodyCss=(n.prop("style")||{}).cssText,this.htmlCss=(e.prop("style")||{}).cssText,$("body,html").css({overflow:"hidden",height:this._window.height(),"padding-bottom":0,"margin-bottom":0})}t.indexOf(this)<0&&t.push(this)},startHide:function(){var t=window.zenjs.popList,n=t.indexOf(this);n>-1&&t.splice(n,1),t.length<1&&($("html").attr("style",this.htmlCss||""),$("body").attr("style",this.bodyCss||""))}})}),define("bower_components/pop/popout",["require","./pop_forbid_scroll"],function(t){return t("./pop_forbid_scroll").extend({init:function(t){t=t||{},this._super(t),this.css=$.extend({transition:"opacity ease "+this.animationTime+"ms",top:"50%",left:"50%","-webkit-transform":"translate3d(-50%, -50%, 0)",transform:"translateY(-50%, -50%, 0)"},t.css||{}),this.nPopContainer.css(this.css)},_doShow:function(){$(".js-popout-close").click($.proxy(function(t){this.hide()},this)),this.nPopContainer.css("opacity",1),this.nPopContainer.show()},_doHide:function(t){this.nPopContainer.css({opacity:0})}})}),define("bower_components/pop/popout_box",["require","./popout"],function(t){var n=function(){};return t("./popout").extend({init:function(t){this._super(t),this._onOKClicked=t.onOKClicked||n,this._onCancelClicked=t.onCancelClicked||n,this.preventHideOnOkClicked=t.preventHideOnOkClicked||!1,this.width=t.width,this.setEventListener()},setEventListener:function(){this.nPopContainer.on("click",".js-ok",$.proxy(this.onOKClicked,this)),this.nPopContainer.on("click",".js-cancel",$.proxy(this.onCancelClicked,this))},_doShow:function(){this.boxCss={"border-radius":"4px",background:"white",width:this.width||"270px",padding:"15px"},this.nPopContainer.css(this.boxCss).addClass("popout-box"),this._super()},_doHide:function(t){this._super()},onOKClicked:function(t){this._onOKClicked(t),!this.preventHideOnOkClicked&&this.hide()},onCancelClicked:function(t){this._onCancelClicked(t),this.hide()}})}),define("text!bower_components/pop/pop_confirm/box.html",[],function(){return'<% if (title) { %>\n<h1 class="center font-size-16"><%= title %></h1>\n<% } %>\n<div class="confirm-content font-size-14<% if (title) { %> c-gray-dark<% } %>" style="line-height: 20px; padding: 5px 5px 10px;">\n    <%= content %>\n</div>\n<hr style="margin: 9px -15px 10px;" />\n<div class="btn-2-1">\n    <p class="js-cancel center font-size-16" style="padding-top: 5px;"><%= cancelBtn %></p>\n</div><div class="btn-2-1">\n    <p class="js-ok center c-green font-size-16" style="padding-top: 5px;"><%= okBtn %></p>\n</div>'}),define("zenjs/util/template",["require","jquery"],function(t){var n=t("jquery"),e=function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},n=["&","<",">",'"',"'"],e=new RegExp("["+n.join("")+"]","g");return function(n){return null==n?"":(""+n).replace(e,function(n){return t[n]})}}(),o={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},i={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};return function(t,s,a){var r;a=n.extend({},o,a);var d=new RegExp([(a.escape||/(.)^/).source,(a.interpolate||/(.)^/).source,(a.evaluate||/(.)^/).source].join("|")+"|$","g"),c=0,l="__p+='";t.replace(d,function(n,e,o,s,a){return l+=t.slice(c,a).replace(/\\|'|\r|\n|\t|\u2028|\u2029/g,function(t){return"\\"+i[t]}),e&&(l+="'+\n((__t=("+e+"))==null?'':escapeFunc(__t))+\n'"),o&&(l+="'+\n((__t=("+o+"))==null?'':__t)+\n'"),s&&(l+="';\n"+s+"\n__p+='"),c=a+n.length,n}),l+="';\n",a.variable||(l="with(obj||{}){\n"+l+"}\n"),l="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+l+"return __p;\n";try{r=new Function(a.variable||"obj","escapeFunc",l)}catch(t){throw t.source=l,t}if(s)return r(s,e);var h=function(t){return r.call(this,t,e)};return h.source="function("+(a.variable||"obj")+"){\n"+l+"}",h}}),define("bower_components/pop/pop_confirm/popout_confirm",["require","../popout_box","text!../pop_confirm/box.html","zenjs/util/template"],function(t){var n=t("../popout_box"),e=t("text!../pop_confirm/box.html"),o=t("zenjs/util/template"),i=o(e),s=n.extend({init:function(t){this._super(t),this.isCanNotHide=!0,this.title=t.title||"",this.content=t.content||"",this.okBtn=t.okBtn||"确定",this.cancelBtn=t.cancelBtn||"取消"},render:function(t){return this.html||(this.html=i({title:this.title,content:this.content,okBtn:this.okBtn,cancelBtn:this.cancelBtn})),this._super(t),this.nPopContainer.addClass("popout-confirm"),this}}),a=null;return{show:function(t,n){n=n||{},a&&this.hide(),n.content=t,a=new s(n).render().show()},hide:function(){a&&(a.hide(),a=null)}}}),define("wap/card/index/model",["zenjs/util/args"],function(t){"use strict";return Backbone.Model.extend({defaults:{mobile:"",gender:"",weixin:"",area_code:"",address:{},card_alias:""},initialize:function(){this.set({card_alias:t.get("card_alias")||0}),this.fetching=!1,this.on("fetchBefore",function(){this.fetching=!0}),this.on("fetchFinish",function(){this.fetching=!1})},save:function(t){var n=this;if(!this.fetching)return $._ajax($.extend({},{beforeSend:function(){n.trigger("fetchBefore")},complete:function(){n.trigger("fetchFinish")}},t))}})}),define("wap/components/loading",["bower_components/pop/pop"],function(t){var n,e=t.extend({init:function(t){t=t||{},this._super(t),this.css={position:"fixed",opacity:1,top:"50%",left:"50%","-webkit-transform":"translate3d(-50%, -50%, 0)",transform:"translateY(-50%, -50%, 0)"},this.nPopContainer.css(this.css)}});return{show:function(t){t=t||"处理中",n&&this.hide(),n=new e({html:'<div class="loader-container"><div class="loader center">'+t+"</div></div>",isCanNotHide:!0,transparent:".6"}).render().show()},hide:function(){n&&n.hide(),n=null}}}),define("text!wap/card/index/template/qc_code.html",[],function(){return'<div class="member-popout">\n\t<div class="popout-header" style="background-color:<%= data.color || \'#55BD47\' %>;">\n\t\t<div class="clearfix">\n\t\t\t<h3 class="title">\n\t\t\t\t<span class="logo" style="background-image:url(<%= data.logo %>)"></span>\n\t\t\t\t<%= data.shopName %>\n\t\t\t</h3>\n\t\t\t<button class="close js-close">×</button>\n\t\t</div>\n\t\t<div class="clearfix card-region-popout">\n\t\t\t<h2 class="card-name"><%= data.cardName %></h2>\n\t\t\t<h4 class="card-discount"><%= data.rights %></h4>\n\t\t</div>\n\t</div>\n\t<div class="popout-main">\n\t\t<div class="qrcode">\n\t\t\t<img src="<%= qrcode %>">\n\t\t</div>\n\t\t<div class="barcode">\n\t\t\t<img src="<%= barcode %>">\n\t\t\t<h3 class="code"><%= code %></h3>\n\t\t</div>\n\t\t<div class="term-popout">\n\t\t\t<% if (data.term == \'0\') { %>\n\t\t\t\t有效期：无限期\n\t\t\t<% } else if (data.termBeginTime && data.termEndTime) { %>\n\t\t\t\t有效期 <%= data.termBeginTime %>至<%= data.termEndTime %>\n\t\t\t<% } else if (data.term) { %>\n\t\t\t\t有效期：<%= data.term %>\n\t\t\t<% } %>\n\n\t\t</div>\n\t</div>\n\t<p class="tip">可截图保存至相册</p>\n</div>'}),define("text!wap/card/index/template/delete_confirm.html",[],function(){return'<div class="delete-confrim">\n    <p>删除后，你将不再享受相应的会员权益</p>\n    <p>确定要删除吗?</p>\n</div>\n'}),define("text!wap/card/index/template/upgrade_info.html",[],function(){return'<div class="upgrade-popout">\n  <h3 class="current-level">\n    <span class="level-icon">Lv<%- level %></span>当前等级\n    <span class="close-btn js-cancel">×</span>\n  </h3>\n  <div class="upgrade-table-wrapper">\n    <table>\n      <thead>\n        <tr>\n          <th>\n            累计消费金额\n          </th>\n          <th>\n            累计推广金额\n          </th>\n          <th>\n            有效总和\n          </th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td>\n            <%- salesmanConsumptionSettleTotal %>元\n            <% if (Number(salesmanConsumptionNoSettleTotal)) { %>\n              <p><%- salesmanConsumptionNoSettleTotal %>元待统计</p>\n            <% } %>\n          </td>\n          <td>\n            <%- salesmanPromotionSettleTotal %>元\n            <% if (Number(salesmanPromotionNoSettleTotal)) { %>\n              <p><%- salesmanPromotionNoSettleTotal %>元待统计</p>\n            <% } %>\n          </td>\n          <td>\n            <%= salesmanConsumptionPromotionSettleTotal %>元\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n  <% if (_.size(nextLevelInfo)) { %>\n    <% var salesmanConsumptionPromotionLimit = nextLevelInfo.grantConditionTotal.salesmanConsumptionPromotionLimit; %>\n\n    <% if (Number(salesmanConsumptionPromotionLimit)) { %>\n    <p class="next-info">有效总和达到\n      <span><%- salesmanConsumptionPromotionLimit %></span>元，将升至Lv<%- level + 1 %>\n    </p>\n    <% } %>\n\n    <h3 class="next-level">\n      <span class="level-icon">Lv<%- level + 1 %></span>下一等级\n    </h3>\n\n    <% if (_.size(rights)) { %>\n      <div>\n        <ul class="rights-region">\n          <% _.each(rights, function(value, key) { %>\n            <li class="right-item-wrapper">\n              <p class="right-item <%= key %>">\n                <%= value %>\n              </p>\n            </li>\n          <% }) %>\n        </ul>\n      </div>\n    <% } %>\n  <% } %>\n</div>\n\n'}),require(["bower_components/pop/popout","bower_components/pop/popout_box","bower_components/pop/pop_confirm/popout_confirm","bower_components/youzanjsbridge/api","wap/card/index/model","zenjs/util/args","zenjs/util/ua","zenjs/util/cookie","wap/components/loading","text!wap/card/index/template/qc_code.html","text!wap/card/index/template/delete_confirm.html","text!wap/card/index/template/upgrade_info.html"],function(t,n,e,o,i,s,a,r,d,c,l,h){new(Backbone.View.extend({initialize:function(t){this.model=new i,this.on("showQcCode",this.showQcCode.bind(this))},events:{"click .js-obtain-card-btn":"handleObtainCard","click .js-set-default-card":"handleSetDefault","click .js-show-code":"handleShowCode","click .js-delete-card":"handleDelectCard","click .js-show-sub-info":"toggleSubInfo","click .js-sync-wx-bag":"showWxBagQcCode","click .js-buy-card":"handleBuyCard","click .js-close":"closePopout","click .js-show-upgrade-pop":"handleShowUpgradePop"},redirectResultPage:function(){window.location.href=_global.url.wap+"/card/membercard/result?card_alias="+this.model.get("card_alias")},handleShowUpgradePop:function(){var t=this;d.show("加载中"),$._ajax({url:"/v2/card/membercard/upgradeInfo.json",data:{card_no:this.$(".js-show-upgrade-pop").data("card-no")||""},success:function(e){if(0!==e.code)return void motify.log(e.msg||"网络错误");var o=e.data,i=o.memberInfo||{},s=o.nextLevelInfo||{},a={};_.each(s.rights,function(t,n){t&&(a[n]=t)}),t.upgradePopout=new n({isCanNotHide:!1,doNotRemoveOnHide:!0,html:_.template(h)({salesmanConsumptionSettleTotal:i.salesmanConsumptionSettleTotal,salesmanConsumptionNoSettleTotal:i.salesmanConsumptionNoSettleTotal,salesmanPromotionSettleTotal:i.salesmanPromotionSettleTotal,salesmanPromotionNoSettleTotal:i.salesmanPromotionNoSettleTotal,salesmanConsumptionPromotionSettleTotal:i.salesmanConsumptionPromotionSettleTotal,nextLevelInfo:o.nextLevelInfo,level:t.$("#card-data").data("level"),rights:a})}).render().show()},complete:function(){d.hide("加载中")}})},handleObtainCard:function(){var t=this,n=this.$(".js-obtain-card-btn");this.model.save({url:"/v2/card/membercard/takecard.json",type:"POST",data:{card_alias:this.model.get("card_alias")},beforeSend:function(){t.model.trigger("fetchBefore"),n.prop("disabled",!0)},success:function(n){0===n.code?window.Logger?window.Logger.log({s_card_code:s.get("s_card_code")}).always(function(){t.redirectResultPage()}):t.redirectResultPage():motify.log(n.msg||"网络错误")},error:function(t){motify.log(t.msg||"网络错误"),n.prop("disabled",!1)},complete:function(){t.model.trigger("fetchFinish"),n.prop("disabled",!1)}})},handleSetDefault:function(){var t=this,n=this.$(".js-set-default-card");this.model.save({url:"/v2/card/membercard/customercarddefault.json",type:"POST",data:{card_alias:this.model.get("card_alias"),card_no:n.data("card-no")||""},beforeSend:function(){t.model.trigger("fetchBefore"),n.prop("disabled",!0)},success:function(e){0===e.code?(motify.log("默认卡设置成功"),t.$(".js-default-card").removeClass("hide"),"youzanmars"==_global.platform&&o.call("setAction",{uri:"youzanmars://event?action=refresh&pageName=mars_membercard_list"})):(motify.log(e.msg||"网络错误"),n.prop("disabled",!1))},error:function(t){motify.log(t.msg||"网络错误"),n.prop("disabled",!1)}})},handleShowCode:function(){_global.is_show_qrcode&&(this.qcCodeHtml?this.trigger("showQcCode"):this.fetchQcCode())},closePopout:function(){this.popout.hide()},showQcCode:function(){this.popout=new t({isCanNotHide:!1,doNotRemoveOnHide:!0,html:this.qcCodeHtml,css:{width:"90%"}}).render(),this.popout.show()},showWxBagQcCode:function(){a.isWeixin()?this.$(".js-wx-qccode-area").show():"youzanmars"==_global.platform&&this.addCardInApp()},fetchQcCode:function(){var t=this,n=this.$("#card-data").data();this.model.save({url:"/v2/card/membercard/qrcode.json",data:{card_alias:this.model.get("card_alias")},success:function(e){0===e.code?(t.qcCodeHtml=_.template(c)({code:e.data.code,barcode:e.data.barcode,qrcode:e.data.qrcode,data:n}),t.trigger("showQcCode")):motify.log(e.msg||"网络错误")}})},handleDelectCard:function(t){var n=this;e.show(_.template(l)(),{title:"删除会员卡",okBtn:"我要删除",cancelBtn:"暂不删除",isCanNotHide:!0,onOKClicked:function(){n.model.save({url:"/v2/card/membercard/customercarddelete.json",data:{card_no:$(t.target).data("card-no")||""},type:"POST",success:function(t){0===t.code?(motify.log("删除成功"),"youzanmars"==_global.platform&&o.call("setAction",{uri:"youzanmars://event?action=refresh&pageName=mars_membercard_list"}),window.location.href=_global.url.wap+"/card/membercard/list?kdt_id="+_global.kdt_id):motify.log(t.msg||"网络错误")}})}})},handleBuyCard:function(){var t=_global.card_info_sku,n=_global.wxpay_env?1:0;if(""===t)return void motify.log("该会员卡暂时不支持购买");var e=$(".js-buy-card").data("redirect");if(e)return void(window.location.href=e);t=t||{};var o={postage:0,use_wxpay:n,accept_price:1,order_from:"",kdt_id:window._global.kdt_id,store_id:window._global.offline_id||0},i={goods_id:t.goods_id,num:1,sku_id:t.goods_sku_id,price:t.price,dc_ps:r("dc_ps")||""},a=[i];this.model.save({url:"/v2/trade/common/cache.json",type:"POST",data:{goodsList:JSON.stringify(a),common:JSON.stringify(o)},success:function(t){var e=+t.code,o=t.data;if(0!==e)return void motify.log(t.msg);var i=window._global.url.trade+o.url;i=s.add(i,{showwxpaytitle:1,kdt_id:_global.kdt_id,wxpay_env:n}),location.href=s.add(i,{book_key:o.key})}})},toggleSubInfo:function(t){var n=$(t.currentTarget);n.find(".arrow-right").toggleClass("down-arrow-right"),n.find(".js-block-sub-desc").toggle()},render:function(){return this},addCardInApp:function(){var t=window._global;o.on("WXAddToCardPackageFinish",function(){window.location.reload()}),o.call("addToWXCardPackage",{cardId:t.card_id||"",cardExt:t.jssdk_add_card_data||""})}}))({el:$("body")})}),define("main",function(){});