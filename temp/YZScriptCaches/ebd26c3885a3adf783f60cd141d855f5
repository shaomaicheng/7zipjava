!function(e,t){t("object"==typeof exports&&exports?exports:e.Mustache={})}(this,function(e){function t(e){return"function"==typeof e}function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e,t){return d.call(e,t)}function o(e){return!i(m,e)}function r(e){return String(e).replace(/[&<>"'\/]/g,function(e){return g[e]})}function a(t,i){function r(e){if("string"==typeof e&&(e=e.split(w,2)),!h(e)||2!==e.length)throw new Error("Invalid tags: "+e);a=new RegExp(n(e[0])+"\\s*"),p=new RegExp("\\s*"+n(e[1])),u=new RegExp("\\s*"+n("}"+e[1]))}if(!t)return[];var a,p,u,f=[],d=[],m=[],g=!1,b=!1;r(i||e.tags);for(var x,U,q,j,E,P,T=new l(t);!T.eos();){if(x=T.pos,q=T.scanUntil(a))for(var C=0,$=q.length;$>C;++C)j=q.charAt(C),o(j)?m.push(d.length):b=!0,d.push(["text",j,x,x+1]),x+=1,"\n"===j&&function(){if(g&&!b)for(;m.length;)delete d[m.pop()];else m=[];g=!1,b=!1}();if(!T.scan(a))break;if(g=!0,U=T.scan(k)||"name",T.scan(v),"="===U?(q=T.scanUntil(y),T.scan(y),T.scanUntil(p)):"{"===U?(q=T.scanUntil(u),T.scan(_),T.scanUntil(p),U="&"):q=T.scanUntil(p),!T.scan(p))throw new Error("Unclosed tag at "+T.pos);if(E=[U,q,x,T.pos],d.push(E),"#"===U||"^"===U)f.push(E);else if("/"===U){if(!(P=f.pop()))throw new Error('Unopened section "'+q+'" at '+x);if(P[1]!==q)throw new Error('Unclosed section "'+P[1]+'" at '+x)}else"name"===U||"{"===U||"&"===U?b=!0:"="===U&&r(q)}if(P=f.pop())throw new Error('Unclosed section "'+P[1]+'" at '+T.pos);return c(s(d))}function s(e){for(var t,n,i=[],o=0,r=e.length;r>o;++o)(t=e[o])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(i.push(t),n=t));return i}function c(e){for(var t,n,i=[],o=i,r=[],a=0,s=e.length;s>a;++a)switch(t=e[a],t[0]){case"#":case"^":o.push(t),r.push(t),o=t[4]=[];break;case"/":n=r.pop(),n[5]=t[2],o=r.length>0?r[r.length-1][4]:i;break;default:o.push(t)}return i}function l(e){this.string=e,this.tail=e,this.pos=0}function p(e,t){this.view=null==e?{}:e,this.cache={".":this.view},this.parent=t}function u(){this.cache={}}var f=Object.prototype.toString,h=Array.isArray||function(e){return"[object Array]"===f.call(e)},d=RegExp.prototype.test,m=/\S/,g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},v=/\s*/,w=/\s+/,y=/\s*=/,_=/\s*\}/,k=/#|\^|\/|>|\{|&|=|!/;l.prototype.eos=function(){return""===this.tail},l.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},l.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},p.prototype.push=function(e){return new p(e,this)},p.prototype.lookup=function(e){var n,i=this.cache;if(e in i)n=i[e];else{for(var o,r,a=this;a;){if(e.indexOf(".")>0)for(n=a.view,o=e.split("."),r=0;null!=n&&r<o.length;)n=n[o[r++]];else n=a.view[e];if(null!=n)break;a=a.parent}i[e]=n}return t(n)&&(n=n.call(this.view)),n},u.prototype.clearCache=function(){this.cache={}},u.prototype.parse=function(e,t){var n=this.cache,i=n[e];return null==i&&(i=n[e]=a(e,t)),i},u.prototype.render=function(e,t,n){var i=this.parse(e),o=t instanceof p?t:new p(t);return this.renderTokens(i,o,n,e)},u.prototype.renderTokens=function(n,i,o,r){function a(e){return p.render(e,i,o)}for(var s,c,l="",p=this,u=0,f=n.length;f>u;++u)switch(s=n[u],s[0]){case"#":if(!(c=i.lookup(s[1])))continue;if(h(c))for(var d=0,m=c.length;m>d;++d)l+=this.renderTokens(s[4],i.push(c[d]),o,r);else if("object"==typeof c||"string"==typeof c)l+=this.renderTokens(s[4],i.push(c),o,r);else if(t(c)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");null!=(c=c.call(i.view,r.slice(s[3],s[5]),a))&&(l+=c)}else l+=this.renderTokens(s[4],i,o,r);break;case"^":(!(c=i.lookup(s[1]))||h(c)&&0===c.length)&&(l+=this.renderTokens(s[4],i,o,r));break;case">":if(!o)continue;null!=(c=t(o)?o(s[1]):o[s[1]])&&(l+=this.renderTokens(this.parse(c),i,o,c));break;case"&":null!=(c=i.lookup(s[1]))&&(l+=c);break;case"name":null!=(c=i.lookup(s[1]))&&(l+=e.escape(c));break;case"text":l+=s[1]}return l},e.name="mustache.js",e.version="0.8.1",e.tags=["{{","}}"];var b=new u;e.clearCache=function(){return b.clearCache()},e.parse=function(e,t){return b.parse(e,t)},e.render=function(e,t,n){return b.render(e,t,n)},e.to_html=function(n,i,o,r){var a=e.render(n,i,o);return t(r)?void r(a):a},e.escape=r,e.Scanner=l,e.Context=p,e.Writer=u});var appUtils={};appUtils.updateUrlWithStamp=function(e,t){var t=(t||"t")+"=",n=new RegExp(t+"\\d+"),i=+new Date;if(e.indexOf(t)>-1)return e.replace(n,t+i);if(e.indexOf("?")>-1){var o=e.split("?");return o[1]?o[0]+"?"+t+i+"&"+o[1]:o[0]+"?"+t+i}return e.indexOf("#")>-1?e.split("#")[0]+"?"+t+i+location.hash:e+"?"+t+i},appUtils.preset={errorModal:{content:{html:"糟糕，网络不给力"},confirm:{html:"重新进入",click:function(){window.location.href=appUtils.updateUrlWithStamp(window.location.href)}},cancel:"remove"}},appUtils.modal=function(){function e(){i&&i.remove(),i=$($("#apps-modal-tpl").html()),o={};for(var e in a)o[e]=i.find(".js-apps-modal-"+e)}function t(t){e();var n,i,r;for(n in t)if("string"!=typeof t[n])for(i in t[n])r=o[n][i],$.isFunction(r)&&r.call(o[n],t[n][i]);else"remove"==t[n]&&o[n].remove()}function n(e){return $.extend(!0,{},a,e)}var i,o,r={open:function(e){t(n(e)),$(document.body).append(i)},close:function(e){e===!0?i.find(".apps-modal").remove():i&&i.remove()}},a={content:{html:""},confirm:{html:"确定",click:$.noop},cancel:{html:"取消",click:r.close}};return r}(),appUtils.process=function(){function e(e){a.cancel.html=e,s.cancel.html=e}function t(){return 0!==o?10999==o?(r.open(a),!1):10998==o?(r.open(s),!1):(r.open(l),!1):0===i.costPoint||void 0==i.costPoint||(r.open(c),!1)}var n,i=_apps_global,o=i.errorCode,r=appUtils.modal,a={content:{html:i.errorMsg},confirm:{html:"登录",click:function(){location.href=i.login}},cancel:{html:"取消",click:function(){r.close()}}},s={content:{html:i.errorMsg},confirm:{html:"关注",click:function(){window.showGuide&&window.showGuide("follow")}},cancel:{html:"取消",click:function(e){r.close()}}},c={content:{html:'每次抽奖将消耗<span class="important"> '+i.costPoint+"积分</span>"},confirm:{html:"赌一把",click:function(){r.close(),n.onconfirm&&n.onconfirm()}},cancel:{html:"舍不得",click:function(){r.close()}}};"/v2/apps/shake"==location.pathname&&(c.content.html='每次抽奖将消耗<span class="important"> '+i.costPoint+"积分，确定参加吗？</span>",c.confirm.html="我要参加",c.cancel.html="进店逛逛",c.cancel.click=function(){r.close(),location.href=_apps_global.home_page_url});var l={content:{html:i.errorMsg},confirm:{html:"知道了",click:function(){r.close()}},cancel:"remove"};return n={check:t,setCancelText:e,onconfirm:$.noop}}(),appUtils.atLeast=function(e,t){function n(){r.resolve.apply(null,arguments)}var i,o=!1,r={};return setTimeout(function(){o?t.apply(null,i):r.resolve=function(){t.apply(null,arguments)}},e),r.resolve=function(){i=arguments,o=!0},{resolve:n}},appUtils.randInt=function(e,t){var n=e+Math.random()*(t-e);return parseInt(n,10)},appUtils.format=function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,n){return void 0!==t[n]?t[n]:e})},appUtils.getUrlParam=function(e,t){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i="router"===t?window.location.href:window.location.search,o=i.substr(1).match(n);return null!==o?window.unescape(o[2]):null},function(e,t,n){var i,o=_apps_global,r=t(".apps-guess-stage"),a={life:o.error_num||0,ownPoints:+o.own_points},s=o.alias,c={},l=appUtils.randInt(0,5);void 0==o.questions&&(o.questions={list:[]}),t(".js-template").each(function(){var e=this.id.replace("template-","");c[e]=t(this).html()});var p=function(e,n){var i;return function(){i||(i=t("#template-"+e).html(),i=t(i),n!==!1&&i.on("click",function(){i.remove(),i=null}),t(".apps-game").append(i))}},u=p("pop-gameover",!1),f=function(){var e=t('<div class="question-pop-slide"></div>');return{pop:function(t){e.appendTo(r),e.css("marginTop"),e.addClass("question-pop-slide-down"),e.html(c[t])},close:function(){e.removeClass("question-pop-slide-down")}}}();i=function(){function n(e){var n,i,o,r=w[e],s=r.data,l=r.template;return"string"==typeof s.swer&&(s.swer=s.swer.split("")),i=Mustache.render(c["question-upside"],{index:e+1,content:s.content,image:""==s.image?null:s.image,audio:""==s.audio?null:s.audio,life:a.life,ownPoints:a.ownPoints}),n=Mustache.render(l,s),n=t(n),v.forEach(function(t){t("question",n,s,e)}),o=Mustache.render(c["question-footer"]),t(i).add(n).add(o)}function i(){var e=c.intro;return v.forEach(function(t){t("intro",e)}),e}function h(){var e=g>=w.length?1:0;t._ajax({url:"/v2/apps/crazyguess/crazyguess.json",type:"post",data:{alias:s,seq:1+~~g,error_num:Math.abs(a.life),is_finished:e,id:1}}).then(function(t){0===t.code&&(o.detail_url=t.data.detail_url,e&&d())})}function d(){setTimeout(function(){p("help-finish")()},1e3)}var m,g=+o.question_seq||0,v=[];1==g&&0!=o.is_play&&(g=0),0===o.is_play&&p("cantplay",!1)();var w=o.questions.list.map(function(e){return{template:c["question-type"+e.type],data:e}}),y=function(){var t=["-0","1-5","6-10","11-15","16-"],n=[{title:"博古通今",percent:90},{title:"学富五车",percent:70},{title:"才华横溢",percent:50},{title:"见多识广",percent:30},{title:"奋发图强",percent:10}],i=["你击败了全国"+(90+l)+"%的人，获得“博古通今”称号！你的脑洞略大于宇宙。","你击败了全国"+(70+l)+"%的人，获得“学富五车”称号！天下才气你独占八斗。","你击败了全国"+(50+l)+"%的人，获得“才华横溢”称号！你的未来无可限量！","你击败了全国"+(30+l)+"%的人，获得“见多识广”称号！你的学识已足够过好此生！","你击败了全国"+(10+l)+"%的人，获得“奋发图强”称号！有志者，事竟成！"];return function(){var r,s,p=Math.abs(a.life);t.some(function(e,t){var n=e.split("-").map(function(e){return parseInt(e,10)}),i=!0,o=!0;return isNaN(n[0])||(i=p>=n[0]),isNaN(n[1])||(o=p<=n[1]),i=i&&o,i&&(r=t),i}),s=n[r];var u=e.Mustache.render(c.complete,{levelTitle:s.title,percent:s.percent+l,ownPoints:a.ownPoints,noPrize:0==o.prize_type||1==o.prize_type&&"0"==o.coupon_id||2==o.prize_type&&"0"==o.present_id,present:"0"!=o.present_id&&2==o.prize_type});return e.attachUrl=function(){"0"==o.coupon_id&&"0"==o.present_id?e.location.href=o.detail_url:e.location.href=o.detail_url||_global.url.wap+"/showcase/usercenter?kdt_id="+o.kdt_id},v.forEach(function(e){e("complete",u)}),"function"==typeof e.setShareData&&e.setShareData({title:i[r]}),u}}(),_=function(){t._ajax({url:"/v2/apps/crazyguess/crazyguess.json",type:"post",defaultError:!1,data:{alias:s,seq:~~g,error_num:Math.abs(a.life),is_finished:-1,id:1}})};return m={render:function(){if(t(e).scrollTop(0),0===g){r.html(i());var o,a=t("body").width();return a>640&&(a=640),o=a/640,t(".question-intro-wrap").width(a).height(1143*o),t(".question-intro-btn").css({width:355*o,height:110*o,left:325*o,top:515*o,marginLeft:-355*o/2}),t(".apps-game").css({minHeight:"initial"}),void t(".apps-guess-stage").css({paddingBottom:0})}if(t(".apps-game").css({minHeight:"100%"}),t(".apps-guess-stage").css({paddingBottom:"30px"}),g>w.length)return void r.html(y());var s=n(g-1);r.html(s)},renderPreviewQuestion:function(i,o){t(e).scrollTop(0),w[i]={template:c["question-type"+o.type],data:o};var a=n(i);r.html(a),r.find(".js-question-footer").remove()},to:function(e){g=e,this.render()},next:function(){switch(+o.send_method){case 0:g>0&&g<=w.length&&(a.ownPoints+=+o.point);break;case 1:g==w.length&&(a.ownPoints+=+o.point)}g>0&&h(),g++,m.render()},onRender:function(e){v.push(e)},slide:f,updateError:_,needHelp:p("needhelp"),popGameover:u}}();var h=function(){function e(e){function n(){o.removeClass("question-audio-player-playing"),i.removeEventListener("ended",n)}var i=document.querySelector(".js-audio"),o=t(e.target);o.toggleClass("question-audio-player-playing",i.paused),i.paused?i.play():i.pause(),i.addEventListener("ended",n)}function n(){for(var e in a)r.delegate(".js-"+e,"click",a[e])}var o=p("help"),a={"next-stage":i.next,"play-audio":e,"pop-help":o};return{init:n}}();e.game_stage=i,e.game_player=a,e.gameIns={init:function(){e.game_scenario&&(i.onRender(game_scenario.compile),i.onRender(game_scenario.setUpSharement));var t=appUtils.getUrlParam("_s");t?i.to(t):i.render(),h.init()},partialInit:function(){i.render()},initHelp:function(){var e;t("body").delegate(".js-choose","click",function(){e||(t(".js-pop-help").removeClass("question-animate-flash"),t(".js-join-btn").removeClass("question-animate-flash2"),e=!0,setTimeout(function(){e=!1},1500),t("body").width(),t(".js-pop-help").addClass("question-animate-flash"),t(".js-join-btn").addClass("question-animate-flash2"))})}}}(this,$),window.addEventListener("message",function(e){var t=JSON.parse(e.data);game_stage.renderPreviewQuestion(t.index,t.data),$(".apps-game").css({minHeight:"100%"}),$(".apps-guess-stage").css({paddingBottom:"30px"})},!1),$(function(){gameIns.initHelp(),gameIns.init()});