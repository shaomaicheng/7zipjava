!function(t,e){function n(t,n){this.promise=this,this._isPromise=!0,this._successFn=t,this._failFn=n,this._scope=this,this._boundArgs=null,this._hasContext=!1,this._nextContext=e,this._currentContext=e}function i(){this.errorsEmitted=0,this.errorsHandled=0}function o(t,e,n){e?t.reject(e):t.resolve(n)}function r(t){return!!t._isPromise}function s(t){return"object"==typeof t&&"function"==typeof t.then}function c(t){var e=new n;return e.resolve(t),e}function l(t){var e=new n;return e.reject(t),e}function a(t,e,n){return t[e]=n,n}function h(t,e,n){return t[e]={state:"fulfilled",value:n},n}function u(t,e,n){return t[e]={state:"rejected",reason:n},n}function p(t){if(1==arguments.length&&Array.isArray(t)||(t=Array.prototype.slice.call(arguments,0)),!t.length)return c([]);for(var e=[],i=!1,o=new n,r=t.length,l=0;l<t.length;l+=1)t[l]&&s(t[l])?t[l].then(a.bind(null,e,l)).then(function(){r--,i||0!==r||(i=!0,o.resolve(e))},function(t){i||(i=!0,o.reject(t))}):(e[l]=t[l],r-=1);return 0!==r||i||(i=!0,o.resolve(e)),o}function f(t){if(!Array.isArray(t))throw Error('The input to "allSettled()" should be an array of Promise or values');if(!t.length)return c([]);for(var e=[],i=new n,o=t.length,r=0;r<t.length;r+=1)t[r]&&s(t[r])?t[r].then(h.bind(null,e,r),u.bind(null,e,r)).then(function(){0==--o&&i.resolve(e)}):(h(e,r,t[r]),0==--o&&i.resolve(e));return i}function d(){return new n}function m(t,i){var o=e,r=t;if(void 0!==i&&(r=i,o=t),"number"!=typeof r)throw new Error("Bad delay value "+r);var s=new n;return setTimeout(function(){s.resolve(o)},r),s}function _(t,i){var o=Array.prototype.slice.call(arguments,1),r=new n;return process.nextTick(function(){try{r.resolve(t.apply(e,o))}catch(t){r.reject(t)}}),r}function v(t,n){var i=Array.prototype.slice.call(arguments,0);return i.splice(1,0,e),w.apply(e,i)()}function w(t,e,i){var o=Array.prototype.slice.call(arguments,2);return function(i){var r=new n;try{t.apply(e,o.concat(Array.prototype.slice.call(arguments,0),r.makeNodeResolver()))}catch(t){r.reject(t)}return r}}var y=new i;n.prototype._handleError=function(){this._errorHandled||(y.errorsHandled++,this._errorHandled=!0)},n.prototype._useContext=function(t){return this._nextContext=this._currentContext=t,this._hasContext=!0,this},n.prototype.clearContext=function(){return this._hasContext=!1,this._nextContext=e,this},n.prototype.setContext=function(t){return this._nextContext=t,this._hasContext=!0,this},n.prototype.getContext=function(){return this._nextContext},n.prototype.resolve=function(t){if(this._error||this._hasData)throw new Error("Unable to resolve or reject the same promise twice");var e;if(t&&r(t)){if(this._child=t,this._promises){for(e=0;e<this._promises.length;e+=1)t._chainPromise(this._promises[e]);delete this._promises}if(this._onComplete){for(e=0;e<this._onComplete.length;e+=1)t.fin(this._onComplete[e]);delete this._onComplete}}else if(t&&s(t))t.then(function(t){this.resolve(t)}.bind(this),function(t){this.reject(t)}.bind(this));else{if(this._hasData=!0,this._data=t,this._onComplete)for(e=0;e<this._onComplete.length;e++)this._onComplete[e]();if(this._promises){for(e=0;e<this._promises.length;e+=1)this._promises[e]._withInput(t);delete this._promises}}},n.prototype.reject=function(t){if(this._error||this._hasData)throw new Error("Unable to resolve or reject the same promise twice");var e;if(this._error=t,y.errorsEmitted++,this._ended&&(this._handleError(),process.nextTick(function(){throw t})),this._onComplete)for(e=0;e<this._onComplete.length;e++)this._onComplete[e]();if(this._promises){for(this._handleError(),e=0;e<this._promises.length;e+=1)this._promises[e]._withError(t);delete this._promises}},n.prototype.then=function(t,e){var i=new n(t,e);return this._nextContext&&i._useContext(this._nextContext),this._child?this._child._chainPromise(i):this._chainPromise(i),i},n.prototype.thenBound=function(t,e,i){var o=new n(t);return this._nextContext&&o._useContext(this._nextContext),o._scope=e,arguments.length>2&&(o._boundArgs=Array.prototype.slice.call(arguments,2)),this._child?this._child._chainPromise(o):this._chainPromise(o),o},n.prototype.fail=function(t){return this.then(null,t)},n.prototype.failBound=function(t,e,i){var o=new n(null,t);return this._nextContext&&o._useContext(this._nextContext),o._scope=e,arguments.length>2&&(o._boundArgs=Array.prototype.slice.call(arguments,2)),this._child?this._child._chainPromise(o):this._chainPromise(o),o},n.prototype.fin=function(t){return this._hasData||this._error?(t(),this):(this._child?this._child.fin(t):this._onComplete?this._onComplete.push(t):this._onComplete=[t],this)},n.prototype.end=function(){return this._end(),this},n.prototype._end=function(){if(this._error)throw this._handleError(),this._error;return this._ended=!0,this},n.prototype.done=function(t,e){var n=this;(t||e)&&(n=n.then(t,e)),n._end()},n.prototype.timeout=function(t,e){var i=new n,o=!1,r=setTimeout(function(){i.reject(new Error(e||"Promise timeout after "+t+" ms.")),o=!0},t);return this.then(function(t){o||(clearTimeout(r),i.resolve(t))},function(t){o||(clearTimeout(r),i.reject(t))}),i.promise},n.prototype._withInput=function(t){if(this._successFn)try{this.resolve(this._call(this._successFn,[t,this._currentContext]))}catch(t){this.reject(t)}else this.resolve(t);delete this._currentContext},n.prototype._withError=function(t){if(this._failFn)try{this.resolve(this._call(this._failFn,[t,this._currentContext]))}catch(t){this.reject(t)}else this.reject(t);delete this._currentContext},n.prototype._call=function(t,e){return this._boundArgs&&(e=this._boundArgs.concat(e)),t.apply(this._scope,e)},n.prototype._chainPromise=function(t){this._hasContext&&t._useContext(this._nextContext),this._child?this._child._chainPromise(t):this._hasData?t._withInput(this._data):this._error?(this._handleError(),t._withError(this._error)):this._promises?this._promises.push(t):this._promises=[t]},n.prototype.makeNodeResolver=function(){return o.bind(null,this)},n.prototype.delay=function(t){return this.then(function(e){return m(e,t)})},t.Q||(t.Q={all:p,bindPromise:w,defer:d,delay:m,fcall:_,isPromise:r,isPromiseLike:s,nfcall:v,resolve:c,reject:l,stats:y,allSettled:f,Promise:n})}(window);var appUtils={};appUtils.updateUrlWithStamp=function(t,e){var e=(e||"t")+"=",n=new RegExp(e+"\\d+"),i=+new Date;if(t.indexOf(e)>-1)return t.replace(n,e+i);if(t.indexOf("?")>-1){var o=t.split("?");return o[1]?o[0]+"?"+e+i+"&"+o[1]:o[0]+"?"+e+i}return t.indexOf("#")>-1?t.split("#")[0]+"?"+e+i+location.hash:t+"?"+e+i},appUtils.preset={errorModal:{content:{html:"糟糕，网络不给力"},confirm:{html:"重新进入",click:function(){window.location.href=appUtils.updateUrlWithStamp(window.location.href)}},cancel:"remove"}},appUtils.modal=function(){function t(){i&&i.remove(),i=$($("#apps-modal-tpl").html()),o={};for(var t in s)o[t]=i.find(".js-apps-modal-"+t)}function e(e){t();var n,i,r;for(n in e)if("string"!=typeof e[n])for(i in e[n])r=o[n][i],$.isFunction(r)&&r.call(o[n],e[n][i]);else"remove"==e[n]&&o[n].remove()}function n(t){return $.extend(!0,{},s,t)}var i,o,r={open:function(t){e(n(t)),$(document.body).append(i)},close:function(t){t===!0?i.find(".apps-modal").remove():i&&i.remove()}},s={content:{html:""},confirm:{html:"确定",click:$.noop},cancel:{html:"取消",click:r.close}};return r}(),appUtils.process=function(){function t(t){s.cancel.html=t,c.cancel.html=t}function e(){return 0!==o?10999==o?(r.open(s),!1):10998==o?(r.open(c),!1):(r.open(a),!1):0===i.costPoint||void 0==i.costPoint||(r.open(l),!1)}var n,i=_apps_global,o=i.errorCode,r=appUtils.modal,s={content:{html:i.errorMsg},confirm:{html:"登录",click:function(){location.href=i.login}},cancel:{html:"取消",click:function(){r.close()}}},c={content:{html:i.errorMsg},confirm:{html:"关注",click:function(){window.showGuide&&window.showGuide("follow")}},cancel:{html:"取消",click:function(t){r.close()}}},l={content:{html:'每次抽奖将消耗<span class="important"> '+i.costPoint+"积分</span>"},confirm:{html:"赌一把",click:function(){r.close(),n.onconfirm&&n.onconfirm()}},cancel:{html:"舍不得",click:function(){r.close()}}};"/v2/apps/shake"==location.pathname&&(l.content.html='每次抽奖将消耗<span class="important"> '+i.costPoint+"积分，确定参加吗？</span>",l.confirm.html="我要参加",l.cancel.html="进店逛逛",l.cancel.click=function(){r.close(),location.href=_apps_global.home_page_url});var a={content:{html:i.errorMsg},confirm:{html:"知道了",click:function(){r.close()}},cancel:"remove"};return n={check:e,setCancelText:t,onconfirm:$.noop}}(),appUtils.atLeast=function(t,e){function n(){r.resolve.apply(null,arguments)}var i,o=!1,r={};return setTimeout(function(){o?e.apply(null,i):r.resolve=function(){e.apply(null,arguments)}},t),r.resolve=function(){i=arguments,o=!0},{resolve:n}},appUtils.randInt=function(t,e){var n=t+Math.random()*(e-t);return parseInt(n,10)},appUtils.format=function(t){var e=Array.prototype.slice.call(arguments,1);return t.replace(/{(\d+)}/g,function(t,n){return void 0!==e[n]?e[n]:t})},appUtils.getUrlParam=function(t,e){var n=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i="router"===e?window.location.href:window.location.search,o=i.substr(1).match(n);return null!==o?window.unescape(o[2]):null},function(){function t(t){var e=Object.create(c);e.content={html:t},appUtils.modal.open(e)}function e(){return $._ajax({url:"/v2/apps/zodiac/zodiac.json",data:{alias:i.alias},defaultError:!1,cache:!1,type:"post",dataType:"json",timeout:5e3}).then(f,function(){return Q.reject("请求失败")})}function n(e){var n,i=u("flipped");if(e.hasWin)n=p.getSelected();else do{n=appUtils.randInt(0,12)}while(n==p.getSelected());return r.eq(n).addClass("prize"),e.detail_url&&(l.confirm={html:"查看奖品",click:function(){window.location.href=e.detail_url}},$(".js-view-prize").attr("href",e.detail_url)),i.start().delay(700).then(function(){e.hasWin?(l.content.html=e.str,appUtils.modal.open(l)):t(e.str)})}var i=window._apps_global,o={},r=$(".zodiac-item"),s=$(".zodiac"),c={content:{html:""},confirm:{html:"继续抽奖",click:function(){window.location.reload()}},cancel:"remove"},l={content:{html:""},cancel:{html:"继续抽奖",click:function(){window.location.reload()}},confirm:{html:"查看奖品",click:function(){window.location.href=_userCenterUrl}}},a=function(){function t(){e(),n=appUtils.randInt(0,12),r.eq(n).addClass("animated tada flaunt"),i=setTimeout(t,2500)}function e(){void 0!==n&&r.eq(n).removeClass("animated tada flaunt")}var n,i,o={};return o.start=function(){clearTimeout(i),t()},o.stop=function(){e(),clearTimeout(i)},o}(),h=function(){function t(){if(i--,r.eq(r.length-i-1).append(' <div class="zodiac-item-flip"><div class="zodiac-item-icon zodiac-item-icon-front"></div><div class="zodiac-item-icon zodiac-item-icon-back"></div></div>'),0===i)return void o.resolve();e=setTimeout(t,100)}var e,n={},i=r.length,o=Q.defer();return n.start=function(){return clearTimeout(e),t(),o.promise},n}(),u=function(t){function e(){var t;if(c.forEach(function(t,e){!l[e]&&p(t),l[e]=!0}),c.length==r.length)return h.resolve();c.forEach(function(e){t=r.index(e),n(t+3,i(t+3)),n(t-3,i(t-3)),t%3!=2&&n(t+1,i(t+1)),t%3!=0&&n(t-1,i(t-1))}),u=setTimeout(e,400)}function n(t,e){void 0!=e&&e.length>0&&!a[t]&&(c.push(e),a[t]=!0)}function i(t){return t<0?[]:r.eq(t)}function o(){var t=$(".zodiac-item.select");c=[t],a={},l={},a[r.index(t)]=!0,clearTimeout(u),e(),h=Q.defer()}function s(t,e){["webkit","moz","MS","o",""].forEach(function(n){""===n&&(t=t.toLowerCase()),e(n+t)})}var c,l,a,h,u,p,f={};return f.start=function(){return p=function(e){e.addClass(t)},o(),h.promise},f.vanish=function(){return p=function(e){s("AnimationIteration",function(n){e.off(n).on(n,function(){e.removeClass(t)})})},o(),h.promise},f},p=function(){var t,e={};return e.initSelectAction=function(){var e=Q.defer();return s.delegate(".zodiac-item","click",function(){var n=$(this);n.addClass("select"),t=n.index(),s.undelegate("click"),e.resolve()}),e.promise},e.getSelected=function(){return t},e}(),f=function(){var t=""===i.failedInfo?"哎呀，真可惜擦身而过!":i.failedInfo;return function(e){var n=Q.defer(),o={hasWin:!1,str:"",detail_url:null};if(0===e.code){var r=e.data,s="";switch(o.hasWin=!0,r.type){case 0:s=r.point+" 个积分";break;case 1:s=r.value+"元 店铺优惠券";break;case 2:s=r.title}o.str=appUtils.format('<span class="important">哇！抽中 {0}！</span>',s),void 0!=r.give_point&&0!=r.give_point&&(o.str+=appUtils.format('<br>手气这么好，再送你 <span class="important">{0} 积分</span>',r.give_point)),r.detail_url&&r.detail_url.length>0&&(o.detail_url=r.detail_url)}else o.hasWin=!1,2==i.lotteryAgain?o.str=e.msg||"运气不错，获得再玩一次":o.str=t,void 0!==i.givePoint&&0!==i.givePoint&&(o.str+=appUtils.format('<br>送你 <span class="important">{0} 积分</span>',i.givePoint));return n.resolve(o),n.promise}}();o.init=function(){h.start().then(a.start).then(p.initSelectAction).then(a.stop).then(e).then(n).fail(function(t){var e=appUtils.preset.errorModal;e.content=t,appUtils.modal.open(e)})},o.partialInit=function(){h.start()},window.gameIns=o}(),$(function(){$(window).scrollTop(0);var t=$(".zodiac-item"),e=function(t){appUtils.process.check()};appUtils.process.check()?gameIns.init():(gameIns.partialInit(),t.on("click",e)),appUtils.process.onconfirm=function(){t.unbind("click",e),gameIns.init()},_apps_global.hasPoint||$(".js-activity-note").remove()},!1);