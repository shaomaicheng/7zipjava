define("bower_components/zenjs/util/count_down",[],function(){function t(t){return t<10?"0"+t:""+t}function i(i,e,n,s,o){var h=0,a=0,r=0,l=0,c=0,d="",f=new Date,u=i.getTime()-f.getTime();if(u<=0)return o.stop(),e({seconds:0,text:"00:00:000",hour:0,min:0,sec:0,msec:0,day:0},{day:t(0),hour:t(0),min:t(0),sec:t(0),msec:t(0)}),void n();u>=864e5&&(h=Math.floor(u/864e5),u-=864e5*h,d+=h+"天"),u>=36e5&&(a=Math.floor(u/36e5),u-=36e5*a,d+=a+"小时"),u>=6e4?(r=Math.floor(u/6e4)%60,l=Math.floor(u/1e3)%60,c=u%1e3):(r=0,l=Math.floor(u/1e3),c=u%1e3),r<10&&(d+="0"),d+=r+"分",l<10&&(d+="0"),d+=l+"秒",c<10?d+="00":c<100&&(d+="0"),"second"!=s&&(d+=c),e({text:d,hour:a,min:r,sec:l,msec:c,day:h},{day:t(h),hour:t(a),min:t(r),sec:t(l),msec:t(c)})}function e(){this.tid=null,this.startTime=null}var n=function(){};return e.prototype={run:function(t){function e(){r.tid=setTimeout(e,"second"==t.step?1e3:50),i(a,o,h,t.step,r)}this.startTime||(this.startTime=Date.now());var s=t.seconds||0,o=t.onTimeChange||n,h=t.onTimeChangeEnd||n;this.startTime+=1e3*s;var a=new Date(this.startTime),r=this;e()},stop:function(){clearTimeout(this.tid)}},e}),define("bower_components/waterfall/pager",["require","zenjs/events"],function(t){var i=t("zenjs/events"),e=function(){};return i.extend({init:function(t){this.$el||(this.$el=$(t.el||t.$el||"<div></div>"),this.el=this.$el[0]),this.nLoading=t.loadingHTML?$(t.loadingHTML).addClass("loading-more"):$('<div class="loading-more"><span></span></div>'),this.nList=this.$el.find(".js-list"),0===this.nList.length&&(this.nList=$('<div class="js-list b-list"></div>'),this.$el.append(this.nList)),"number"==typeof t.total&&(this.total=t.total),this.offset=t.offset||300,this.scrollDirection="down",this.pageIndex=t.pageIndex||0,this.perPage=t.perPage||10,this.postData=t.postData||{},this.checkSize=!0,"boolean"==typeof t.checkSize&&(this.checkSize=t.checkSize),this.idName=t.idName||"id",t.idValue&&(this.idValue=t.idValue),this.jsonKeys=t.jsonKeys||{},this.finishedHTML=t.finishedHTML,this.finishedText=t.finishedText,this.emptyHTML=t.emptyHTML||"",this.emptyText=t.emptyText||"",this.getExtrPostData=t.getExtrPostData||e,this.onFetchError=t.onFetchError||e,this.onListEmpty=this.onListEmpty||t.onEmpty||this._onListEmpty,this.on("finished",t.onFinished||e),this.on("after:list:load",t.onAfterListLoad||t.onDataLoad||e),this.extraData={},this.scrollContainer=t.scrollContainer?$(t.scrollContainer):$("body"),this.scrollEventAccepter=t.scrollEventAccepter?$(t.scrollEventAccepter):$(t.scrollContainer||window),this._onScroll=$.proxy(this.onScroll,this),this.bindScrollFunc()},$:function(t){return this.$el.find(t)},onScroll:function(){function t(){var t=this.nList.offset(),i=this.scrollContainer.offset();return{left:t.left-i.left||0,top:t.top-i.top||0}}return function(){if(!(this.sleeping||this.finished||this.fetching)){if(0===this.total||this.total&&this.total<=this.pageIndex*this.perPage)return void this.doFinishLoading();var i=t.call(this);"down"===this.scrollDirection&&this.nList.height()+i.top-this.scrollEventAccepter.height()-this.scrollContainer.scrollTop()<this.offset&&this.fetchMore&&this.fetchMore(),"up"===this.scrollDirection&&this.scrollContainer.scrollTop()<this.offset&&this.fetchMore&&this.fetchMore()}}}(),fetchMore:function(){return this.sleeping||this.finished||this.fetching?this:(this.showLoading(),this.fetching=!0,this._fetchMore&&this._fetchMore.call(this),this)},onFetchMoreSuccess:function(){this.hideLoading(),this.fetching=!1,this._onFetchMoreSuccess.apply(this,arguments)},fetchRender:function(){return this.fetchMore(),this},_onFetchMoreError:function(){this.fetching=!1,this.hideLoading(),this.onFetchError()},doFinishLoading:function(t){this.finished=!0,this.fetching=!1,this.hideLoading(),this.$el.find(".list-finished").remove(),this.triggerMethod&&this.triggerMethod("finished",this.collection,t)},bindScrollFunc:function(){var t=this;this.scrollFunc&&this.unbindScrollFunc(),this.scrollFunc=function(){t.scrollTimeout&&clearTimeout(t.scrollTimeout),t.scrollTimeout=setTimeout(t._onScroll,200)},this.scrollEventAccepter.on("scroll",this.scrollFunc)},unbindScrollFunc:function(){this.scrollEventAccepter.off("scroll",this.scrollFunc),this.scrollFunc=null},doSleep:function(){this.sleeping=!0,this.unbindScrollFunc()},doWake:function(){this.sleeping=!1,this.bindScrollFunc(),this.fetchMore()},showLoading:function(){this.hasFetching=!0,this.$el.append(this.nLoading)},hideLoading:function(){this.nLoading.remove()},getFinishHtml:function(){return this.finishedHTML?$(this.finishedHTML).addClass("list-finished"):'<div class="list-finished">'+(this.finishedText||"已经没有更多了")+"</div>"},setExtraData:function(t){$.extend(this.extraData,t)},resetWaterfall:function(t){this.finished===!0&&this.$(".list-finished").remove(),this.removeAll&&this.removeAll(),this.nList.empty(),this.collection&&this.collection.reset([],{silent:!0}),this.listEl&&this.listEl.empty(),this.finished=!1,t&&t.pageIndex?this.pageIndex=t.pageIndex:this.pageIndex=0,this.idValue=void 0},_onListEmpty:function(){if(!this.fetching){var t;this.emptyHTML?t=$(this.emptyHTML).addClass("list-finished"):this.emptyText&&(t='<div class="list-finished">'+this.emptyText+"</div>"),this.$el.append(t)}},destroy:function(){this.doSleep(),this.$el.remove(),this.unbindScrollFunc()},remove:function(){this.destroy()}})}),define("bower_components/waterfall/waterfall_html",["require","bower_components/ajax/ajax","jquery","./pager"],function(t){t("bower_components/ajax/ajax");var i=t("jquery"),e=t("./pager");return e.extend({init:function(t){this.$el&&this.$el.find(".list-finished")&&this.$el.find(".list-finished").length>0||(this._super(t),void 0!==t.pageIndex?this.pageIndex=+t.pageIndex:this.pageIndex=1,this.url=t.url||"",this.ajaxType=t.ajaxType||"GET",this.dataType=t.dataType||"json",this.on("finished",this._doFinishLoading),this.onScroll())},_fetchMore:function(){var t=this,e={};this.perPage&&(e[this.jsonKeys.perPage||"perpage"]=this.perPage),this.idValue?e[this.idName]=this.idValue:e[this.jsonKeys.pageIndex||"page"]=this.pageIndex+1;var n=this.getExtrPostData?this.getExtrPostData():{};i._ajax({url:t.url,type:t.ajaxType,dataType:t.dataType,data:i.extend({},t.postData,e,n,t.extraData),timeout:5e3,success:function(i){t.pageIndex++,i&&0==i.code?t.onFetchMoreSuccess({},i||{}):t.doFinishLoading(i)},error:function(i,e,n){t._onFetchMoreError()}})},_onFetchMoreSuccess:function(t,i){var e=(i||{}).data||{};if(e[this.idName]&&(this.idValue=e[this.idName]),this.triggerMethod("after:list:load",e.html||"",i),!e.html)return this.pageIndex--,void this.doFinishLoading(i);this.onScroll()},_doFinishLoading:function(){if(0==this.pageIndex&&this.triggerMethod("list:empty"),this.hasFetching&&this.pageIndex>2){var t=this.getFinishHtml();this.$el.append(t)}}})}),require(["bower_components/zenjs/util/count_down","bower_components/waterfall/waterfall_html"],function(t,i){new(Backbone.View.extend({initialize:function(t){this._global=t._global||{};var e=this,n=e.$(".js-waterfall"),s=n.find(".js-list"),o=s.find(".js-joingroup-countdown");e.initCountDownItems(o),new i({el:n,url:"/v2/ump/groupon/joingroups.json",postData:{kdt_id:e._global.kdt_id,id:e._global.activity_id},onDataLoad:function(t){var i=$(t),n=i.find(".js-joingroup-countdown");e.initCountDownItems(n),s.append(i)},onFinished:function(){n.append(['<div class="joingroup-list-finished">','<p class="desc-text">>_<  没有更多凑团啦～<br>依靠自己勤劳的双手，自己当团长吧</p>','<a href="'+e._global.all_groupons_url+'" class="tag tag-red tag-all-groupons">查看全部拼团商品</a>',"</div>"].join(""))},finishedHTML:"<div></div>"})},initCountDownItems:function(t){var i=this;t.each(function(t,e){i.initCountDown(e)})},initCountDown:function(i){var e=$(i),n=new t,s=e.data("seconds");n.run({onTimeChange:function(t,i){var n=parseInt(t.hour,10),s=parseInt(t.day,10),o=n+24*s,h=o<10?"0"+o:""+o,a='<span class="c-red">'+h+":"+i.min+":"+i.sec;e.html(a)},onTimeChangeEnd:function(){e.closest(".js-joingroup-desc").html("哎呀，活动已结束")},step:"seconds",seconds:s})}}))({el:$("body"),_global:window._global})}),define("main",function(){});