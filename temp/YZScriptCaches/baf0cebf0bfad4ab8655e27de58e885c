define("bower_components/waterfall/pager",["require","zenjs/events"],function(t){var e=t("zenjs/events"),i=function(){};return e.extend({init:function(t){this.$el||(this.$el=$(t.el||t.$el||"<div></div>"),this.el=this.$el[0]),this.nLoading=t.loadingHTML?$(t.loadingHTML).addClass("loading-more"):$('<div class="loading-more"><span></span></div>'),this.nList=this.$el.find(".js-list"),0===this.nList.length&&(this.nList=$('<div class="js-list b-list"></div>'),this.$el.append(this.nList)),"number"==typeof t.total&&(this.total=t.total),this.offset=t.offset||300,this.scrollDirection="down",this.pageIndex=t.pageIndex||0,this.perPage=t.perPage||10,this.postData=t.postData||{},this.checkSize=!0,"boolean"==typeof t.checkSize&&(this.checkSize=t.checkSize),this.idName=t.idName||"id",t.idValue&&(this.idValue=t.idValue),this.jsonKeys=t.jsonKeys||{},this.finishedHTML=t.finishedHTML,this.finishedText=t.finishedText,this.emptyHTML=t.emptyHTML||"",this.emptyText=t.emptyText||"",this.getExtrPostData=t.getExtrPostData||i,this.onFetchError=t.onFetchError||i,this.onListEmpty=this.onListEmpty||t.onEmpty||this._onListEmpty,this.on("finished",t.onFinished||i),this.on("after:list:load",t.onAfterListLoad||t.onDataLoad||i),this.extraData={},this.scrollContainer=t.scrollContainer?$(t.scrollContainer):$("body"),this.scrollEventAccepter=t.scrollEventAccepter?$(t.scrollEventAccepter):$(t.scrollContainer||window),this._onScroll=$.proxy(this.onScroll,this),this.bindScrollFunc()},$:function(t){return this.$el.find(t)},onScroll:function(){function t(){var t=this.nList.offset(),e=this.scrollContainer.offset();return{left:t.left-e.left||0,top:t.top-e.top||0}}return function(){if(!(this.sleeping||this.finished||this.fetching)){if(0===this.total||this.total&&this.total<=this.pageIndex*this.perPage)return void this.doFinishLoading();var e=t.call(this);"down"===this.scrollDirection&&this.nList.height()+e.top-this.scrollEventAccepter.height()-this.scrollContainer.scrollTop()<this.offset&&this.fetchMore&&this.fetchMore(),"up"===this.scrollDirection&&this.scrollContainer.scrollTop()<this.offset&&this.fetchMore&&this.fetchMore()}}}(),fetchMore:function(){return this.sleeping||this.finished||this.fetching?this:(this.showLoading(),this.fetching=!0,this._fetchMore&&this._fetchMore.call(this),this)},onFetchMoreSuccess:function(){this.hideLoading(),this.fetching=!1,this._onFetchMoreSuccess.apply(this,arguments)},fetchRender:function(){return this.fetchMore(),this},_onFetchMoreError:function(){this.fetching=!1,this.hideLoading(),this.onFetchError()},doFinishLoading:function(t){this.finished=!0,this.fetching=!1,this.hideLoading(),this.$el.find(".list-finished").remove(),this.triggerMethod&&this.triggerMethod("finished",this.collection,t)},bindScrollFunc:function(){var t=this;this.scrollFunc&&this.unbindScrollFunc(),this.scrollFunc=function(){t.scrollTimeout&&clearTimeout(t.scrollTimeout),t.scrollTimeout=setTimeout(t._onScroll,200)},this.scrollEventAccepter.on("scroll",this.scrollFunc)},unbindScrollFunc:function(){this.scrollEventAccepter.off("scroll",this.scrollFunc),this.scrollFunc=null},doSleep:function(){this.sleeping=!0,this.unbindScrollFunc()},doWake:function(){this.sleeping=!1,this.bindScrollFunc(),this.fetchMore()},showLoading:function(){this.hasFetching=!0,this.$el.append(this.nLoading)},hideLoading:function(){this.nLoading.remove()},getFinishHtml:function(){return this.finishedHTML?$(this.finishedHTML).addClass("list-finished"):'<div class="list-finished">'+(this.finishedText||"已经没有更多了")+"</div>"},setExtraData:function(t){$.extend(this.extraData,t)},resetWaterfall:function(t){this.finished===!0&&this.$(".list-finished").remove(),this.removeAll&&this.removeAll(),this.nList.empty(),this.collection&&this.collection.reset([],{silent:!0}),this.listEl&&this.listEl.empty(),this.finished=!1,t&&t.pageIndex?this.pageIndex=t.pageIndex:this.pageIndex=0,this.idValue=void 0},_onListEmpty:function(){if(!this.fetching){var t;this.emptyHTML?t=$(this.emptyHTML).addClass("list-finished"):this.emptyText&&(t='<div class="list-finished">'+this.emptyText+"</div>"),this.$el.append(t)}},destroy:function(){this.doSleep(),this.$el.remove(),this.unbindScrollFunc()},remove:function(){this.destroy()}})}),define("bower_components/waterfall/waterfall_html",["require","bower_components/ajax/ajax","jquery","./pager"],function(t){t("bower_components/ajax/ajax");var e=t("jquery"),i=t("./pager");return i.extend({init:function(t){this.$el&&this.$el.find(".list-finished")&&this.$el.find(".list-finished").length>0||(this._super(t),void 0!==t.pageIndex?this.pageIndex=+t.pageIndex:this.pageIndex=1,this.url=t.url||"",this.ajaxType=t.ajaxType||"GET",this.dataType=t.dataType||"json",this.on("finished",this._doFinishLoading),this.onScroll())},_fetchMore:function(){var t=this,i={};this.perPage&&(i[this.jsonKeys.perPage||"perpage"]=this.perPage),this.idValue?i[this.idName]=this.idValue:i[this.jsonKeys.pageIndex||"page"]=this.pageIndex+1;var s=this.getExtrPostData?this.getExtrPostData():{};e._ajax({url:t.url,type:t.ajaxType,dataType:t.dataType,data:e.extend({},t.postData,i,s,t.extraData),timeout:5e3,success:function(e){t.pageIndex++,e&&0==e.code?t.onFetchMoreSuccess({},e||{}):t.doFinishLoading(e)},error:function(e,i,s){t._onFetchMoreError()}})},_onFetchMoreSuccess:function(t,e){var i=(e||{}).data||{};if(i[this.idName]&&(this.idValue=i[this.idName]),this.triggerMethod("after:list:load",i.html||"",e),!i.html)return this.pageIndex--,void this.doFinishLoading(e);this.onScroll()},_doFinishLoading:function(){if(0==this.pageIndex&&this.triggerMethod("list:empty"),this.hasFetching&&this.pageIndex>2){var t=this.getFinishHtml();this.$el.append(t)}}})}),define("wap/fenxiao/components/wxd_waterfall_html",["require","bower_components/waterfall/waterfall_html"],function(t){var e=t("bower_components/waterfall/waterfall_html");return e.extend({_onFetchMoreSuccess:function(t,e){var i=(e||{}).data||{};if(i[this.idName]&&(this.idValue=i[this.idName]),this.triggerMethod("after:list:load",i.list||"",e),!i.list.length)return this.pageIndex--,void this.doFinishLoading(e);this.onScroll()}})}),define("wap/fenxiao/components/log",[],function(){var t=function(){};return{displayLog:function(e,i){i=i||t;var s={fm:"display",display_goods:e.display_goods,spm:"wxdatv-"+e.activity_id,target:"wxd",seller_kdt_id:e.seller_kdt_id,title:e.title||document.title,result_from:e.result_from||"",result_number:e.result_number||""};window.Logger&&window.Logger.log(s).done(i)},beforeAddLog:function(e,i){i=i||t;var s={fm:"click",click_type:"wxd_before_add",seller_kdt_id:e.seller_kdt_id,display_goods:e.display_goods,spm:"wxdatv-"+e.activity_id,target:"wxd",title:e.title||document.title,result_from:e.result_from||"",result_number:e.result_number||""};window.Logger&&window.Logger.log(s).done(i)},gotoDetailLog:function(e,i){i=i||t;var s={fm:"display",display_goods:e.display_goods,spm:"wxdatv-"+e.activity_id+"_wxdg"+e.kdt_goods_id,target:"wxd",seller_kdt_id:e.seller_kdt_id,title:e.title||document.title,result_from:e.result_from||"",result_number:e.result_number||""};window.Logger&&window.Logger.log(s).done(i)},addGoodsSuccessLog:function(e,i){i=i||t;var s={fm:"click",click_type:"wxd_add",seller_kdt_id:e.seller_kdt_id,display_goods:e.display_goods,spm:"wxdatv-"+e.activity_id,target:"wxd",title:e.title||document.title,result_from:e.result_from||"",result_number:e.result_number||""};window.Logger&&window.Logger.log(s).done(i)}}}),define("wap/fenxiao/components/wxd_list_common_operate",["require","exports","module","zenjs/class","bower_components/youzanjsbridge/api","wap/fenxiao/components/log","zenjs/util/args","zenjs/util/ua"],function(t,e,i){var s=t("zenjs/class"),o=t("bower_components/youzanjsbridge/api"),a=t("wap/fenxiao/components/log"),n=t("zenjs/util/args"),d=t("zenjs/util/ua"),l=_global.access_token||n.get("access_token");i.exports=s.extend({init:function(t){t=t||{},this.wrap=t.wrap||"body",this.operateClassName=t.operateClassName||".js-operate-btn",this.gotoDetailClassName=t.gotoDetailClassName||".js-goto-detail",this.needAddGoodsOtherInfo=t.needAddGoodsOtherInfo||!1,this.needGotoDetailOtherInfo=t.needGotoDetailOtherInfo||!1,this.canAddGoods=!0,this.banAddGoodsTip=t.banAddGoodsTip||!1,this.initAddGoods(),this.initGotoDetail()},initAddGoods:function(){var t=this;this.initAddGoodsListen(),$(this.wrap).on("click",this.operateClassName,function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var i=$(this).parents(t.gotoDetailClassName).data()||{};i.seller_goods_alias?t.addGoodsItem(i):t.canAddGoods?a.beforeAddLog({seller_kdt_id:_global.kdt_id||0,display_goods:i.kdt_goods_id,activity_id:i.activity_id||0,title:i.title||document.title},function(){t.addGoodsItem(i)}):t.banAddGoodsTip&&motify.log(t.banAddGoodsTip)})},initGotoDetail:function(){$(this.wrap).on("click",this.gotoDetailClassName,function(t){t.preventDefault(),t.stopPropagation();var e=$(this).data(),i=_global.url.wap+"/showcase_fenxiao/goods/active",s={};i=n.add(i,{alias:e.alias}),l&&(i=n.add(i,{access_token:l})),this.needGotoDetailOtherInfo&&$.each(this.needGotoDetailOtherInfo,function(t,i){s[i]=e.value}),a.gotoDetailLog({display_goods:e.kdt_goods_id,activity_id:e.activity_id||0,kdt_goods_id:e.kdt_goods_id,seller_kdt_id:_global.kdt_id||0,title:e.title||document.title},function(){d.isWxd()?o.gotoWebview($.extend({page:"web",url:i},s)):window.location.href=i})})},setCanAddGoods:function(t){this.canAddGoods=t},addGoodsItem:function(t){o.gotoNative({page:"addGoods",alias:t.alias,seller_goods_alias:t.seller_goods_alias})},initAddGoodsListen:function(){var t=this;o.on("addGoodsSuccess",function(e){var i=e.alias,s=$(t.gotoDetailClassName+'[data-alias="'+i+'"]'),o=s.data();s.data("seller_goods_alias",e.seller_goods_alias),s.find(t.operateClassName).addClass("added").removeClass("add"),a.addGoodsSuccessLog({seller_kdt_id:_global.kdt_id,display_goods:o.kdt_goods_id,activity_id:o.activity_id||0,title:o.title||document.title})})}})}),define("text!wap/fenxiao/common/templates/wxd_goods_list_1.html",[],function(){return'<% _.each(list,function(item){ %>\n    <div class="block-item name-card js-goto-detail"\n        data-alias="<%= item.alias %>"\n        data-kdt_goods_id="<%= item.kdt_goods_id %>"\n        data-seller_goods_alias="<%= item.seller_goods_alias %>"\n        data-kdt_id="<%= item.kdt_id %>"\n        data-activity_id="<%= item.activity_id %>"\n        data-title="<%= item.title %>"\n    >\n        <div class="thumb">\n            <img class="img" src="<% if(item.thumb_image){%><%= item.thumb_image %><% }else if(item.image_url){ %><%= item.image_url %> <% } %>" />\n        </div>\n        <div class="detail clearfix">\n            <h3 class="title ellipsis"><%= item.title %></h3>\n            <p class="item">库存<%= item.stock_num %>件，<%= item.fx_count %>人分销</p>\n            <p class="item">建议售价：¥<%= item.suggest_retail_price %></p>\n            <p class="item profit">平均利润：<span class="c-red">¥<%= item.average_profit %></span> /件</p>\n        </div>\n        <% if ((item.seller_goods_alias && item.seller_goods_alias !== \'\') || item.is_added !== false) { %>\n            <span class="opt added js-operate-btn"></span>\n        <% } else { %>\n            <span class="opt add js-operate-btn"></span>\n        <% } %>\n    </div>\n<% }) %>\n'}),define("text!wap/fenxiao/common/templates/wxd_goods_list_1_time.html",[],function(){return'<% _.each(list,function(item){ %>\n    <% if(time !== item.created_time){ %>\n        <p class="create-time"><%= item.created_time %></p>\n        <% time = item.created_time %>\n    <% } %>\n    <div class="block-item name-card js-goto-detail"\n        data-alias="<%= item.alias %>"\n        data-kdt_goods_id="<%= item.kdt_goods_id %>"\n        data-seller_goods_alias="<%= item.seller_goods_alias %>"\n        data-kdt_id="<%= item.kdt_id %>"\n        data-activity_id="<%= item.activity_id %>"\n        data-title="<%= item.title %>"\n    >\n        <div class="thumb">\n            <img class="img" src="<%= item.image_url %>" />\n        </div>\n        <div class="detail clearfix">\n            <h3 class="title ellipsis"><%= item.title %></h3>\n            <p class="item">库存<%= item.stock_num %>件，<%= item.fx_count %>人分销</p>\n            <p class="item">建议售价：¥<%= item.suggest_retail_price %></p>\n            <p class="item profit">平均利润：<span class="c-red">¥<%= item.average_profit %></span> /件</p>\n        </div>\n        <% if (item.seller_goods_alias !== \'\') { %>\n            <span class="opt added js-operate-btn"></span>\n        <% } else { %>\n            <span class="opt add js-operate-btn"></span>\n        <% } %>\n    </div>\n<% }) %>\n'}),require(["zenjs/util/args","wap/fenxiao/components/wxd_waterfall_html","wap/fenxiao/components/wxd_list_common_operate","wap/fenxiao/components/log","text!wap/fenxiao/common/templates/wxd_goods_list_1.html","text!wap/fenxiao/common/templates/wxd_goods_list_1_time.html"],function(t,e,i,s,o,a){var n=_global.access_token||t.get("access_token");new(Backbone.View.extend({el:"body",events:{"click .js-select-goods-list":"renderGoodsList"},initialize:function(){this.waterfalls=[],this.order=0,this.goodsListTpl=_.template(o),this.newGoodsListTpl=_.template(a),this.renderGoodsListFunc={goods:this.showAllGoods.bind(this),new:this.showNewGoods.bind(this),profit:this.showProfitGoods.bind(this)},new i,this.showAllGoods()},initGoodsList:function(t){var e=this,i=["goods","new","asc","desc"],s=["goods","new","profit"];_.each(i,function(t){e.waterfalls[t]&&(e.waterfalls[t].doSleep(),e.waterfalls[t].resetWaterfall())}),t&&(_.each(s,function(t){$(".js-"+t+"-list").addClass("hide")}),$(".js-"+t+"-list").removeClass("hide")),this.$('.js-select-goods-list[data-type="profit"]').removeClass("profit-desc profit-asc")},renderGoodsList:function(t){var e=$(t.currentTarget),i=e.data("type");e.hasClass("active")&&"profit"!==i||("profit"!==i&&(this.order=0),this.initGoodsList(i),this.$(".js-select-goods-list").removeClass("active"),e.addClass("active"),this.renderGoodsListFunc[i](i))},showAllGoods:function(t){var i=this;t||(t="goods"),this.waterfalls[t]?this.waterfalls[t].doWake():this.waterfalls[t]=new e({el:$(".js-goods-list"),url:"/v2/fenxiao/enterprise/supplierGoodsList.json",postData:{access_token:n},perPage:10,pageIndex:0,onDataLoad:function(t,e){i.$(".js-goods-list").find(".js-list").append(i.goodsListTpl({list:t})),i.addGoodsListLog(e)},emptyText:""}).fetchRender()},showNewGoods:function(t){if(this.waterfalls[t])this.waterfalls[t].doWake();else{var i=this;this.waterfalls[t]=new e({el:$(".js-new-list"),url:"/v2/fenxiao/enterprise/supplierGoodsList.json",postData:{access_token:n,order_by:"created_at",order:"desc"},perPage:10,pageIndex:0,onDataLoad:function(t,e){i.$(".js-new-list").find(".js-list").append(i.newGoodsListTpl({list:t,time:""})),i.addGoodsListLog(e)},emptyText:""}).fetchRender()}},showProfitGoods:function(t){if(this.order%2)if(this.$('.js-select-goods-list[data-type="profit"]').removeClass("profit-desc").addClass("profit-asc"),this.waterfalls.asc)this.waterfalls.asc.doWake();else{var i=this;this.waterfalls.asc=new e({el:$(".js-profit-list"),url:"/v2/fenxiao/enterprise/supplierGoodsList.json",postData:{access_token:n,order:"asc",order_by:"average_profit"},perPage:10,pageIndex:0,onDataLoad:function(t,e){i.$(".js-profit-list").find(".js-list").append(i.goodsListTpl({list:t})),i.addGoodsListLog(e)},emptyText:""}).fetchRender()}else if(this.$('.js-select-goods-list[data-type="profit"]').removeClass("profit-asc").addClass("profit-desc"),this.waterfalls.desc)this.waterfalls.desc.doWake();else{var i=this;this.waterfalls.desc=new e({el:$(".js-profit-list"),url:"/v2/fenxiao/enterprise/supplierGoodsList.json",postData:{access_token:n,order:"desc",order_by:"average_profit"},perPage:10,pageIndex:0,onDataLoad:function(t,e){i.$(".js-profit-list").find(".js-list").append(i.goodsListTpl({list:t})),i.addGoodsListLog(e)},emptyText:""}).fetchRender()}this.order+=1},addGoodsListLog:function(t){var e,i=[];if(0===t.code){e=t.data.list;for(var o=0;o<e.length;o++)i.push(e[o].kdt_goods_id)}s.displayLog({display_goods:i.join(","),activity_id:0,seller_kdt_id:_global.kdt_id,title:"企业商品库"})}}))}),define("main",function(){});