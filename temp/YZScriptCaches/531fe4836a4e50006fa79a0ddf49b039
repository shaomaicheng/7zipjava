!function(t){"use strict";!function(t){function i(t,i){var e=Array.prototype.slice.call(arguments,2);return setTimeout(function(){return t.apply(null,e)},i)}function e(t,i){return i=i||100,function(){if(!t.debouncing){var e=Array.prototype.slice.apply(arguments);t.lastReturnVal=t.apply(window,e),t.debouncing=!0}return clearTimeout(t.debounceTimeout),t.debounceTimeout=setTimeout(function(){t.debouncing=!1},i),t.lastReturnVal}}function s(t){return 0===t.offsetWidth&&0===t.offsetHeight}function n(t){for(var i=[],e=t.parentNode;s(e);)i.push(e),e=e.parentNode;return i}function o(t,i){var e=n(t),s=e.length,o=[],a=t[i];if(s){for(var r=0;r<s;r++)o[r]=e[r].style.display,e[r].style.display="block",e[r].style.height="0",e[r].style.overflow="hidden",e[r].style.visibility="hidden";a=t[i];for(var h=0;h<s;h++)e[h].style.display=o[h],e[h].style.height="",e[h].style.overflow="",e[h].style.visibility=""}return a}function a(s,n){if(this.$window=t(window),this.$document=t(document),this.$element=t(s),this.options=t.extend({},u,n),this._defaults=u,this._name=r,this.startEvent=this.options.startEvent.join("."+r+" ")+"."+r,this.moveEvent=this.options.moveEvent.join("."+r+" ")+"."+r,this.endEvent=this.options.endEvent.join("."+r+" ")+"."+r,this.polyfill=this.options.polyfill,this.onInit=this.options.onInit,this.onSlide=this.options.onSlide,this.onSlideEnd=this.options.onSlideEnd,this.polyfill&&d)return!1;this.identifier="js-"+r+"-"+l++,this.min=parseFloat(this.$element[0].getAttribute("min")||0),this.max=parseFloat(this.$element[0].getAttribute("max")||100),this.value=parseFloat(this.$element[0].value||this.min+(this.max-this.min)/2),this.step=parseFloat(this.$element[0].getAttribute("step")||1),this.toFixed=(this.step+"").replace(".","").length-1,this.$fill=t('<div class="'+this.options.fillClass+'" />'),this.$handle=t('<div class="'+this.options.handleClass+'" />'),this.$range=t('<div class="'+this.options.rangeClass+'" id="'+this.identifier+'" />').insertAfter(this.$element).prepend(this.$fill,this.$handle),this.$element.css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",opacity:"0"}),this.handleDown=t.proxy(this.handleDown,this),this.handleMove=t.proxy(this.handleMove,this),this.handleEnd=t.proxy(this.handleEnd,this),this.init();var o=this;this.$window.on("resize."+r,e(function(){i(function(){o.update()},300)},20)),this.$document.on(this.startEvent,"#"+this.identifier+":not(."+this.options.disabledClass+")",this.handleDown),this.$element.on("change."+r,function(t,i){if(!i||i.origin!==r){var e=t.target.value,s=o.getPositionFromValue(e);o.setPosition(s)}})}var r="rangeslider",h=[],l=0,d=function(){var t=document.createElement("input");return t.setAttribute("type","range"),"text"!==t.type}(),u={polyfill:!0,rangeClass:"rangeslider",disabledClass:"rangeslider--disabled",fillClass:"rangeslider__fill",handleClass:"rangeslider__handle",startEvent:["mousedown","touchstart","pointerdown"],moveEvent:["mousemove","touchmove","pointermove"],endEvent:["mouseup","touchend","pointerup"]};a.prototype.init=function(){this.onInit&&"function"==typeof this.onInit&&this.onInit(),this.update()},a.prototype.setMax=function(t){this.max=t},a.prototype.update=function(){this.handleWidth=o(this.$handle[0],"offsetWidth"),this.rangeWidth=o(this.$range[0],"offsetWidth"),this.maxHandleX=this.rangeWidth-this.handleWidth,this.grabX=this.handleWidth/2,this.position=this.getPositionFromValue(this.value),this.$element[0].disabled?this.$range.addClass(this.options.disabledClass):this.$range.removeClass(this.options.disabledClass),this.setPosition(this.position)},a.prototype.handleDown=function(t){if(t.preventDefault(),this.$document.on(this.moveEvent,this.handleMove),this.$document.on(this.endEvent,this.handleEnd),!((" "+t.target.className+" ").replace(/[\n\t]/g," ").indexOf(this.options.handleClass)>-1)){var i=this.getRelativePosition(t),e=this.$range[0].getBoundingClientRect().left,s=this.getPositionFromNode(this.$handle[0])-e;this.setPosition(i-this.grabX),i>=s&&i<s+this.handleWidth&&(this.grabX=i-s)}},a.prototype.setStatus=function(t){this.__status=t},a.prototype.getStatus=function(t){return this.__status},a.prototype.handleMove=function(t){t.preventDefault();var i=this.getRelativePosition(t);this.setPosition(i-this.grabX),this.setStatus("MOVE")},a.prototype.handleEnd=function(t){t.preventDefault(),this.$document.off(this.moveEvent,this.handleMove),this.$document.off(this.endEvent,this.handleEnd),this.setStatus(void 0),this.onSlideEnd&&"function"==typeof this.onSlideEnd&&this.onSlideEnd(this.position,this.value)},a.prototype.cap=function(t,i,e){return t<i?i:t>e?e:t},a.prototype.setPosition=function(t){var i,e;i=this.getValueFromPosition(this.cap(t,0,this.maxHandleX)),e=this.getPositionFromValue(i),this.$fill[0].style.width=e+this.grabX+"px",this.$handle[0].style.left=e+"px",this.setValue(i),this.position=e,this.value=i,this.onSlide&&"function"==typeof this.onSlide&&this.onSlide(e,i)},a.prototype.getPositionFromNode=function(t){for(var i=0;null!==t;)i+=t.offsetLeft,t=t.offsetParent;return i},a.prototype.getRelativePosition=function(t){var i=this.$range[0].getBoundingClientRect().left,e=0;return t.originalEvent=t.originalEvent||t,void 0!==t.pageX&&0!==t.pageX?e=t.pageX:void 0!==t.originalEvent.clientX?e=t.originalEvent.clientX:t.originalEvent.touches&&t.originalEvent.touches[0]&&void 0!==t.originalEvent.touches[0].clientX?e=t.originalEvent.touches[0].clientX:t.currentPoint&&void 0!==t.currentPoint.x&&(e=t.currentPoint.x),e-i},a.prototype.getPositionFromValue=function(t){var i;return i=(t-this.min)/(this.max-this.min),i*this.maxHandleX},a.prototype.getValueFromPosition=function(t){var i,e;return i=t/(this.maxHandleX||1),e=this.step*Math.round(i*(this.max-this.min)/this.step)+this.min,Number(e.toFixed(this.toFixed))},a.prototype.setValue=function(t){t!==this.value&&this.$element.val(t).trigger("change",{origin:r})},a.prototype.destroy=function(){this.$document.off(this.startEvent,"#"+this.identifier,this.handleDown),this.$element.off("."+r).removeAttr("style").removeData("plugin_"+r),this.$range&&this.$range.length&&this.$range[0].parentNode.removeChild(this.$range[0]),h.splice(h.indexOf(this.$element[0]),1),h.length||this.$window.off("."+r)},t.fn[r]=function(i){return this.each(function(){var e=t(this),s=e.data("plugin_"+r);s||(e.data("plugin_"+r,s=new a(this,i)),h.push(this)),"string"==typeof i&&s[i]()})}}($)}(),define("wap/showcase/modules/audio/rangeslider",function(){}),define("wap/showcase/modules/audio/audio",["require","wap/showcase/modules/audio/rangeslider"],function(t){t("wap/showcase/modules/audio/rangeslider"),function(){var t="custom-audio-status-loading",i="custom-audio-status-play",e="custom-audio-status-stop",s="custom-audio-status-pause",n=function(){},o=function(t){if(!(this instanceof o))return new o(t);this.target=t.target,this.$target=$(this.target),this.$trigger=this.$target.find(".js-trigger"),this.$trigger.length<=0&&(this.$trigger=this.$target),this.$duration=this.$target.find(".js-duration"),this.$currentTime=this.$target.find(".js-current-time"),this.$percentage=this.$target.find(".js-percentage"),this.$status=this.$target.find(".js-status"),this.$loading=this.$target.find(".js-loading"),this.$title=this.$target.find(".js-title"),this.pureSrc=this.$target.data("src");var i="";if(/\.amr$/.test(this.pureSrc)&&(i="?avthumb/mp3/ab/64k/writeXing/0"),this.src=this.pureSrc+i,this.reload=this.$target.data("reload"),this.loop=this.$target.data("loop"),this.callback={},this.callback.play=t.play||n,this.callback.pause=t.pause||n,this.callback.stop=t.stop||n,this.$target.length<=0)throw new Error("音频DOM对象不能为空");if(!this.src)throw new Error("音频文件地址不能为空");this.audio=new Audio,this.$audio=$(this.audio),this.init(),o._cache.indexOf(this)<0&&o._cache.push(this)};o._cache=[],o.prototype={init:function(){this.addEvent()},initRangeSlider:function(){var t=this;this.$percentage.attr("max",this._duration),this.$percentage.rangeslider({polyfill:!1,onSlide:function(i,e){t._updateCurrentTime(e)},onSlideEnd:function(i,e){t.audio.currentTime=e}})},leading:function(t){return 1===t.toString().length?"0":""},getDuration:function(){if(!this._duration){var t=this.pureSrc;return t=t.split("?")[0]+"?avinfo",$._ajax({url:t,dataType:"json"})}},_updateDuration:function(t){var i=parseInt(t/60,10),e=parseInt(t%60,10),s=this.leading(i)+i+":"+this.leading(e)+e;this.$duration.text(s)},updateCurrentTime:function(t){var i=t.target,e=Math.floor(+i.currentTime),s=Math.floor(+i.duration),n=this.$percentage.data("plugin_rangeslider");if(s!==this._duration&&(this._duration=s,n&&n.length>0&&n.setMax(s)),!isNaN(s)){if(this.loaded(),n&&n.length>0){if(n.getStatus())return}this._updateCurrentTime(e)}},_updateCurrentTime:function(t){var i=parseInt(t/60,10),e=parseInt(t%60,10),s=this.leading(i)+i+":"+this.leading(e)+e+"/";this.$currentTime.text(s)},updatePercentage:function(t){if(!(this.$percentage.length<1)){if(!this.$percentage.data("plugin_rangeslider").getStatus()){var i=t.target,e=Math.floor(+i.currentTime);this.$percentage.val(e).change()}}},showStatus:function(t){this.$title.hide(),this.$status.text(t).show()},clearStatus:function(){this.$title.show(),this.$status.hide(),this.$status.text("")},loading:function(){this.$loading.css("display","block"),this.$target.addClass(t)},loaded:function(){this.$loading.css("display","none"),"PLAY"===this._status&&(this.$target.addClass(i),this.$target.removeClass(s),this.$target.removeClass(e),this.$target.removeClass(t))},addEvent:function(){var n=this;this.$audio.on("play",function(t){n.clearStatus()}),this.$audio.on("canplay",function(){n._loaded||n.durationDefer.done(function(t){var i=Math.floor(+t.format.duration);n._duration=i,n.initRangeSlider(),n._updateDuration(i),n._isLoading=!1,n._loaded=!0,n.loaded(),n.play()})}),this.$audio.on("timeupdate",function(t){n.updateCurrentTime(t),n.updatePercentage(t)}),this.$audio.on("error",function(o){n.showStatus("加载失败，点击重试"),n._loaded=!1,n._status="ERROR",n.$loading.css("display","none"),n.$target.removeClass(i),n.$target.removeClass(s),n.$target.removeClass(e),n.$target.removeClass(t)}),this.$audio.on("ended",function(t){n.stop()}),this.$trigger.on("click",function(){if(!n._isLoading)return n._loaded?void("PLAY"!==n._status?n.play():n.reload?n.stop():n.pause()):(n._isLoading=!0,void n.load())})},load:function(){this.loading(),this.durationDefer=this.getDuration();var t={loop:this.loop,preload:"auto",src:this.src};for(var i in t)t.hasOwnProperty(i)&&i in this.audio&&(this.audio[i]=t[i]);this.audio.load()},play:function(){if("PLAY"!==this._status){for(var t=0;t<o._cache.length;t++)o._cache[t]!==this&&o._cache[t].stop();this.audio.play(),this._status="PLAY",this.callback.play()}},pause:function(){"PLAY"===this._status&&(this.audio.pause(),this._status="PAUSE",this.callback.pause(),this.$target.addClass(s),this.$target.removeClass(i),this.$target.removeClass(e))},stop:function(){"PLAY"===this._status&&(this.audio.pause(),this.audio.currentTime=0,this._status="STOP",this.callback.stop(),this.$target.addClass(e),this.$target.removeClass(s),this.$target.removeClass(i))}},o.prototype.constructor=o,$.fn.audioPlayer=function(t){t=t||{},$.each(this,function(i,e){var s=$.extend({target:e},t);o(s)})}}()}),require(["wap/showcase/modules/audio/audio"],function(){$(".js-audio").audioPlayer()}),define("main",function(){});