define("zenjs/util/number",[],function(){return{makeRandomString:function(i){var t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";i=i||10;for(var n=0;n<i;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}}}),define("bower_components/pop/pop",["require","zenjs/events","zenjs/util/number"],function(i){var t=function(){},e=i("zenjs/events"),n=i("zenjs/util/number");return window.zenjs=window.zenjs||{},e.extend({init:function(i){this._window=$(window);var e=n.makeRandomString();$("body").append('<div id="'+e+'"                 style="display:none; height: 100%;                 position: fixed; top: 0; left: 0; right: 0;                background-color: rgba(0, 0, 0, '+(i.transparent||".7")+');z-index:1000;opacity:0;transition: opacity ease 0.2s;"></div>'),this.nBg=$("#"+e),this.nBg.on("click",$.proxy(function(){this.isCanNotHide||this.hide()},this));var o=n.makeRandomString();$("body").append('<div id="'+o+'" class="'+(i.className||"")+'" style="overflow:hidden;visibility: hidden;"></div>'),this.nPopContainer=$("#"+o),this.nPopContainer.hide(),this.nPopContainer.css({opacity:0,position:"absolute","z-index":1e3}),i.contentViewClass&&(this.contentViewClass=i.contentViewClass,this.contentViewOptions=$.extend({el:this.nPopContainer},i.contentViewOptions||{}),this.contentView=new this.contentViewClass($.extend({onHide:$.proxy(this.hide,this)},this.contentViewOptions)),this.contentView.onHide=$.proxy(this.hide,this)),this.animationTime=i.animationTime||300,this.isCanNotHide=i.isCanNotHide,this.doNotRemoveOnHide=i.doNotRemoveOnHide||!1,this.onShow=i.onShow||t,this.onHide=i.onHide||t,this.onFinishHide=i.onFinishHide||t,this.html=i.html},render:function(i){return this.renderOptions=i||{},this.contentViewClass?this.contentView.render(this.renderOptions):this.html&&this.nPopContainer.html(this.html),this},show:function(){return this.nBg.show().css({opacity:"1","transition-property":"none"}),this.nPopContainer.show(),this.trigger("pop:show:before"),setTimeout($.proxy(function(){this.trigger("pop:show:after"),this.nPopContainer.show().css("visibility","visible"),this._doShow&&this._doShow(),this.onShow()},this),200),this},hide:function(i){i=i||{};var t=i.doNotRemove||this.doNotRemoveOnHide||!1;this._doHide&&this._doHide(),this.trigger("pop:hide:before"),setTimeout($.proxy(function(){this.nBg.css({opacity:0,"transition-property":"opacity"}),this.trigger("pop:hide:after"),setTimeout($.proxy(function(){this.nBg.hide(),this.nPopContainer.hide(),t||this.destroy()},this),200)},this),this.animationTime),this.onHide()},destroy:function(){return this.nPopContainer.remove(),this.nBg.remove(),this.contentView&&this.contentView.remove(),this}})}),define("bower_components/pop/pop_forbid_scroll",["require","./pop"],function(i){return window.zenjs=window.zenjs||{},i("./pop").extend({init:function(i){this._super(i),i.doNotForbidScroll||(this.on("pop:show:before",$.proxy(this.onBeforePopShow,this)),this.on("pop:show:after",$.proxy(this.onAfterPopShow,this)),this.on("pop:hide:after",$.proxy(this.onAfterPopHide,this)))},onBeforePopShow:function(){this.top=this._window.scrollTop()},onAfterPopShow:function(){this._window.scrollTop(0),this.startShow()},onAfterPopHide:function(){var i,t=function(e){if(i!==this._window.scrollTop()&&e>0)return this._window.scrollTop(i),void setTimeout($.proxy(t,this,e-1));setTimeout($.proxy(this.onFinishHide,this),50)};return function(){this.startHide(),i=this.top,this._window.scrollTop(i),$.proxy(t,this)(2),setTimeout($.proxy(function(){window.zenjs.popList.length<1&&$("html").css("position",this.htmlPosition)},this),200)}}(),startShow:function(){var i=window.zenjs.popList;if(i||(i=window.zenjs.popList=[]),0===i.length){var t=$("body"),e=$("html");this.htmlPosition=e.css("position"),e.css("position","relative"),this.bodyCss=(t.prop("style")||{}).cssText,this.htmlCss=(e.prop("style")||{}).cssText,$("body,html").css({overflow:"hidden",height:this._window.height(),"padding-bottom":0,"margin-bottom":0})}i.indexOf(this)<0&&i.push(this)},startHide:function(){var i=window.zenjs.popList,t=i.indexOf(this);t>-1&&i.splice(t,1),i.length<1&&($("html").attr("style",this.htmlCss||""),$("body").attr("style",this.bodyCss||""))}})}),define("bower_components/pop/popup",["require","./pop_forbid_scroll"],function(i){return i("./pop_forbid_scroll").extend({init:function(i){this._super(i),this.onClickBg=i.onClickBg||function(){},this.onBeforePopupShow=i.onBeforePopupShow||function(){},this.onAfterPopupHide=i.onAfterPopupHide||function(){},this.nPopContainer.css($.extend({left:0,right:0,bottom:0,background:"white"},i.containerCss||{})),this.nPopContainer.css("opacity","0"),this.nPopContainer.on("focus","input, textarea",function(i){var t=$(this),e=$(window),n=e.scrollTop(),o=t.offset().top;(o-n<0||o-n>100)&&setTimeout(function(){var i=o-70;e.scrollTop(i)},400)})},_doShow:function(){this.nPopContainer.addClass("popup"),this.contentView&&this.contentView.height?this.height=this.contentView.height():this.contentView||(this.height=this.nPopContainer.height()),this.onBeforePopupShow(),$(".js-close").click($.proxy(function(i){this.hide()},this)),this.nPopContainer.css({height:this.height+"px",transform:"translate3d(0,100%,0)","-webkit-transform":"translate3d(0,100%,0)"}),this.bodyPadding=$("body").css("padding"),$("body").css("padding","0px"),setTimeout($.proxy(function(){this.nPopContainer.css({transform:"translate3d(0,0,0)","-webkit-transform":"translate3d(0,0,0)","-webkit-transition":"all ease "+this.animationTime+"ms",transition:"all ease "+this.animationTime+"ms",opacity:1})},this)),setTimeout($.proxy(function(){this.contentView&&this.contentView.onAfterPopupShow&&this.contentView.onAfterPopupShow()},this),this.animationTime)},_doHide:function(i){this.nPopContainer.css({transform:"translate3d(0,100%,0)","-webkit-transform":"translate3d(0,100%,0)",opacity:0}),setTimeout($.proxy(function(){$("body").css("padding",this.bodyPadding),this.onAfterPopupHide()},this),this.animationTime)}})}),define("bower_components/zenjs/util/count_down",[],function(){function i(i){return i<10?"0"+i:""+i}function t(t,e,n,o,s){var r=0,a=0,c=0,p=0,l=0,h="",d=new Date,u=t.getTime()-d.getTime();if(u<=0)return s.stop(),e({seconds:0,text:"00:00:000",hour:0,min:0,sec:0,msec:0,day:0},{day:i(0),hour:i(0),min:i(0),sec:i(0),msec:i(0)}),void n();u>=864e5&&(r=Math.floor(u/864e5),u-=864e5*r,h+=r+"天"),u>=36e5&&(a=Math.floor(u/36e5),u-=36e5*a,h+=a+"小时"),u>=6e4?(c=Math.floor(u/6e4)%60,p=Math.floor(u/1e3)%60,l=u%1e3):(c=0,p=Math.floor(u/1e3),l=u%1e3),c<10&&(h+="0"),h+=c+"分",p<10&&(h+="0"),h+=p+"秒",l<10?h+="00":l<100&&(h+="0"),"second"!=o&&(h+=l),e({text:h,hour:a,min:c,sec:p,msec:l,day:r},{day:i(r),hour:i(a),min:i(c),sec:i(p),msec:i(l)})}function e(){this.tid=null,this.startTime=null}var n=function(){};return e.prototype={run:function(i){function e(){c.tid=setTimeout(e,"second"==i.step?1e3:50),t(a,s,r,i.step,c)}this.startTime||(this.startTime=Date.now());var o=i.seconds||0,s=i.onTimeChange||n,r=i.onTimeChangeEnd||n;this.startTime+=1e3*o;var a=new Date(this.startTime),c=this;e()},stop:function(){clearTimeout(this.tid)}},e}),define("text!wap/showcase/sku/templates/title.html",[],function(){return"<% if (goods_info['picture'].length > 0){ %>\n    <div class=\"thumb\"><img class=\"js-goods-thumb goods-thumb\" src=\"<%=goods_info['picture'][0] %>\" alt=\"\"></div>\n<% } %>\n<div class=\"detail goods-base-info clearfix\">\n    <p class=\"title c-black ellipsis\"><%- goods_info['title'] %></p>\n    <div class=\"goods-price clearfix\">\n    <% if (isPoints) { %>\n        <div class=\"current-price c-black\">\n            <span class='price-name pull-left font-size-14 c-orange'>兑换价：</span><i class=\"js-points-price price font-size-16 vertical-middle c-orange\"><%= sku['points_price'] || points_goods['points_price'] %></i>\n        </div>\n    <% } else if(activity){ %>\n        <div class=\"current-price c-black activity-price\">\n            <span class='price-name pull-left font-size-14 c-orange'>¥</span><i class=\"js-goods-price price font-size-16 vertical-middle c-orange\"><%= activity['price'] %></i>\n            <span class=\"price-tag vertical-middle js-price-tag\"><%= activity['price_title'] %></span>\n        </div>\n        <div class=\"old-price line-through js-old-price-wrapper\">\n            原价：¥<span class=\"js-old-price\"><%=sku['old_price'] && sku['old_price'] != '0.00' && sku['old_price'] != 0.00 ? sku['old_price'] : goods_info['price'] %></span>\n        </div>\n    <% }else{ %>\n        <div class=\"current-price pull-left c-black\">\n            <span class='price-name pull-left font-size-14 c-orange'>¥</span><i class=\"js-goods-price price font-size-16 vertical-middle c-orange\"><%= sku['price'] && sku['price'] != '0.00' && sku['price'] != 0.00 ? sku['price'] : goods_info['price'] %></i>\n        </div>\n    <% } %>\n    <% if(goods_info['origin'] && goods_info['origin'] !== '淘价：'){ %>\n        <div class=\"original-price vertical-middle font-size-14 line-through\"><%- goods_info['origin'] %></div>\n    <% } %>\n    </div>\n</div>\n<div class=\"js-cancel sku-cancel\">\n    <div class=\"cancel-img\"></div>\n</div>\n"}),define("wap/showcase/sku/views/sku_title",["text!wap/showcase/sku/templates/title.html"],function(i){return Backbone.View.extend({initialize:function(i){this.difTitle=(i||{}).difTitle},template:_.template(i),changeSkuThumb:function(i){this.skuThumb=i,this.$(".js-goods-thumb").attr("src",this.skuThumb)},changePrice:function(i){this.price=i,this.$(".js-goods-price").html((i/100).toFixed(2))},changeOldPrice:function(i,t){this.old_price=i;var e=this.$(".js-old-price-wrapper");t?e.hide():e.show(),this.$(".js-old-price").html((i/100).toFixed(2))},changePointsPrice:function(i){this.points_price=i.points_price,this.remain_price=(i.remain_price/100).toFixed(2),this.$(".js-points-price").html(this.points_price+"积分+¥"+this.remain_price)},changePriceTitle:function(i){i=i||"",this.$(".js-price-tag").html(i)},getPrice:function(){return this.price},getPointsPrice:function(){return this.points_price},resetPrice:function(){this.$(".js-goods-price").html(this.priceScope),this.$(".js-points-price").html(this.pointsPriceScope),this.$(".js-old-price").html(this.oldPriceScope).parent(".js-old-price-wrapper").show()},resetPriceTitle:function(){this.$(".js-price-tag").html(this.originPriceTitle)},render:function(i){var t=i.activity||{};return this.$el.html(this.template(i)),this.priceScope=this.$el.find(".js-goods-price").text(),this.pointsPriceScope=this.$el.find(".js-points-price").text(),this.oldPriceScope=this.$el.find(".js-old-price").text(),this.isPoints=i.isPoints,this.originPriceTitle=t.price_title||"",this}})}),define("text!wap/showcase/groupon/templates/sku_title_tpl.html",[],function(){return'<% if (goods_info[\'picture\'].length > 0){ %>\n    <div class="thumb"><img class="js-goods-thumb" src="<%=goods_info[\'picture\'][0] %>" alt=""></div>\n<% } %>\n<div class="detail goods-base-info clearfix">\n    <p class="title c-black ellipsis"><%=goods_info[\'title\'] %></p>\n    <div class="goods-price clearfix">\n        <div class="current-price pull-left">\n            <% if (sku[\'isGroupon\']) { %>\n                <span class="groupon-price font-size-12 c-red vertical-middle"><%= sku[\'joinNum\']%>人拼团价：</span>\n            <% } else { %>\n                <span class="origin-price font-size-12 c-red vertical-middle">单人购买价：</span>\n            <% } %>\n            <span class="font-size-14 c-red vertical-middle">¥</span><i class="js-goods-price price font-size-16 vertical-middle c-red"><%=sku[\'price\'] && sku[\'price\'] != \'0.00\' && sku[\'price\'] != 0.00 ? sku[\'price\'] : goods_info[\'price\'] %></i>\n        </div>\n    </div>\n</div>\n<div class="js-cancel sku-cancel">\n    <div class="cancel-img"></div>\n</div>\n'}),define("wap/showcase/groupon/views/group_sku_title",["wap/showcase/sku/views/sku_title","text!wap/showcase/groupon/templates/sku_title_tpl.html"],function(i,t){return i.extend({template:_.template(t)})}),define("text!wap/showcase/groupon/templates/sku_quota_tpl.html",[],function(){return'<div class="quota c-red">拼团每人限购<%= quota %>件</div>\n'}),define("text!wap/ump/group_tuan/detail/templates/time.html",[],function(){return" <% var hour = parseInt(data.hour) + 24 * parseInt(data.day) %>\n <i class=\"time-wrap\"><%= hour < 10 ? '0' + hour : hour %></i> :\n <i class=\"time-wrap\"><%= data.min < 10 ? '0' + data.min : data.min %></i> :\n <i class=\"time-wrap\"><%= data.sec < 10 ? '0' + data.sec : data.sec %></i>\n"}),define("text!wap/trade/new_order/components/groupon/templates/header_receive_tips.html",[],function(){return'<div>\n    <div class="container" style="padding: 20px 15px; line-height: 1.5; background: #fff;">\n        <h3 class="font-size-14" style="margin-bottom: 10px;">团长代收</h3>\n        <p class="c-gray-dark font-size-12">\n            <% if (grouponData.receive_state == RECEIVE_STATE.OptionalReceive) { %>\n               拼团商品可以在提交订单时选择团长代收，这样也可以免除团员的邮费哦<br>\n               团长收货后会分发给团员，团员也可以向团长领取哦\n            <% } else { %>\n                该拼团商品商家设置必须由团长代收，成团后商品统一发货给团长，这样也可以免除团员的邮费哦<br>\n                团长收货后会分发给团员，团员也可以向团长领取哦\n            <% } %>\n        </p>\n    </div>\n    <button class="js-close" style="padding: 17px; width: 100%; background: #ff4444; color: #fff; border: 0;">\n        完成\n    </button>\n</div>\n'}),define("wap/trade/new_order/constants/receive_state",[],function(){return{ForbidReceive:0,OptionalReceive:1,ForceReceive:2}}),define("bower_components/pop/popout",["require","./pop_forbid_scroll"],function(i){return i("./pop_forbid_scroll").extend({init:function(i){i=i||{},this._super(i),this.css=$.extend({transition:"opacity ease "+this.animationTime+"ms",top:"50%",left:"50%","-webkit-transform":"translate3d(-50%, -50%, 0)",transform:"translateY(-50%, -50%, 0)"},i.css||{}),this.nPopContainer.css(this.css)},_doShow:function(){$(".js-popout-close").click($.proxy(function(i){this.hide()},this)),this.nPopContainer.css("opacity",1),this.nPopContainer.show()},_doHide:function(i){this.nPopContainer.css({opacity:0})}})}),define("text!wap/ump/group_tuan/detail/templates/groupon_share.html",[],function(){return'<div class="groupon-share-popup">\n  <div class="img-content">\n    <img src="<%= imgSrc %>">\n  </div>\n  <p class="note">长按保存图片，发送给朋友来拼团吧</p>\n</div>\n'}),require(["bower_components/pop/popup","bower_components/zenjs/util/count_down","wap/showcase/groupon/views/group_sku_title","text!wap/showcase/groupon/templates/sku_quota_tpl.html","text!wap/ump/group_tuan/detail/templates/time.html","text!wap/trade/new_order/components/groupon/templates/header_receive_tips.html","wap/trade/new_order/constants/receive_state","bower_components/youzanjsbridge/api","bower_components/pop/popout","text!wap/ump/group_tuan/detail/templates/groupon_share.html"],function(i,t,e,n,o,s,r,a,c,p){var l=window.Logger;new(Backbone.View.extend({initialize:function(i){this._global=i._global||{},this.timeTemplate=_.template(o),this.initCountDown(),this.initPopoutAlert(),this.showNativeTab(),this.disableGrouponShare()},events:{"click .js-join":"onJoinTuanClicked","click .js-open-share":"onShare","click .js-header-receive-tip":"showHeaderReceiveTips","click .js-groupon-share":"showGrouponShare"},initCountDown:function(){var i=this.$(".js-time-count");if(0!==i.length){var e=+i.data("seconds");(new t).run({seconds:e,onTimeChange:_(function(t){i.html(this.timeTemplate({data:t}))}).bind(this)})}},initPopoutAlert:function(){this._global.groupon_alert_type&&motify.log(this._global.groupon_alert_title,2500)},onShare:function(){l.log({fm:"click",title:"invite",page:"group_detail"})},onJoinTuanClicked:function(t){if(t.preventDefault(),window.BuyView){var o=this._global,s=o.sku;if(0==s.stock_num)return void motify.log("商品已售罄",2500);if(o.no_fans_buy&&"5c680d7fe8b4e9c603"!==o.platform)return window.showGuide&&window.showGuide("follow",{goods:!0}),!1;try{var r=o.activity||{},a=r.sku_price;_.each(s.list,function(i){var t=a[i.id];t&&(i.price=100*t)}),s.price=r.min_price==r.max_price?r.min_price:r.min_price+" - "+r.max_price,s.isGroupon=!0,s.joinNum=+r.join_num}catch(i){}var c=$(t.target).data("btn-type");l.log({fm:"click",title:c,page:"group_detail"});var p=o.quota_used,h=o.quota;278828285==o.goods_id&&1==o.kdt_id&&(p=p<h?0:1,h=1),this.popupView||(this.popupView=new i({contentViewClass:window.BuyView,className:"sku-layout sku-box-shadow",contentViewOptions:{baseUrl:o.wap_url.wap,need_ajax_login:o.need_ajax_login,wxpay_env:o.wxpay_env,isCartBtnHide:!0,SkuTitleView:e,quotaTpl:n},transparent:.8,doNotRemoveOnHide:!0})),this.popupView.render({sku:s,goods_info:o.goods_info,goods_id:o.goods_id,postage:o.postage,activity_alias:o.activity_alias,activity_id:o.activity_id,activity_type:o.activity_type,quota:h,quota_used:p,activity:o.activity,is_virtual:o.is_virtual,show_stock:!1}).show()}},showNativeTab:function(){if("youzanmars"==this._global.platform){var i={menus:[{name:"",type:"icon_indicator",icon:"http://su.yzcdn.cn/v2/image/yzapp/icons/toolbar-menu@3x.png",uri:"youzanjs://dropmenu?id=1",indicator:{type:"badge"},params:{listen:"msg_center"}}]};a.doCall("setRightMenu",$.extend(!0,{},i)),a.on("shareData",function(i){var t=window.getShareData()||{};t._requestId=i||"",a.putData("shareData",t)})}},showHeaderReceiveTips:function(t){var e=$(t.currentTarget).data("receive-state");new i({html:_.template(s)({grouponData:{receive_state:e},RECEIVE_STATE:r})}).render().show()},disableGrouponShare:function(){window.wxReady&&window.wxBridge&&window.wxReady(function(){wxBridge.hideMenuItems&&wxBridge.hideMenuItems(["menuItem:share:timeline"])})},getCanvasData:function(){var i=new $.Deferred,t=_global.activity,e=new Image,n=new Image,o=t.goods_name,s=t.sku_price,r=null,a=!1;return _.each(s,function(i,t){null===r?r=i:(a=!0,Number(i)<Number(r)&&(r=i))}),a&&(r+="起"),e.src=_global.qrcodes,n.onload=function(){var s=document.createElement("canvas");s.width=750,s.height=1334,s.style.width="375px",s.style.height="667px";var a=s.getContext("2d");a.fillStyle="#fff",a.fillRect(0,0,750,1334),a.drawImage(n,0,0,750,750),a.fillStyle="#fff",a.shadowBlur=2,a.shadowColor="#bdbdbd",a.shadowOffsetY=1,a.fillRect(38,818,676,460),a.shadowBlur=0,a.shadowOffsetY=0,a.fillStyle="#333",a.font="30px Arial",o.length<=20?a.fillText(o,78,910):(o.length>30&&(o=o.substr(0,30)+"..."),a.fillText(o.substr(0,20),78,910),a.fillText(o.substr(20),78,950)),a.fillStyle="#666",a.font="34px Arial",a.fillText(t.join_num+"人团购价：",320,1010),a.fillStyle="#f44",a.font="34px Arial",a.fillText("¥ "+r,544,1010),a.fillStyle="#f8f8f8",a.fillRect(78,1040,598,220),a.fillStyle="#000",a.font="24px Arial",a.fillText("长按或扫描二维码抢购",350,1152),a.drawImage(e,116,1050,200,200),i.resolve(s.toDataURL("image/png"))},n.crossOrigin="Anonymous",n.src=t.attachment_url,i.promise()},showGrouponShare:function(){var i=this;this.shareTplCache?i.renderGroupShare():this.getCanvasData().then(function(t){i.shareTplCache=_.template(p)({imgSrc:t}),i.renderGroupShare()})},renderGroupShare:function(){new c({transparent:1,css:{overflow:"initial"},html:this.shareTplCache}).render().show()}}))({el:$("body"),_global:window._global})}),define("main",function(){});