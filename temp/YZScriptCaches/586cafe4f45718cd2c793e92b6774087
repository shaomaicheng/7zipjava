window.Zepto&&function(t){t.fn.serializeArray=function(){var o,e,n=[],i=function(t){if(t.forEach)return t.forEach(i);n.push({name:o,value:t})};return this[0]&&t.each(this[0].elements,function(n,a){e=a.type,o=a.name,o&&"fieldset"!=a.nodeName.toLowerCase()&&!a.disabled&&"submit"!=e&&"reset"!=e&&"button"!=e&&"file"!=e&&("radio"!=e&&"checkbox"!=e||a.checked)&&i(t(a).val())}),n},t.fn.serialize=function(){var t=[];return this.serializeArray().forEach(function(o){t.push(encodeURIComponent(o.name)+"="+encodeURIComponent(o.value))}),t.join("&")},t.fn.submit=function(o){if(0 in arguments)this.bind("submit",o);else if(this.length){var e=t.Event("submit");this.eq(0).trigger(e),e.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),define("vendor/zepto/form",function(){}),window.Utils=window.Utils||{},define("wap/components/util/form",["vendor/zepto/form"],function(t){window.Utils.getFormData=function(t){var o=t.serializeArray(),e={};return $.map(o,function(t){e[t.name]=t.value}),e}}),require(["wap/components/util/form"],function(t){function o(t,e,n){$(t).text("等待 "+e+"秒"),--e>=0?a=setTimeout(function(){o(t,e,n)},1100):n()}function e(){clearTimeout(a),s.removeAttr("disabled"),s.text("获取验证码")}function n(t,e){s.prop("disabled",!0),t=t||0,e=e||function(){},o(s,t,e)}function i(t){return t.taobao_id?t.phone?/^1\d{10}$/.test(t.phone)?!!t.code||(motify.log("请先填写你的短信验证码"),f.focus(),!1):(motify.log("请填写11位手机号码"),u.focus(),!1):(motify.log("请先填写你的手机号码"),u.focus(),!1):(motify.log("请输入你的淘宝帐号"),r.focus(),!1)}var a,r=$(".js-txt-username"),u=$(".js-txt-tel"),s=$(".js-send-auth"),f=$(".js-txt-auth"),d=$(".js-submit"),l=$(".js-taobao-bind-form"),c=!1;l.on("keyup",".js-txt-username, .js-txt-tel, .js-txt-auth",function(t){var o=$.trim(r.val()),e=$.trim(u.val()),n=$.trim(f.val());o&&e&&n?d.removeAttr("disabled"):d.attr("disabled","disabled")}),s.click(function(t){var o=$.trim(r.val()),i=$.trim(u.val());return o?i?void $._ajax({url:"/v2/buyer/taobao/sms.json",type:"POST",dataType:"json",data:{phone:i,taobao_id:o,kdt_id:window._global.kdt_id,fans_id:window._global.fans_id,fans_type:window._global.fans_type,buyer_id:window._global.buyer_id},beforeSend:function(){n(60,function(){s.text("再次获取"),s.prop("disabled",!1),f.attr("placeholder","没有收到验证码？")})},success:function(t){0===t.code||(e(),motify.log(t.msg))},error:function(t,o,n){e(),motify.log("获取验证码失败，请稍后再试")},complete:function(t,o){}}):(motify.log("请填写手机号码"),void u.focus()):(motify.log("请填写淘宝帐号"),void r.focus())}),l.on("submit",function(t){if(t.preventDefault(),c)return void motify.log("请勿重复提交信息");var o=window.Utils.getFormData(l);if($.each(o,function(t,e){o[t]=$.trim(e)}),!i(o))return!1;o.kdt_id=window._global.kdt_id,o.fans_id=window._global.fans_id,o.fans_type=window._global.fans_type,o.buyer_id=window._global.buyer_id,$._ajax({url:"/v2/buyer/taobao/user.json",type:"POST",dataType:"json",data:o,beforeSend:function(){c=!0,d.text("绑定中，请稍等。。。")},success:function(t){0===t.code?window.location.href=window._global.wap_url.wap+"/buyer/taobao/result?kdt_id="+window._global.kdt_id:motify.log(t.msg)},error:function(t,o,n){e(),motify.log("绑定失败，请稍后再试")},complete:function(t,o){c=!1,d.text("立即绑定")}})})}),define("main",function(){});