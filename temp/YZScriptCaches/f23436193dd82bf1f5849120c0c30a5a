define("bower_components/waterfall/pager",["require","zenjs/events"],function(t){var i=t("zenjs/events"),e=function(){};return i.extend({init:function(t){this.$el||(this.$el=$(t.el||t.$el||"<div></div>"),this.el=this.$el[0]),this.nLoading=t.loadingHTML?$(t.loadingHTML).addClass("loading-more"):$('<div class="loading-more"><span></span></div>'),this.nList=this.$el.find(".js-list"),0===this.nList.length&&(this.nList=$('<div class="js-list b-list"></div>'),this.$el.append(this.nList)),"number"==typeof t.total&&(this.total=t.total),this.offset=t.offset||300,this.scrollDirection="down",this.pageIndex=t.pageIndex||0,this.perPage=t.perPage||10,this.postData=t.postData||{},this.checkSize=!0,"boolean"==typeof t.checkSize&&(this.checkSize=t.checkSize),this.idName=t.idName||"id",t.idValue&&(this.idValue=t.idValue),this.jsonKeys=t.jsonKeys||{},this.finishedHTML=t.finishedHTML,this.finishedText=t.finishedText,this.emptyHTML=t.emptyHTML||"",this.emptyText=t.emptyText||"",this.getExtrPostData=t.getExtrPostData||e,this.onFetchError=t.onFetchError||e,this.onListEmpty=this.onListEmpty||t.onEmpty||this._onListEmpty,this.on("finished",t.onFinished||e),this.on("after:list:load",t.onAfterListLoad||t.onDataLoad||e),this.extraData={},this.scrollContainer=t.scrollContainer?$(t.scrollContainer):$("body"),this.scrollEventAccepter=t.scrollEventAccepter?$(t.scrollEventAccepter):$(t.scrollContainer||window),this._onScroll=$.proxy(this.onScroll,this),this.bindScrollFunc()},$:function(t){return this.$el.find(t)},onScroll:function(){function t(){var t=this.nList.offset(),i=this.scrollContainer.offset();return{left:t.left-i.left||0,top:t.top-i.top||0}}return function(){if(!(this.sleeping||this.finished||this.fetching)){if(0===this.total||this.total&&this.total<=this.pageIndex*this.perPage)return void this.doFinishLoading();var i=t.call(this);"down"===this.scrollDirection&&this.nList.height()+i.top-this.scrollEventAccepter.height()-this.scrollContainer.scrollTop()<this.offset&&this.fetchMore&&this.fetchMore(),"up"===this.scrollDirection&&this.scrollContainer.scrollTop()<this.offset&&this.fetchMore&&this.fetchMore()}}}(),fetchMore:function(){return this.sleeping||this.finished||this.fetching?this:(this.showLoading(),this.fetching=!0,this._fetchMore&&this._fetchMore.call(this),this)},onFetchMoreSuccess:function(){this.hideLoading(),this.fetching=!1,this._onFetchMoreSuccess.apply(this,arguments)},fetchRender:function(){return this.fetchMore(),this},_onFetchMoreError:function(){this.fetching=!1,this.hideLoading(),this.onFetchError()},doFinishLoading:function(t){this.finished=!0,this.fetching=!1,this.hideLoading(),this.$el.find(".list-finished").remove(),this.triggerMethod&&this.triggerMethod("finished",this.collection,t)},bindScrollFunc:function(){var t=this;this.scrollFunc&&this.unbindScrollFunc(),this.scrollFunc=function(){t.scrollTimeout&&clearTimeout(t.scrollTimeout),t.scrollTimeout=setTimeout(t._onScroll,200)},this.scrollEventAccepter.on("scroll",this.scrollFunc)},unbindScrollFunc:function(){this.scrollEventAccepter.off("scroll",this.scrollFunc),this.scrollFunc=null},doSleep:function(){this.sleeping=!0,this.unbindScrollFunc()},doWake:function(){this.sleeping=!1,this.bindScrollFunc(),this.fetchMore()},showLoading:function(){this.hasFetching=!0,this.$el.append(this.nLoading)},hideLoading:function(){this.nLoading.remove()},getFinishHtml:function(){return this.finishedHTML?$(this.finishedHTML).addClass("list-finished"):'<div class="list-finished">'+(this.finishedText||"已经没有更多了")+"</div>"},setExtraData:function(t){$.extend(this.extraData,t)},resetWaterfall:function(t){this.finished===!0&&this.$(".list-finished").remove(),this.removeAll&&this.removeAll(),this.nList.empty(),this.collection&&this.collection.reset([],{silent:!0}),this.listEl&&this.listEl.empty(),this.finished=!1,t&&t.pageIndex?this.pageIndex=t.pageIndex:this.pageIndex=0,this.idValue=void 0},_onListEmpty:function(){if(!this.fetching){var t;this.emptyHTML?t=$(this.emptyHTML).addClass("list-finished"):this.emptyText&&(t='<div class="list-finished">'+this.emptyText+"</div>"),this.$el.append(t)}},destroy:function(){this.doSleep(),this.$el.remove(),this.unbindScrollFunc()},remove:function(){this.destroy()}})}),define("zenjs/backbone/base_view",["require","backbone","../core/trigger_method"],function(t){var i=t("backbone"),e=t("../core/trigger_method");return i.View.extend({clean:function(){return this.stopListening(),this},triggerMethod:e})}),define("bower_components/zenlist/list",["require","exports","module","zenjs/backbone/base_view"],function(t,i,e){var n=function(){},s=t("zenjs/backbone/base_view");e.exports=s.extend({initialize:function(t){return this.options=t=t||{},this.items=[],this.itemView=t.itemView,this.itemOptions=t.itemOptions||{},this.collection=t.collection,this.onAfterListChange=t.onAfterListChange||n,this.onAfterListLoad=t.onAfterListLoad||n,this.onAfterListDisplay=t.onAfterListDisplay||n,this.onListEmpty=t.onListEmpty||t.onEmptyList||this._onListEmpty,this.onItemClick=t.onItemClick||n,this.onViewItemAdded=t.onViewItemAdded||n,this.displaySize=t.displaySize||-1,this.emptyHTML=t.emptyHTML||"",this.emptyText=t.emptyText||"列表为空",this},render:function(t){return this.displaySize=(t||{}).displaySize==-1?-1:this.displaySize,this.clean(),this._setupListeners(),this.addAll(),this.onAfterListDisplay({list:this.collection}),this},fetchRender:function(t){return this.collection.fetch({data:t,success:_(function(t,i){this.render(),this.onAfterListLoad(this.collection,i),this.onFetchSuccess&&this.onFetchSuccess()}).bind(this),error:_.bind(function(){this.onAfterListLoad(this.collection,response)},this)}),this},_setupListeners:function(){this.collection&&(this.stopListening(this.collection),this.listenTo(this.collection,"add",this.addItem,this),this.listenTo(this.collection,"reset sort",this.render,this),this.listenTo(this.collection,"remove",this.onItemRemoved,this))},addItemListeners:function(t){var i=this;this.listenTo(t,"all",function(){var i="item:"+arguments[0],e=_.toArray(arguments);e.splice(0,1),e.unshift(i,t),this.trigger.apply(this,e),"item:click"==i&&this.onItemClick()}),this.listenTo(t.model,"change",function(){i.onAfterListChange({list:this.collection})})},addAll:function(){0===this.collection.length?this.fetching||this.triggerMethod("list:empty"):this.collection.each(function(t){this.addItem(t)},this)},removeAll:function(){for(var t=this.items.length-1;t>=0;t--)this.removeView(this.items[t]);this.onAfterListChange({list:this.collection})},addItem:function(t,i,e){if(!(this.displaySize>=0&&this.items.length>=this.displaySize)){1==this.collection.length&&(this.listEl||this.$el).html("");var n=new this.itemView(_.extend({},this.options.itemOptions,{model:t,index:this.collection.indexOf(t)}));this.items.push(n),this.addItemListeners(n),n.render(),this.onViewItemAdded({list:this.items,viewItem:n,model:t});return 0===(e||{}).at?(this.listEl||this.$el).prepend(n.el):(this.listEl||this.$el).append(n.el),n}},removeItem:function(t){var i=this.getViewByModel(t);i&&this.removeView(i)},removeView:function(t){var i;this.stopListening(t),t&&(this.stopListening(t.model),t.remove(),i=this.items.indexOf(t),this.items.splice(i,1)),0===this.collection.length&&(this.fetching||this.triggerMethod("list:empty"))},onItemRemoved:function(t){this.onAfterListChange({list:this.collection,action:"remove",model:t}),this.removeItem(t)},getViewByModel:function(t){return _.find(this.items,function(i,e){return i.model===t})},dispatchEventToAllViews:function(t,i){for(var e=this.items.length-1;e>=0;e--)this.items[e].trigger(t,i)},remove:function(){s.prototype.remove.call(this,arguments),this.removeAll(),this.collection.reset(),delete this.collection},clean:function(){s.prototype.clean.call(this,arguments),this.removeAll(),(this.listEl||this.$el).html(""),this.stopListening(this.collection)},_onListEmpty:function(){this.$el.html(this.emptyHTML||(this.emptyText?'<p style="text-align:center;line-height:60px;">'+this.emptyText+"</p>":""))}})}),define("bower_components/waterfall/waterfall",["require","./pager","bower_components/zenlist/list"],function(t){var i=t("./pager"),e=t("bower_components/zenlist/list"),n=function(){};return i.extend({init:function(t){this._super(t),this.collection=t.collection,this.listEl=this.getListViewEl(),this.list=new e($.extend({},t,{el:this.listEl,collection:this.collection,onListEmpty:n})).render(),this.on("finished",this._doFinishLoading)},getListViewEl:function(){return this.nList},_fetchMore:function(){var t={};this.idValue&&(t[this.idName]=this.idValue),t[this.jsonKeys.perPage||"perpage"]=this.perPage,t[this.jsonKeys.pageIndex||"page"]=this.pageIndex+1;var i=this.getExtrPostData?this.getExtrPostData():{};this.collection.fetch({data:$.extend(t,this.postData,i,this.extraData),success:$.proxy(this.onFetchMoreSuccess,this),error:$.proxy(this.onFetchError,this),update:!0,remove:!1})},_onFetchMoreSuccess:function(t,i){this.pageIndex++,this.triggerMethod("after:list:load",{collection:t,response:i});var e=this.collection.parse(i);if(0===e.length||this.checkSize&&e.length<this.perPage)return void this.doFinishLoading();var n=_.last(this.collection.models);n&&(this.idValue=n.get(this.idName)),this.onScroll()},_onAfterListLoad:function(){var t=_.last(this.collection.models);t&&(this.idValue=t.get(this.idName))},_doFinishLoading:function(){if(this.collection.length>0){if(this.hasFetching&&this.pageIndex>1){var t=this.getFinishHtml();this.$el.append(t)}}else this.triggerMethod("list:empty")},addTopItem:function(t){this.collection.unshift(t)},addBottomItem:function(t){this.finished===!0&&this.$(".list-finished").remove(),this.collection.add(t)}})}),define("wap/apps/checkin/collection/main",[],function(){return Backbone.Collection.extend({initialize:function(t,i){this.options=i||{}},url:function(){return"/v2/apps/checkin/checkinList.json"},parse:function(t){var i=t.data||{};return this.total=i.total,i.list}})}),define("text!wap/apps/checkin/templates/item.html",[],function(){return"<%  var award = data.award_info;\n    var awardGot = false;\n    var awardInfo = [];\n    var blanking = data.blanking;\n    for (var item in award) {\n        switch (item) {\n            case 'point':\n                awardInfo.push('<span class=\"award-item\">' + award[item] + '积分</span>');\n                awardGot = true;\n                break;\n            case 'coupon':\n                awardInfo.push('<span class=\"award-item\">优惠：' + award[item] + '</span>');\n                awardGot = true;\n                break;\n            case 'present':\n                awardInfo.push('<span class=\"award-item\">赠品：' + award[item] + '</span>');\n                awardGot = true;\n                break;\n            default:\n                break;\n        }\n    }\n%>\n        <td class=\"<% if (awardGot){ %> active <% } %><% if (blanking){ %> blanking <% } %>\">\n            <%= data.checkin_time %>\n            <% if (blanking) { %>\n                <div class=\"checkin-blanking\">\n                    哎呀，这里中断了......\n                </div>\n            <% } %>\n        </td>\n        <td class=\"<% if (awardGot){ %> active <% } %><% if (blanking){ %> blanking <% } %>\">\n            <%= awardGot ? awardInfo.join('<br/>') : '--'%>\n            <% if (blanking) { %>\n                <div class=\"checkin-blanking\">&nbsp;</div>\n            <% } %>\n        </td>\n    "}),define("wap/apps/checkin/views/item",["require","text!wap/apps/checkin/templates/item.html"],function(t){var i=t("text!wap/apps/checkin/templates/item.html");return Backbone.View.extend({tagName:"tr",className:"",template:_.template(i),initialize:function(t){},render:function(t){var i,e=this.options.index,n=this.model.collection.length,s=this.model.toJSON(),o=new Date(s.checkin_time.split(" ")[0]).getTime(),c=e!=n-1&&this.model.collection.models[e+1].toJSON();c&&(i=new Date(c.checkin_time.split(" ")[0]).getTime(),o-i>864e5&&(s.blanking=!0)),this.$el.append(this.template({data:s}))}})});var appUtils={};appUtils.updateUrlWithStamp=function(t,i){var i=(i||"t")+"=",e=new RegExp(i+"\\d+"),n=+new Date;if(t.indexOf(i)>-1)return t.replace(e,i+n);if(t.indexOf("?")>-1){var s=t.split("?");return s[1]?s[0]+"?"+i+n+"&"+s[1]:s[0]+"?"+i+n}return t.indexOf("#")>-1?t.split("#")[0]+"?"+i+n+location.hash:t+"?"+i+n},appUtils.preset={errorModal:{content:{html:"糟糕，网络不给力"},confirm:{html:"重新进入",click:function(){window.location.href=appUtils.updateUrlWithStamp(window.location.href)}},cancel:"remove"}},appUtils.modal=function(){function t(){n&&n.remove(),n=$($("#apps-modal-tpl").html()),s={};for(var t in c)s[t]=n.find(".js-apps-modal-"+t)}function i(i){t();var e,n,o;for(e in i)if("string"!=typeof i[e])for(n in i[e])o=s[e][n],$.isFunction(o)&&o.call(s[e],i[e][n]);else"remove"==i[e]&&s[e].remove()}function e(t){return $.extend(!0,{},c,t)}var n,s,o={open:function(t){i(e(t)),$(document.body).append(n)},close:function(t){t===!0?n.find(".apps-modal").remove():n&&n.remove()}},c={content:{html:""},confirm:{html:"确定",click:$.noop},cancel:{html:"取消",click:o.close}};return o}(),appUtils.process=function(){function t(t){c.cancel.html=t,l.cancel.html=t}function i(){return 0!==s?10999==s?(o.open(c),!1):10998==s?(o.open(l),!1):(o.open(h),!1):0===n.costPoint||void 0==n.costPoint||(o.open(a),!1)}var e,n=_apps_global,s=n.errorCode,o=appUtils.modal,c={content:{html:n.errorMsg},confirm:{html:"登录",click:function(){location.href=n.login}},cancel:{html:"取消",click:function(){o.close()}}},l={content:{html:n.errorMsg},confirm:{html:"关注",click:function(){window.showGuide&&window.showGuide("follow")}},cancel:{html:"取消",click:function(t){o.close()}}},a={content:{html:'每次抽奖将消耗<span class="important"> '+n.costPoint+"积分</span>"},confirm:{html:"赌一把",click:function(){o.close(),e.onconfirm&&e.onconfirm()}},cancel:{html:"舍不得",click:function(){o.close()}}};"/v2/apps/shake"==location.pathname&&(a.content.html='每次抽奖将消耗<span class="important"> '+n.costPoint+"积分，确定参加吗？</span>",a.confirm.html="我要参加",a.cancel.html="进店逛逛",a.cancel.click=function(){o.close(),location.href=_apps_global.home_page_url});var h={content:{html:n.errorMsg},confirm:{html:"知道了",click:function(){o.close()}},cancel:"remove"};return e={check:i,setCancelText:t,onconfirm:$.noop}}(),appUtils.atLeast=function(t,i){function e(){o.resolve.apply(null,arguments)}var n,s=!1,o={};return setTimeout(function(){s?i.apply(null,n):o.resolve=function(){i.apply(null,arguments)}},t),o.resolve=function(){n=arguments,s=!0},{resolve:e}},appUtils.randInt=function(t,i){var e=t+Math.random()*(i-t);return parseInt(e,10)},appUtils.format=function(t){var i=Array.prototype.slice.call(arguments,1);return t.replace(/{(\d+)}/g,function(t,e){return void 0!==i[e]?i[e]:t})},appUtils.getUrlParam=function(t,i){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),n="router"===i?window.location.href:window.location.search,s=n.substr(1).match(e);return null!==s?window.unescape(s[2]):null},define("wap/apps/app_utils",function(){}),require(["bower_components/waterfall/waterfall","./wap/apps/checkin/collection/main","./wap/apps/checkin/views/item","./wap/apps/app_utils"],function(t,i,e){"use strict";function n(){var n=$(window).height()-$(".apps-checkin-nav").height(),s=$(".history-container").css({minHeight:n}),o=window.waterfall;o?(o.resetWaterfall(),o.fetchRender()):window.waterfall=new t({el:s,scrollEventAccepter:s,scrollContainer:s,perPage:20,itemView:e,checkSize:!1,collection:new i,finishedText:"已经没有更多啦",emptyText:"暂无签到记录哦~~",onFetchError:function(){if(0==this.pageIndex){s.append('<p class="list-finished">数据返回失败，刷新一下试试~</p>')}else this.doFinishLoading()}}).fetchRender()}function s(t){$(".apps-checkin-center-info-days").html(t)}function o(t){$(".js-points").html(t)}function c(t){var i=x.prizeAt-x.checkinDay,e=$(".apps-checkin-prize-wrap");$(".js-prize-need").html(i),void 0!==t&&e.css({left:t-e.width()/2})}function l(){$(".apps-checkin-prize-wrap").css({opacity:0})}function a(){w.addClass("animate-man-move");var t=$(".apps-checkin-day-at"),i=t.next().position().left-t.position().left;t.removeClass("apps-checkin-day-at"),k.width("+="+i),setTimeout(function(){t.next().addClass("apps-checkin-day-at"),+x.checkinDay==x.prizeAt?l():c()},x.manMoveDuration)}function h(t,i){0!=i&&function(){var t=$(".apps-checkin-userinfo-points"),e=t.offset();e.left+=t.width()+5;var n=$('<div class="animate-floating apps-checkin-info">+'+i+"</div>").offset(e).appendTo(document.body);setTimeout(function(){n.remove()},x.manMoveDuration)}(),o(t+i)}function r(){appUtils.modal.close(),window.onbeforeunload=null,y.attr("disabled",!0).html("已签到")}function p(){window.onbeforeunload=function(){return"签到中，是否强行退出"},y.attr("disabled",!0).html("签到中..")}function d(){appUtils.modal.close(),window.onbeforeunload=null,y.removeAttr("disabled").html("签到")}$(".js-checkin").html("签 到"),function(){var t=$("body").width();t=Math.min(380,t),t=Math.max(320,t),$(".apps-checkin-center-content").width(t)}();var f=window._apps_global,u={content:{html:"签到成功"},confirm:{html:"知道了",click:appUtils.modal.close},cancel:"remove"},m={content:{html:"签到失败"},cancel:"remove",confirm:{html:"知道了",click:appUtils.modal.close}},g=(appUtils.modal.close,{content:{html:'<div class="loader-container"><div class="loader">签到中</div></div>'},confirm:"remove",cancel:"remove"}),v=$(".apps-checkin-day"),w=$(".apps-checkin-man"),k=$(".apps-checkin-progress-filled-wrap"),y=$(".js-checkin"),L=$(".js-show-history"),b=$(".js-show-checkin"),x={checkinDay:~~f.total_continuous||0,prizeAt:~~f.total_continuous+~~f.next_prize_days_length||0,point:~~f.user.points||0,additionPoint:0,hasChecked:function(){return void 0===f.is_valid_checkin?0:1!=f.is_valid_checkin}(),manMoveDuration:1e3};s(x.checkinDay),function(t,i){var e,n,s,o;s=t<5?~~(t/5):3*(~~((t+1)/3)-1),v.each(function(e){var c=~~s+e;$(this).html(c),c==t&&(n=e,$(this).addClass("apps-checkin-day-at")),c==i&&(o=e)}),0===s&&$(".apps-checkin-progress").addClass("apps-checkin-progress-fromzero"),0===n?(e=10,k.width(e+2)):(e=v.eq(n).position().left+24,k.width(e)),w.css({left:e}),void 0===o||o>=5||x.prizeAt-x.checkinDay<=0?$(".apps-checkin-prize-wrap").hide():c(v.eq(o).position().left+30),$(".apps-checkin-center-content").css({visibility:"visible"})}(x.checkinDay,x.prizeAt),o(x.point),x.hasChecked&&r(),window.__title=f.shared_text||"来签个到吧！";var _={init:function(){function t(t){var i="签到成功！<br>",e=_global.url.wap+"/showcase/usercenter?kdt_id="+_global.kdt_id;return void 0==t.coupon&&(t.coupon=[]),void 0==t.present&&(t.present=[]),t.points>0||t.present.length>0||t.coupon.length>0?(i+='<div class="prize-list">',i+="本次签到，你获得了以下奖励：<br>",i+='<div class="prize-list-content">',t.points>0&&(i+=t.points+" 积分奖励<br>"),t.present.length>0&&(i+=t.present.map(function(t){return'"'+t.present_title+'" 一份<br>'})),t.coupon.length>0&&(i+=t.coupon.map(function(t){return'"'+t.title+'" 一份<br>'})),1==t.coupon.length&&0==t.present.length?e=t.coupon[0].url:1==t.present.length&&0==t.coupon.length&&(e=t.present[0].present_url),t.coupon.length>0&&t.present.length>0&&(i+='<a href="'+e+'">点这里查看</a>'),i+="</div>"):i}y.click(function(){p(),x.checkinDay=+x.checkinDay+1;var i=new $.Deferred;setTimeout(function(){i.resolve()},1500),appUtils.modal.open(g),$.post("/v2/apps/checkin/checkin.json",{alias:f.alias}).then(function(e){try{var n=e.data.type,o=e.data;"success"==n.toLowerCase()&&(h(x.point,o.points),u.content.html=t(o),r(),i.then(function(){appUtils.modal.open(u)}),a(),s(x.checkinDay)),"failed"==n.toLowerCase()&&(m.content.html=o.content.replace(/\n\r/g,"<br>"),d(),i.then(function(){appUtils.modal.open(m)}))}catch(t){d(),appUtils.modal.open(m)}}).fail(function(){d(),appUtils.modal.open(m)})}),L.click(function(){n(),$(".apps-checkin-content, .apps-checkin-footer, .checkin-detail-components").hide(),$(".history-container").show()}),b.click(function(){$(".history-container").hide(),$(".apps-checkin-content, .apps-checkin-footer, .checkin-detail-components").show()})}};appUtils.process.setCancelText("取消"),appUtils.process.check()?_.init():$(".js-checkin").click(function(){return appUtils.process.check(),!1})}),define("main",function(){});