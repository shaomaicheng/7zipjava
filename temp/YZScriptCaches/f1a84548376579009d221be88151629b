"use strict";var appUtils={};appUtils.updateUrlWithStamp=function(n,o){var o=(o||"t")+"=",t=new RegExp(o+"\\d+"),e=+new Date;if(n.indexOf(o)>-1)return n.replace(t,o+e);if(n.indexOf("?")>-1){var c=n.split("?");return c[1]?c[0]+"?"+o+e+"&"+c[1]:c[0]+"?"+o+e}return n.indexOf("#")>-1?n.split("#")[0]+"?"+o+e+location.hash:n+"?"+o+e},appUtils.preset={errorModal:{content:{html:"糟糕，网络不给力"},confirm:{html:"重新进入",click:function(){window.location.href=appUtils.updateUrlWithStamp(window.location.href)}},cancel:"remove"}},appUtils.modal=function(){function n(){e&&e.remove(),e=$($("#apps-modal-tpl").html()),c={};for(var n in a)c[n]=e.find(".js-apps-modal-"+n)}function o(o){n();var t,e,i;for(t in o)if("string"!=typeof o[t])for(e in o[t])i=c[t][e],$.isFunction(i)&&i.call(c[t],o[t][e]);else"remove"==o[t]&&c[t].remove()}function t(n){return $.extend(!0,{},a,n)}var e,c,i={open:function(n){o(t(n)),$(document.body).append(e)},close:function(n){n===!0?e.find(".apps-modal").remove():e&&e.remove()}},a={content:{html:""},confirm:{html:"确定",click:$.noop},cancel:{html:"取消",click:i.close}};return i}(),appUtils.process=function(){function n(n){a.cancel.html=n,l.cancel.html=n}function o(){return 0!==c?10999==c?(i.open(a),!1):10998==c?(i.open(l),!1):(i.open(s),!1):0===e.costPoint||void 0==e.costPoint||(i.open(r),!1)}var t,e=_apps_global,c=e.errorCode,i=appUtils.modal,a={content:{html:e.errorMsg},confirm:{html:"登录",click:function(){location.href=e.login}},cancel:{html:"取消",click:function(){i.close()}}},l={content:{html:e.errorMsg},confirm:{html:"关注",click:function(){window.showGuide&&window.showGuide("follow")}},cancel:{html:"取消",click:function(n){i.close()}}},r={content:{html:'每次抽奖将消耗<span class="important"> '+e.costPoint+"积分</span>"},confirm:{html:"赌一把",click:function(){i.close(),t.onconfirm&&t.onconfirm()}},cancel:{html:"舍不得",click:function(){i.close()}}};"/v2/apps/shake"==location.pathname&&(r.content.html='每次抽奖将消耗<span class="important"> '+e.costPoint+"积分，确定参加吗？</span>",r.confirm.html="我要参加",r.cancel.html="进店逛逛",r.cancel.click=function(){i.close(),location.href=_apps_global.home_page_url});var s={content:{html:e.errorMsg},confirm:{html:"知道了",click:function(){i.close()}},cancel:"remove"};return t={check:o,setCancelText:n,onconfirm:$.noop}}(),appUtils.atLeast=function(n,o){function t(){i.resolve.apply(null,arguments)}var e,c=!1,i={};return setTimeout(function(){c?o.apply(null,e):i.resolve=function(){o.apply(null,arguments)}},n),i.resolve=function(){e=arguments,c=!0},{resolve:t}},appUtils.randInt=function(n,o){var t=n+Math.random()*(o-n);return parseInt(t,10)},appUtils.format=function(n){var o=Array.prototype.slice.call(arguments,1);return n.replace(/{(\d+)}/g,function(n,t){return void 0!==o[t]?o[t]:n})},appUtils.getUrlParam=function(n,o){var t=new RegExp("(^|&)"+n+"=([^&]*)(&|$)"),e="router"===o?window.location.href:window.location.search,c=e.substr(1).match(t);return null!==c?window.unescape(c[2]):null},function(){function n(n,o,t,e){if(n===p||n===s){var c=Object.create(n);o&&(c.content={html:o}),t&&(c.confirm={html:c.confirm.html,click:function(){n.confirm.click&&n.confirm.click(),t&&t()}}),e=t,"remove"!==c.cancel&&e&&(c.cancel={html:c.cancel.html,click:function(){n.cancel.click&&n.cancel.click(),e&&e()}}),i.open(c)}}function o(){return $._ajax({url:"/v2/apps/shake/shake.json",data:{alias:c.alias,appname:c.app_name||""},cache:!1,type:"post",dataType:"json",timeout:5e3})}function t(){var n=$.Deferred();return $(".shake-box").addClass("shaking"),setTimeout(function(){n.resolve()},4e3),n}function e(){a&&(e.invoking||(e.invoking=!0,$.when(o(),t()).then(function(n,o){f(n[0],function(){$(".shake-box").removeClass("shaking")})}).fail(function(n,o){$(".shake-box").removeClass("shaking"),i.open(appUtils.preset.errorModal)}).always(function(){e.invoking=!1})))}var c=_apps_global,i=appUtils.modal,a=!0,l={UNSUPPORTED:"该设备不支持摇一摇，请换个手机试试哦"},r={goToShop:function(){location.href=c.home_page_url}},s={content:{html:""},confirm:{html:"进店逛逛",click:r.goToShop},cancel:"remove"},p={content:{html:""},cancel:{html:"再摇一次",click:function(){i.close()}},confirm:{html:"点击查看",click:function(){window.location.href=_userCenterUrl}}};window.getRewards=o;var f=function(){var o=""===c.failedInfo?"哎呀，真可惜擦身而过!":c.failedInfo;return function(t,e){var i="";if(0===t.code){var a=t.data,l="";switch(a.type){case 0:l=a.point+" 个积分";break;case 1:l=a.value+"元 店铺优惠券";break;case 2:l=a.title}i=appUtils.format('<span class="important">哇！抽中 {0}！</span>',l),void 0!=a.give_point&&0!=a.give_point&&(i+=appUtils.format('<br>手气这么好，再送你 <span class="important">{0} 积分</span>',a.give_point)),3==a.type&&(i=a.title,p.confirm.html="立即兑换",p.cancel="remove"),p.content.html=i,a.detail_url&&a.detail_url.length>0&&(p.confirm={html:"点击查看",click:function(){window.location.href=a.detail_url}},$(".js-view-prize").attr("href",a.detail_url)),n(p,"",e)}else 10100===t.code?(i=t.msg||o,void 0!=c.givePoint&&0!=c.givePoint&&(i+=appUtils.format('<br>送你 <span class="important">{0} 积分</span>',c.givePoint)),p.confirm={html:"进店逛逛",click:r.goToShop},n(p,i,e)):(i=t.msg||o,n(s,i,e))}}(),m=$(".shake-box");appUtils.process.check()?m.removeClass("disabled"):(a=!1,appUtils.process.onconfirm=function(){a=!0,m.removeClass("disabled")}),function(){function o(n){var o=n.accelerationIncludingGravity,l=(new Date).getTime();if(l-f>100){var s=l-f;f=l,t=o.x,c=o.y,i=o.z,Math.abs(t+c+i-a-r-p)/s*1e4>m&&e&&e(),a=t,r=c,p=i}}var t,c,i,a,r,p,f=0;t=c=i=a=r=p=0;var m=800;window.DeviceMotionEvent?window.addEventListener("devicemotion",o,!1):n(s,l.UNSUPPORTED)}()}();