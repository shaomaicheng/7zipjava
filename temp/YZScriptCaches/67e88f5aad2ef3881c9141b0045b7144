window.Zepto&&function(e){e.fn.serializeArray=function(){var n,a,s=[],i=function(e){if(e.forEach)return e.forEach(i);s.push({name:n,value:e})};return this[0]&&e.each(this[0].elements,function(s,r){a=r.type,n=r.name,n&&"fieldset"!=r.nodeName.toLowerCase()&&!r.disabled&&"submit"!=a&&"reset"!=a&&"button"!=a&&"file"!=a&&("radio"!=a&&"checkbox"!=a||r.checked)&&i(e(r).val())}),s},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(n){e.push(encodeURIComponent(n.name)+"="+encodeURIComponent(n.value))}),e.join("&")},e.fn.submit=function(n){if(0 in arguments)this.bind("submit",n);else if(this.length){var a=e.Event("submit");this.eq(0).trigger(a),a.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),define("vendor/zepto/form",function(){}),define("wap/showcase/search_bar/main",["vendor/zepto/form"],function(){$.fn.searchBar=function(){var e=$.fn.searchBar.container;return e||(e=$.fn.searchBar.init()),this.each(function(){$(this).on("click",function(){e.css("display","block"),e.find(".search-input").focus()})})},$.fn.searchBar.keywords=function(e,n){$._ajax({url:"/v2/showcase/goods/searchSuggest.json",type:"GET",dataType:"json",timeout:5e3,data:{q:e,kdt_id:window._global.kdt_id},success:function(e){var a=e.code,s=e.data;if(0===a){var i="",r=s.tips,t=r.length;$(".js-tag-clear").addClass("hide"),t>0&&($.each(r,function(e,n){i+="<li><p>"+n+"</p></li>"}),t%2&&(i+="<li><p>&nbsp;</p></li>"),n.html(i).addClass("search-recom-list"))}},error:function(e,n,a){}})},$.fn.searchBar.init=function(){var e,n=window.localStorage,a=$('<div class="search-bar" style="display:none;"></div>'),s=$(['<form class="search-form" action="/v2/search" method="GET">','<input type="search" class="search-input" placeholder="搜索商品" name="q" value="">','<input type="hidden" name="kdt_id" value="'+window._global.kdt_id+'">','<a class="js-search-cancel search-cancel" href="javascript:;">取消</a>','<span class="search-icon"></span>','<span class="close-icon hide"></span>',"</form>"].join("")),i=$('<div class="history-wrap center"></div>'),r=s.find(".js-search-cancel"),t=$('<ul class="history-list search-recom-list js-history-list clearfix"></ul>'),o=$('<a class="tag tag-clear js-tag-clear c-gray-darker hide" href="javascript:;">清除历史搜索</a>'),c=s.find(".search-input"),l=s.find(".close-icon"),d="";return n&&(e=(JSON.parse(n.getItem("searchhistory"))||{}).result)&&($.each(e,function(e,n){d+="<li>"+n+"</li>"}),t.append(d).removeClass("search-recom-list"),o.removeClass("hide")),i.append(t).append(o),a.append(s).append(i),$("body").append(a),$.fn.searchBar.container=a,s.on("submit",function(){var a=$.trim(c.val());if(a.length>100)return void motify.log("搜索关键字不能超过100字");n&&a&&(e=e||[],e=$.grep(e,function(e){return e!=a}),e.unshift(a),n.setItem("searchhistory",JSON.stringify({result:e})))}).on("input",function(){var e=$.trim(c.val());""!==e?(l.removeClass("hide"),$.fn.searchBar.keywords(e,t)):(t.html(d).removeClass("search-recom-list"),i.removeClass("hide"),l.addClass("hide"),o.removeClass("hide"))}),$(".custom-search-input").on("blur",function(){""===$(this).val()&&$(".input-cover").removeClass("hide")}),l.on("click",function(){c.val(""),l.addClass("hide")}),r.on("click",function(){a.css("display","none")}),t.on("click","li",function(e){c.val($(e.currentTarget).text()),s.submit()}),o.on("click",function(){n&&(n.removeItem("searchhistory"),e=null),i.html("")}),a}}),require(["wap/showcase/search_bar/main"],function(e){function n(e){var n=document.createElement("img");n.onload=function(){n.onload=null,n.onerror=null,s(e)},n.onerror=function(){n.onerror=null,n.onload=null,a()},n.src=e}function a(){$(".js-loading-text").html('<span>加载失败，请<a class="redo js-redo" href="javascript:void 0;">重新获取</a>')}function s(e){$(".js-poster-img").attr("src",e),$(".js-loading-view").hide(),$(".js-poster-view").show()}$(function(){$(".js-search").searchBar();var e=$("#js-poster-url").val();$(".js-loading-view").on("click",".js-redo",function(){$(".js-loading-text").html("正在为你生成海报，请稍等..."),n(e)}),e&&n(e)})}),define("main",function(){});