define("zenjs/util/_",[],function(){var e={},t={},n=Array.prototype,i=Object.prototype,o=i.toString,r=n.slice,c=n.forEach,s=Object.keys,a=e.each=e.forEach=function(n,i,o){if(null!=n)if(c&&n.forEach===c)n.forEach(i,o);else if(n.length===+n.length){for(var r=0,s=n.length;r<s;r++)if(i.call(o,n[r],r,n)===t)return}else for(var a=e.keys(n),r=0,s=a.length;r<s;r++)if(i.call(o,n[a[r]],a[r],n)===t)return};return e.keys=s||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var n=[];for(var i in t)e.has(t,i)&&n.push(i);return n},e.has=function(e,t){return null!==e&&Object.hasOwnProperty.call(e,t)},e.extend=function(e){return a(r.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},a(["Arguments","Function","String","Number","Date","RegExp"],function(t){e["is"+t]=function(e){return o.call(e)=="[object "+t+"]"}}),e}),define("zenjs/regions/cache",["require","bower_components/ajax/ajax","jquery","../util/_","../util/local_storage"],function(e){function t(e,t){d.each(d.keys(e),t)}function n(e){return e.charAt(0).toUpperCase()+e.slice(1)}function i(e,t){var n=new f.Deferred;return f._ajax({url:e,dataType:"jsonp",data:t}).then(function(e){0===e.code?n.resolve(e.data):n.reject(e.msg)}).fail(function(){n.reject("fail")}),n.promise()}function o(e){if(void 0!=e){e+="";var t=e.length;return"00"==e.slice(-2)?o(e.slice(0,t-2)):e}}function r(e,t){if(void 0!=e){e+="";var n=t-e.length;if(n>0)for(;n--;)e+="0";return e}}function c(e,n){t(e,function(t){n[t]=e[t]})}function s(e,t){var n;return t=d.extend({},t),g&&g._beforeStr==e?g:(n=d.isString(e)?e.indexOf("r")!=-1?m.cacheAll(t):e.indexOf("c")!=-1?m.cacheProvinceCityList(t):m.cacheProvinceList(t):m.cacheProvinceList(t),g=n,g._beforeStr=e,n)}function a(e,n){var s,a=new f.Deferred;if(n=d.extend({},n),e<0)return[];if(void 0===e)return s=[],t(y.province_list,function(e){s.push({id:e,name:y.province_list[e]})}),a.resolve(s),a.promise();var l,u=o(e),h=[];if(e=r(e,6),void 0===(l=p[Math.floor(u.length/2)]))a.resolve(h);else if(t(y[l],function(e){e.slice(0,u.length)==u&&h.push({id:e,name:y[l][e]})}),0===h.length){var g=v.list;if(void 0!==_[e])return _[e];_[e]=a.promise(),i(g,{region_id:e,display_short_name:n.short||0}).then(function(e){c(e,y[l]),t(e,function(t){h.push({id:t,name:e[t]})}),a.resolve(h)}).always(function(){delete _[e]})}else a.resolve(h);return a.promise()}function l(e,t){return t=d.extend({},t),g?g.then(function(){return a(e,t)}):a(e,t)}function u(e){var t;for(var n in y)t||(t=y[n][e]);return t}e("bower_components/ajax/ajax");var f=e("jquery"),d=e("../util/_"),h=(e("../util/local_storage"),window._global.url.www+"/common/region"),v={cityList:"/cityList.jsonp",countyList:"/countyList.jsonp",provinceList:"/provinceList.jsonp",provinceCityList:"/provinceCityList.jsonp",list:"/list.jsonp",all:"/all.jsonp"},p=["province_list","city_list","county_list"],y={province_list:{110000:"北京市",120000:"天津市",130000:"河北省",140000:"山西省",150000:"内蒙古自治区",210000:"辽宁省",220000:"吉林省",230000:"黑龙江省",310000:"上海市",320000:"江苏省",330000:"浙江省",340000:"安徽省",350000:"福建省",360000:"江西省",370000:"山东省",410000:"河南省",420000:"湖北省",430000:"湖南省",440000:"广东省",450000:"广西壮族自治区",460000:"海南省",500000:"重庆市",510000:"四川省",520000:"贵州省",530000:"云南省",540000:"西藏自治区",610000:"陕西省",620000:"甘肃省",630000:"青海省",640000:"宁夏回族自治区",650000:"新疆维吾尔自治区",710000:"台湾省",810000:"香港特别行政区",820000:"澳门特别行政区"}};!function(){y.preloaded={provinceList:!0}}(),function(){t(p,function(e){y[p[e]]||(y[p[e]]={})})}();var g,m={},_={};return t(v,function(e){v[e]=h+v[e],["provinceList","provinceCityList","all"].indexOf(e)!=-1&&(m["cache"+n(e)]=function(t){return y.preloaded[e]?f.Deferred().resolve(y):(t=d.extend({},t),i(v[e],{display_short_name:t.short||0}).then(function(t){return d.extend(y,"provinceList"==e?{province_list:t}:t),f.Deferred().resolve(y)}))})}),{preload:s,loadList:l,getNameById:u}}),define("zenjs/regions/selector",["require","../util/_","./cache","jquery"],function(e){var t=e("../util/_"),n=e("./cache"),i=e("jquery"),o=function(e){t.extend(this,e),this.selects=["province","city","county"],this.selectsDefault={province:e.province_text||"选择省份",city:e.city_text||"选择城市",county:e.county_text||"选择地区"},this.init(),this.lastPromise=new i.Deferred};return o.prototype={init:function(){var e=this;this.selects.forEach(function(t){e[t]&&e[t].html(e.createDefault(e.selectsDefault[t]))}),n.preload("p",{short:this.short}),this.selectPromise=this.resetSelect("province"),this.province.on("change",function(){var t=i(this).val();e.onProvinceChange&&e.onProvinceChange(t),e.lastPromise=e.resetSelect("city",t,{loading:!0}).then(function(){e.city.trigger("change",{auto:!0})})}),this.city.on("change",function(){var t=i(this).val();e.lastPromise=e.resetSelect("county",t,{loading:!0}).then(function(){e.county.trigger("change",{auto:!0})})}),this.ip2address&&setTimeout(function(){e.hasCalledSelectFun||e.getIp2AddressData()},0)},createDefault:function(e){return'<option value="-1">'+e+"</option>"},createOption:function(e,t){return"<option value="+t+">"+e+"</option>"},resetSelect:function(e,t,i){var o=this[e],r=this;if(o)return t==-1&&o.html(r.createDefault(r.selectsDefault[e])),i=i||{},i.loading&&o.attr("disabled",!0).html(r.createDefault("加载中...")),n.loadList(t,{short:this.short}).then(function(t){var n="";n=r.createDefault(r.selectsDefault[e]),t.forEach(function(e){n+=r.createOption(e.name,e.id)}),o.removeAttr("disabled").html(n)})},select:function(e){if(null!=e&&/\d{6}/.test(e)){e+="",this.hasCalledSelectFun=!0;var t=this,n=this.selectOption;this.selectPromise.then(function(){var i=e.slice(0,2)+"0000";return n(t.province,i),t.resetSelect("city",i)}).then(function(){var i=e.slice(0,4)+"00";return n(t.city,i),"00"==e.slice(2,4)&&(i=t.city.find("option:selected").val()),t.resetSelect("county",i)}).then(function(){n(t.county,e)})}},selectOption:function(e,t){var n=!1;e.find("option").each(function(){n=n||i(this).val()==t});var o=i(e.find("option")[0]).val()||"-1";e.val(n?t:o).trigger("change")},getNames:function(){var e=this,t={};return this.selects.forEach(function(n){t[n]=e[n].find("option:selected").text()}),t},getValues:function(){var e=this,t={};return this.selects.forEach(function(n){t[n]=e[n].find("option:selected").val()}),t},getLastPromise:function(){return this.lastPromise},getIp2AddressData:function(){var e=this;i._ajax({url:window._global.url.www+"/common/region/addressByIp.jsonp",dataType:"jsonp"}).then(function(t){if(!e.hasCalledSelectFun&&t&&0==t.code&&t.data){var n=e.getValues();if(!n||6!=(n.province_id+"").length){var i=t.data;i.county_id?e.select(i.county_id):i.city_id?e.select(i.city_id):i.province_id&&e.select(i.province_id)}}})}},o}),require(["zenjs/regions/selector"],function(e){"use strict";Backbone.EventCenter=_.extend({},Backbone.Events);var t={name:"姓名",gender:"性别"};new(Backbone.View.extend({initialize:function(e){this.form=this.$(".js-user-form"),this.render()},events:{"click .js-save-info":"handleSaveUserInfo"},handleSaveUserInfo:function(){var e,n=this,i={},o=this.areaSelectView.getValues()||{};_.each(this.form.find("input"),function(e){var t=$(e);i[t.prop("name")]=t.val()}),i.area_code=o.county||o.city||o.province,i.gender=this.$("#gender").find(":selected").val(),void 0===(e=_.find(i,function(e,n){return!e&&t[n]?(motify.log("请输入"+t[n]),!0):"birthday"===n&&e&&!/^(19|20)(\d){2}[-\/](0[1-9]|1[0-2])[-\/](0[1-9]|[12][0-9]|3[0-1])$/.test(e)?(motify.log("请输入正确的生日日期，例如 1990-01-01"),!0):void 0}))&&$._ajax({url:"/v2/card/membercard/userinfo.json",type:"POST",data:i,beforeSend:function(){n.$(".js-save-info").prop("disabled",!0)},complete:function(){n.$(".js-save-info").prop("disabled",!1)},success:function(e){0==e.code?window.location.href=window._global.url.wap+"/card/membercard/list?kdt_id="+window._global.kdt_id:motify.log(e.msg||"信息提交失败，请稍后再试")}})},render:function(){this.areaSelectView=new e({province:this.$(".js-province"),city:this.$(".js-city"),county:this.$(".js-county")});var t=this.$(".js-area-layout").data("area-code");return t&&this.areaSelectView.select(t),"ios"===window._global.mobile_system&&(this.$(".js-area-layout select").on("touchend",function(e){e.stopPropagation()}),this.$("#gender").on("touchend",function(e){e.stopPropagation()}),this.$("#birthday").on("touchend",function(e){e.stopPropagation()})),this}}))({el:$("body")})}),define("main",function(){});