define("zenjs/util/event",["require","jquery"],function(t){var i=t("jquery"),e={getTargetByDataKey:function(t,e){for(var s=i(t.target);!s.data(e)&&0!==s.data(e)&&"BODY"!=(s[0]||{}).nodeName;)s=s.parent();return s},getEventHandler:function(){var t=function(){};return i.extend(!0,t.prototype,e.methods),new t},methods:{events:{},on:function(t,i){return"string"==typeof t&&"[object Function]"===Object.prototype.toString.call(i)&&(this.events[t]||(this.events[t]=[]),this.events[t].push(i))},trigger:function(t){if("string"!=typeof t)return!1;if(!this.events[t])return this.events[t]=[],!1;for(var i=this.events[t],e=Array.prototype.slice.apply(arguments,[1]),s=0,o=i.length;s<o;s++)i[s](e)},off:function(t,i){if(!t&&!i)return void(this.events={});if(!i)return void(this.events[t]=[]);var e=this.events[t],s=e.indexOf(i);e.splice(s,1)}}};return e}),define("zenjs/backbone/tabber",["require","../util/event","backbone"],function(t){var i=t("../util/event"),e=t("backbone"),s=function(){};return e.View.extend({initialize:function(t){this.activeKey=t.activeKey||"type",this.activeClass=t.activeClass||"active",this.hashAsDefaultData=!!t.hashAsDefaultData,this.cbOnClicked=t.onClicked||s,this.cbOnDisabledClicked=t.onDisabledClicked||s,this.initDefault(t)},events:{click:"onClicked"},initDefault:function(t){var i=e.history.getHash();t.hashAsDefaultData&&i?this.active(i):t.defaultData&&t.defaultData.length>0&&this.active(t.defaultData)},onClicked:function(t){if(t.target&&0!==t.target.length){var e=i.getTargetByDataKey(t,this.activeKey),s=""+e.data(this.activeKey);if(void 0===this.firstClick?this.firstClick=!0:this.firstClick=!1,e.blur(),s&&"undefined"!==s&&this.activeData!==s&&s&&s.length>0){if(this.disabled===!0)return void(this.activeData!==s&&this.cbOnDisabledClicked());if(this.hashAsDefaultData){var o=location.href.replace(/(javascript:|#).*$/,"");location.replace(o+"#"+s)}this.$("."+this.activeClass).removeClass(this.activeClass),e.addClass(this.activeClass),this.activeData=s,this.cbOnClicked(_.extend(t||{},{value:s,nTarget:e}))}}},active:function(t,i){this.onClicked(_.extend({target:this.$el.find("[data-"+this.activeKey+'="'+t+'"]:first')},i||{}))},setDisable:function(t){this.disabled=t},setData:function(t){this.activeData=t,this.$("."+this.activeClass).removeClass(this.activeClass),this.$el.find("[data-"+this.activeKey+'="'+this.activeData+'"]:first').addClass(this.activeClass)},getData:function(){return this.activeData}})}),define("zenjs/backbone/base_view",["require","backbone","../core/trigger_method"],function(t){var i=t("backbone"),e=t("../core/trigger_method");return i.View.extend({clean:function(){return this.stopListening(),this},triggerMethod:e})}),define("bower_components/zenlist/list",["require","exports","module","zenjs/backbone/base_view"],function(t,i,e){var s=function(){},o=t("zenjs/backbone/base_view");e.exports=o.extend({initialize:function(t){return this.options=t=t||{},this.items=[],this.itemView=t.itemView,this.itemOptions=t.itemOptions||{},this.collection=t.collection,this.onAfterListChange=t.onAfterListChange||s,this.onAfterListLoad=t.onAfterListLoad||s,this.onAfterListDisplay=t.onAfterListDisplay||s,this.onListEmpty=t.onListEmpty||t.onEmptyList||this._onListEmpty,this.onItemClick=t.onItemClick||s,this.onViewItemAdded=t.onViewItemAdded||s,this.displaySize=t.displaySize||-1,this.emptyHTML=t.emptyHTML||"",this.emptyText=t.emptyText||"列表为空",this},render:function(t){return this.displaySize=(t||{}).displaySize==-1?-1:this.displaySize,this.clean(),this._setupListeners(),this.addAll(),this.onAfterListDisplay({list:this.collection}),this},fetchRender:function(t){return this.collection.fetch({data:t,success:_(function(t,i){this.render(),this.onAfterListLoad(this.collection,i),this.onFetchSuccess&&this.onFetchSuccess()}).bind(this),error:_.bind(function(){this.onAfterListLoad(this.collection,response)},this)}),this},_setupListeners:function(){this.collection&&(this.stopListening(this.collection),this.listenTo(this.collection,"add",this.addItem,this),this.listenTo(this.collection,"reset sort",this.render,this),this.listenTo(this.collection,"remove",this.onItemRemoved,this))},addItemListeners:function(t){var i=this;this.listenTo(t,"all",function(){var i="item:"+arguments[0],e=_.toArray(arguments);e.splice(0,1),e.unshift(i,t),this.trigger.apply(this,e),"item:click"==i&&this.onItemClick()}),this.listenTo(t.model,"change",function(){i.onAfterListChange({list:this.collection})})},addAll:function(){0===this.collection.length?this.fetching||this.triggerMethod("list:empty"):this.collection.each(function(t){this.addItem(t)},this)},removeAll:function(){for(var t=this.items.length-1;t>=0;t--)this.removeView(this.items[t]);this.onAfterListChange({list:this.collection})},addItem:function(t,i,e){if(!(this.displaySize>=0&&this.items.length>=this.displaySize)){1==this.collection.length&&(this.listEl||this.$el).html("");var s=new this.itemView(_.extend({},this.options.itemOptions,{model:t,index:this.collection.indexOf(t)}));this.items.push(s),this.addItemListeners(s),s.render(),this.onViewItemAdded({list:this.items,viewItem:s,model:t});return 0===(e||{}).at?(this.listEl||this.$el).prepend(s.el):(this.listEl||this.$el).append(s.el),s}},removeItem:function(t){var i=this.getViewByModel(t);i&&this.removeView(i)},removeView:function(t){var i;this.stopListening(t),t&&(this.stopListening(t.model),t.remove(),i=this.items.indexOf(t),this.items.splice(i,1)),0===this.collection.length&&(this.fetching||this.triggerMethod("list:empty"))},onItemRemoved:function(t){this.onAfterListChange({list:this.collection,action:"remove",model:t}),this.removeItem(t)},getViewByModel:function(t){return _.find(this.items,function(i,e){return i.model===t})},dispatchEventToAllViews:function(t,i){for(var e=this.items.length-1;e>=0;e--)this.items[e].trigger(t,i)},remove:function(){o.prototype.remove.call(this,arguments),this.removeAll(),this.collection.reset(),delete this.collection},clean:function(){o.prototype.clean.call(this,arguments),this.removeAll(),(this.listEl||this.$el).html(""),this.stopListening(this.collection)},_onListEmpty:function(){this.$el.html(this.emptyHTML||(this.emptyText?'<p style="text-align:center;line-height:60px;">'+this.emptyText+"</p>":""))}})}),define("wap/ump/package_buy/list/collections/goods",["require","zenjs/util/cookie"],function(t){var i=t("zenjs/util/cookie");return Backbone.Collection.extend({initialize:function(t,i){this.activity=i.activity||{},this.packagebuy_from_goods=i.packagebuy_from_goods,this.store_id=i.store_id,this.activity_price=this.activity.price||0},getShowData:function(){var t={},i=0;return _.each(this.models,function(t){i+=t.get("origin_price")||t.get("price")||0}),t.activity_price=this.activity_price,t.totalOriginPrice=i,t.save=i-this.activity_price,t},getPayData:function(){var t={};t.common=JSON.stringify({kdt_id:this.activity.kdt_id,store_id:this.store_id,activity_alias:this.activity.alias,activity_id:this.activity.id,activity_type:7});var e=[];_.each(this.models,function(t){var s={};s.goods_id=t.get("id"),s.num=1,s.sku_id=t.get("selected_sku_id"),s.price=t.get("selected_price"),s.dc_ps=i("dc_ps")||"",e.push(s)}),t.goodsList=JSON.stringify(e);var s={log:{act_name:"pack",spm:"pack"+this.activity.id,sf:this.packagebuy_from_goods?"goods":"qr"}};return t.extra=JSON.stringify(s),t},isValid:function(){var t=!0;return _.every(this.models,function(i){return i.get("selected_sku_id")||(i.trigger("sku:error"),t=!1,motify.log("请选择商品规格")),t}),t}})}),define("text!wap/ump/package_buy/list/templates/list_item.html",[],function(){return'<% if (getIsActive()) { %>\n\t<div class="active-top-border clearfix font-szie-12 c-gray-dark">\n\t\t搭配以下商品很赞哦\n\t</div>\n<% } %>\n\n<a class="thumb" href="<%= URLHelper.site(\'/goods/\' + data.alias, \'wap\') %>">\n\t<img src="<%= URLHelper.getCdnImageUrl(data.thumb_url, \'!200x200.jpg\') %>"/>\n</a>\n<div class="detail">\n\t<a class="goods-title row c-black font-size-12"\n\t\thref="<%= URLHelper.site(\'/goods/\' + data.alias, \'wap\') %>"><%= data.title %></a>\n\t<div class="row">\n\t\t<p class="c-gray-darker pull-right">x1</p>\n\t\t<p class="c-orange font-size-12">原价：¥ <%= yuanToCent(data.origin_price || data.price) %></p>\n\t</div>\n\t<% if(data.has_multi_skus) { %>\n\t<div class="row">\n\t\t<span class="js-sel-sku sku-tag tag tag-white">\n\t\t\t<%= getSKUName(data.sku_names) %>\n\t\t</span>\n\t</div>\n\t<% } %>\n</div>\n'}),define("zenjs/util/url_helper",[],function(){return{site:function(t,i){var e=window._global.env,s=window._global.url;"static"===i&&"online"===e&&(i="cdn_static");var o=t;return i=i?s[i]||"":"",t.search(/^http[s]?\:\/\//)==-1&&("/"!==t[0]&&(t="/"+t),o=i+t),o},getCdnImageUrl:function(t,i){if(!t)return window._global.url.cdn_static+"/image/wap/no_pic.png";if(i=t.match(/.+\!\d+x\d+.+/)?"":i&&i.length>0?i:"!100x100.jpg",t.match(/^(https?:)?\/\//i)){for(var e=[/^(https?:)?\/\/imgqn.koudaitong.com/,/^(https?:)?\/\/kdt-img.koudaitong.com/,/^(https?:)?\/\/img.yzcdn.cn/,/^(https?:)?\/\/dn-kdt-img.qbox.me/],s=0;s<e.length;s++)t=t.replace(e[s],window._global.url.imgqn);return t+i}return window._global.url.imgqn+"/"+t+i}}}),define("zenjs/util/money",["require"],function(t){"use strict";function i(t){return t=parseFloat(t,10),i._isNaN(t)?NaN:t.toFixed(2)}return i.add=function(t,e){return t=parseFloat(t,10),e=parseFloat(e,10),i(t+e)},i.minus=function(t,e){return t=parseFloat(t,10),e=parseFloat(e,10),i(t-e)},i.multiply=function(t,e){return t=parseFloat(t,10),e=parseFloat(e,10),i(t*e)},i.toCent=function(t){return Math.round(100*parseFloat(t))},i._isNaN=function(t){return i._isNumber(t)&&t!=+t},i._isNumber=function(t){return"[object Number]"==Object.prototype.toString.call(t)},i}),define("zenjs/util/number",[],function(){return{makeRandomString:function(t){var i="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";t=t||10;for(var s=0;s<t;s++)i+=e.charAt(Math.floor(Math.random()*e.length));return i}}}),define("bower_components/pop/pop",["require","zenjs/events","zenjs/util/number"],function(t){var i=function(){},e=t("zenjs/events"),s=t("zenjs/util/number");return window.zenjs=window.zenjs||{},e.extend({init:function(t){this._window=$(window);var e=s.makeRandomString();$("body").append('<div id="'+e+'"                 style="display:none; height: 100%;                 position: fixed; top: 0; left: 0; right: 0;                background-color: rgba(0, 0, 0, '+(t.transparent||".7")+');z-index:1000;opacity:0;transition: opacity ease 0.2s;"></div>'),this.nBg=$("#"+e),this.nBg.on("click",$.proxy(function(){this.isCanNotHide||this.hide()},this));var o=s.makeRandomString();$("body").append('<div id="'+o+'" class="'+(t.className||"")+'" style="overflow:hidden;visibility: hidden;"></div>'),this.nPopContainer=$("#"+o),this.nPopContainer.hide(),this.nPopContainer.css({opacity:0,position:"absolute","z-index":1e3}),t.contentViewClass&&(this.contentViewClass=t.contentViewClass,this.contentViewOptions=$.extend({el:this.nPopContainer},t.contentViewOptions||{}),this.contentView=new this.contentViewClass($.extend({onHide:$.proxy(this.hide,this)},this.contentViewOptions)),this.contentView.onHide=$.proxy(this.hide,this)),this.animationTime=t.animationTime||300,this.isCanNotHide=t.isCanNotHide,this.doNotRemoveOnHide=t.doNotRemoveOnHide||!1,this.onShow=t.onShow||i,this.onHide=t.onHide||i,this.onFinishHide=t.onFinishHide||i,this.html=t.html},render:function(t){return this.renderOptions=t||{},this.contentViewClass?this.contentView.render(this.renderOptions):this.html&&this.nPopContainer.html(this.html),this},show:function(){return this.nBg.show().css({opacity:"1","transition-property":"none"}),this.nPopContainer.show(),this.trigger("pop:show:before"),setTimeout($.proxy(function(){this.trigger("pop:show:after"),this.nPopContainer.show().css("visibility","visible"),this._doShow&&this._doShow(),this.onShow()},this),200),this},hide:function(t){t=t||{};var i=t.doNotRemove||this.doNotRemoveOnHide||!1;this._doHide&&this._doHide(),this.trigger("pop:hide:before"),setTimeout($.proxy(function(){this.nBg.css({opacity:0,"transition-property":"opacity"}),this.trigger("pop:hide:after"),setTimeout($.proxy(function(){this.nBg.hide(),this.nPopContainer.hide(),i||this.destroy()},this),200)},this),this.animationTime),this.onHide()},destroy:function(){return this.nPopContainer.remove(),this.nBg.remove(),this.contentView&&this.contentView.remove(),this}})}),define("bower_components/pop/pop_forbid_scroll",["require","./pop"],function(t){return window.zenjs=window.zenjs||{},t("./pop").extend({init:function(t){this._super(t),t.doNotForbidScroll||(this.on("pop:show:before",$.proxy(this.onBeforePopShow,this)),this.on("pop:show:after",$.proxy(this.onAfterPopShow,this)),this.on("pop:hide:after",$.proxy(this.onAfterPopHide,this)))},onBeforePopShow:function(){this.top=this._window.scrollTop()},onAfterPopShow:function(){this._window.scrollTop(0),this.startShow()},onAfterPopHide:function(){var t,i=function(e){if(t!==this._window.scrollTop()&&e>0)return this._window.scrollTop(t),void setTimeout($.proxy(i,this,e-1));setTimeout($.proxy(this.onFinishHide,this),50)};return function(){this.startHide(),t=this.top,this._window.scrollTop(t),$.proxy(i,this)(2),setTimeout($.proxy(function(){window.zenjs.popList.length<1&&$("html").css("position",this.htmlPosition)},this),200)}}(),startShow:function(){var t=window.zenjs.popList;if(t||(t=window.zenjs.popList=[]),0===t.length){var i=$("body"),e=$("html");this.htmlPosition=e.css("position"),e.css("position","relative"),this.bodyCss=(i.prop("style")||{}).cssText,this.htmlCss=(e.prop("style")||{}).cssText,$("body,html").css({overflow:"hidden",height:this._window.height(),"padding-bottom":0,"margin-bottom":0})}t.indexOf(this)<0&&t.push(this)},startHide:function(){var t=window.zenjs.popList,i=t.indexOf(this);i>-1&&t.splice(i,1),t.length<1&&($("html").attr("style",this.htmlCss||""),$("body").attr("style",this.bodyCss||""))}})}),define("bower_components/pop/popup",["require","./pop_forbid_scroll"],function(t){return t("./pop_forbid_scroll").extend({init:function(t){this._super(t),this.onClickBg=t.onClickBg||function(){},this.onBeforePopupShow=t.onBeforePopupShow||function(){},this.onAfterPopupHide=t.onAfterPopupHide||function(){},this.nPopContainer.css($.extend({left:0,right:0,bottom:0,background:"white"},t.containerCss||{})),this.nPopContainer.css("opacity","0"),this.nPopContainer.on("focus","input, textarea",function(t){var i=$(this),e=$(window),s=e.scrollTop(),o=i.offset().top;(o-s<0||o-s>100)&&setTimeout(function(){var t=o-70;e.scrollTop(t)},400)})},_doShow:function(){this.nPopContainer.addClass("popup"),this.contentView&&this.contentView.height?this.height=this.contentView.height():this.contentView||(this.height=this.nPopContainer.height()),this.onBeforePopupShow(),$(".js-close").click($.proxy(function(t){this.hide()},this)),this.nPopContainer.css({height:this.height+"px",transform:"translate3d(0,100%,0)","-webkit-transform":"translate3d(0,100%,0)"}),this.bodyPadding=$("body").css("padding"),$("body").css("padding","0px"),setTimeout($.proxy(function(){this.nPopContainer.css({transform:"translate3d(0,0,0)","-webkit-transform":"translate3d(0,0,0)","-webkit-transition":"all ease "+this.animationTime+"ms",transition:"all ease "+this.animationTime+"ms",opacity:1})},this)),setTimeout($.proxy(function(){this.contentView&&this.contentView.onAfterPopupShow&&this.contentView.onAfterPopupShow()},this),this.animationTime)},_doHide:function(t){this.nPopContainer.css({transform:"translate3d(0,100%,0)","-webkit-transform":"translate3d(0,100%,0)",opacity:0}),setTimeout($.proxy(function(){$("body").css("padding",this.bodyPadding),this.onAfterPopupHide()},this),this.animationTime)}})}),define("wap/ump/package_buy/list/views/goods_list_item",["require","text!../templates/list_item.html","zenjs/util/url_helper","zenjs/util/money","bower_components/pop/popup"],function(t){"use strict";var i=function(){},e=t("text!../templates/list_item.html"),s=t("zenjs/util/url_helper"),o=t("zenjs/util/money"),n=t("bower_components/pop/popup");return Backbone.View.extend({initialize:function(t){this.onSKUChange=t.onSKUChange||i,this.packagebuy_from_goods=t.packagebuy_from_goods,this.listenTo(this.model,"sku:error",_(this.onSkuUnselect).bind(this))},className:"package-name-card block-item name-card",template:_.template(e),events:{"click .js-sel-sku":"onSKUChangeClick"},render:function(){if(!this.model.get("has_multi_skus")){var t=this.model.get("skus"),i=t[0].id;this.model.set("selected_sku_id",i),this.model.set("selected_price",this.model.get("price")),this.model.set("origin_price",this.model.get("price"))}1==this.getIsActive()&&this.$el.addClass("active"),this.renderElement()},renderElement:function(){var t=this;this.$el.html(this.template({data:this.model.toJSON(),URLHelper:s,getIsActive:function(){return t.getIsActive()},getSKUName:function(t){t=t||[];var i=t.join(" ");return i?i:"选择商品规格"},yuanToCent:function(t){return o(t/100)}}))},getIsActive:function(){return 1==this.model.collection.indexOf(this.model)&&this.packagebuy_from_goods},onSKUChangeClick:function(t){var i=this;if(!this.sku_ajaxing){if(this.renderOption)return void this.doShowSku();var e=$(t.target),s=this.model.get("id"),o=this.model.get("title"),n=this.model.get("thumb_url");$._ajax({type:"get",timeout:5e3,url:"/v2/ump/packagebuy/goodsSkusInfo.json",data:{activity_id:this.model.collection.activity.id||"",goods_id:this.model.get("id")||""},dataType:"json",cache:!1,beforeSend:function(){i.sku_ajaxing=!0,e.addClass("ajax-loading")},success:function(t){if(0!=+t.code)return void motify.log(t.msg);var e=t.data;e.list=i.model.get("skus"),i.renderOption={sku:e,goods_id:s,goods_info:{title:o,picture:[n],price:e.price,origin:""},activity_alias:window._global.activity_alias,activity_id:window._global.activity_id,activity_type:window._global.activity_type,confirmBtnText:"确定",isHideNumberSelect:!0},i.doShowSku()},error:function(t,i,e){motify.log("出了点小问题，等下再试试")},complete:function(){i.sku_ajaxing=!1,e.removeClass("ajax-loading")}})}},doShowSku:function(){var t=this;this.skuView=new n({contentViewClass:BuyView,className:"sku-layout sku-box-shadow",contentViewOptions:{skuViewConfig:{top:50},need_ajax_login:window._global.need_ajax_login,isCartBtnHide:!0,logURL:window._global.logURL,baseUrl:window._global.wap_url.wap,wxpay_env:window._global.wxpay_env,onSubmitClick:function(i){t.model.set("selected_sku_id",i.sku_id),t.model.set("selected_price",i.price),t.model.set("origin_price",i.price),t.model.set("sku_names",i.sku_names),t.renderElement(),t.onSKUChange()}},isCanNotHide:!1}),this.skuView.render($.extend({},this.renderOption,{selectedSkuId:this.model.get("selected_sku_id")})).show()},onSkuUnselect:function(){var t=this.$(".js-sel-sku ");t.addClass("sku-error").one("click",function(i){t.removeClass("sku-error")})}})}),define("wap/ump/package_buy/list/views/all_goods_list",["require","bower_components/zenlist/list","../collections/goods","./goods_list_item","bower_components/wap_common/base/log"],function(t){"use strict";var i=t("bower_components/zenlist/list"),e=t("../collections/goods"),s=t("./goods_list_item"),o=t("bower_components/wap_common/base/log");return Backbone.View.extend({initialize:function(t){this.goods_list=t.goods_list||{},this.activity=t.activity||{},this.packagebuy_from_goods=t.packagebuy_from_goods,this.store_id=t.store_id,this.goodsListViewMap={}},showPackage:function(t){var i=_.keys(this.goods_list);t=t||i[0],this.goodsListViewMap[t]||this.initSingleGoodsList(t),this.currenListView&&this.currenListView.$el.addClass("hide"),this.goodsListViewMap[t].$el.removeClass("hide"),this.currenListView=this.goodsListViewMap[t],this.model.set("current_goods_list",this.currenListView.collection)},initSingleGoodsList:function(t){var o=this.goods_list[t],n=new e(o,{activity:this.activity[t],packagebuy_from_goods:this.packagebuy_from_goods,store_id:this.store_id}),a=new i({className:"package-block-list block-list block border-top-0",collection:n,itemView:s,itemOptions:{packagebuy_from_goods:this.packagebuy_from_goods,onSKUChange:_.bind(this.onSKUChange,this)}}).render();this.logActivityOnShow(this.activity[t]),this.$el.append(a.el),this.goodsListViewMap[t]=a},onSKUChange:function(t){this.model.trigger("change:sku")},logActivityOnShow:function(t){var i=this.packagebuy_from_goods?"goods":"qr",e=t.id;o.log({sf:i,spm:"pack"+e,fm:"display",act_name:"pack"})}})}),define("wap/ump/package_buy/list/models/all_goods_list",["require"],function(t){return Backbone.Model.extend({isValid:function(){return this.get("current_goods_list").isValid()},getPayAreaData:function(){return this.get("current_goods_list").getShowData()},getPayData:function(){return this.get("current_goods_list").getPayData()}})}),define("text!wap/ump/package_buy/list/templates/pay_area.html",[],function(){return'<div class="js-buy package-buy pull-right font-size-14">\n    立即购买\n</div>\n<div class="pay-info text-right font-size-12">\n    <p>\n        <span class="c-orange">套餐价：¥<%= money(data.activity_price/100) %></span>\n        <span class="c-gray-dark">(不含运费)</span>\n    </p>\n    <p class="c-gray-dark">\n        为你节省：¥<%= money(data.save/100) %>\n    </p>\n</div>\n'}),define("zenjs/util/jump_to_url",["require","bower_components/youzanjsbridge/api"],function(t){var i=t("bower_components/youzanjsbridge/api");return function(t){"youzanmars"==_global.platform?i.gotoWebview({page:"web",url:t}):location.href=t}}),define("wap/ump/package_buy/list/views/pay_area",["require","zenjs/util/args","bower_components/wap_common/base/make_url_log","text!../templates/pay_area.html","zenjs/util/money","zenjs/util/jump_to_url","bower_components/wap_common/base/log"],function(t){"use strict";var i=t("zenjs/util/args"),e=t("bower_components/wap_common/base/make_url_log"),s=t("text!../templates/pay_area.html"),o=t("zenjs/util/money"),n=t("zenjs/util/jump_to_url"),a=t("bower_components/wap_common/base/log");return Backbone.View.extend({template:_.template(s),initialize:function(t){this.packagebuy_from_goods=t.packagebuy_from_goods,this.listenTo(this.model,"change:current_goods_list",_(this.render).bind(this)),this.listenTo(this.model,"change:sku",_(this.render).bind(this))},render:function(){return this.$el.html(this.template({data:this.model.getPayAreaData(),money:o})),this},events:{"click .js-buy":"onBuyClick"},onBuyClick:function(t){if(this.model.isValid()){var s=this,o=this.model.getPayData(),r=JSON.parse(o.common);a.log({sf:this.packagebuy_from_goods?"goods":"qr",spm:"pack"+r.activity_id,fm:"click",title:"buy",act_name:"pack"}),$._ajax({url:"/v2/trade/common/cache.json",type:"POST",dataType:"json",data:o,timeout:15e3,beforeSend:function(){s.ajaxing=!0},success:function(t){var s=+t.code,o=t.data;if(0!==s)return void motify.log(t.msg);var a=window._global.url.trade+o.url;a=i.add(a,{showwxpaytitle:1,kdt_id:window._global.kdt_id}),a=i.add(a,{use_wxpay:window._global.wxpay_env?1:0}),a=e(a),a=i.add(a,{page_version:window._global.page_version||"unknown",platform:window._global.platform});var r=i.add(a,{book_key:o.key});n(r)},error:function(){motify.log("购买失败，请重试。")},complete:function(){s.ajaxing=!1}})}}})}),require(["zenjs/backbone/tabber","wap/ump/package_buy/list/views/all_goods_list","wap/ump/package_buy/list/models/all_goods_list","wap/ump/package_buy/list/views/pay_area"],function(t,i,e,s){"use strict";new(Backbone.View.extend({initialize:function(t){this._global=t._global||{},this.render()},events:{},render:function(){this.allGoodsListModel=new e,this.allGoodsListView=new i({el:this.$(".js-goods-list"),goods_list:this._global.goods_list,activity:this._global.activity,packagebuy_from_goods:this._global.packagebuy_from_goods,store_id:this._global.offline_id,model:this.allGoodsListModel}),this.$(".js-tabber").length>0?this.initTabber():this.allGoodsListView.showPackage(),this.payAreaView=new s({el:this.$(".js-total-price"),model:this.allGoodsListModel,packagebuy_from_goods:this._global.packagebuy_from_goods}).render()},initTabber:function(){var i=_.keys(this._global.goods_list).shift();new t({el:this.$(".js-tabber"),activeClass:"active",activeKey:"type",defaultData:i,onClicked:_(this.onTabberClicked).bind(this)})},onTabberClicked:function(t){var i=t.value;this.allGoodsListView.showPackage(i)}}))({el:$("body"),_global:window._global})}),define("main",function(){});