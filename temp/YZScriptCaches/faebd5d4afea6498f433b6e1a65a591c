define("zenjs/sms_fetch/main",["require","exports","module","bower_components/ajax/ajax","zenjs/util/args","jquery"],function(i,t,e){function o(){this.loadingLock=!1,this.isUsed=void 0}function n(i){i=i||{},this.$el=r(i.el||i.$el||"<div></div>"),this.el=this.$el[0],this.$=function(i){return this.$el.find(i)},this.initialize&&this.initialize(i)}i("bower_components/ajax/ajax");var s=i("zenjs/util/args"),r=i("jquery"),a=function(){};o.prototype={fetch:function(){if(this.isUsed!==!1){var i=this;this.loadingLock=!0,r._ajax({url:window._global.url.www.replace(/^https?:\/\//,"//")+"/common/token/token.jsonp",type:"get",dataType:"jsonp"}).done(function(t){0==t.code?(i.token=t.data,i.loadingLock=!1,i.isUsed=!1):motify.log(t.msg)}).fail(function(){motify.log("token 获取失败")})}},get:function(){return this.isUsed=!0,this.token}};var u=new o;r.extend(n.prototype,{initialize:function(i){this.duration=i.time||60,this.step=i.step||1100,this.codeVerifyClass=i.codeVerifyClass||"js-verify-code",this.verifyType="smsFetch";var t=window._global.url.www.replace(/^https?:\/\//,"//");this.smsFetchUrl=t+"/common/sms/captcha.jsonp",this.imgUrl=t+"/common/sms/imgcaptcha",this.imgVerifyUrl=t+"/common/sms/imgcaptcha.jsonp",this.biz=i.biz||"kdt_account_captcha",this.onTimeChange=i.onTimeChange||a,this.onTimeEnd=i.onTimeEnd||a,this.onTimerStart=i.onTimerStart||a,this.onTimerClose=i.onTimerClose||a,this.onVerifyPictureShow=i.onVerifyPictureShow||a,this.onGetCodeError=i.onGetCodeError||a,this.onVerifyPictureSuccess=i.onVerifyPictureSuccess||a,this.onVerifyPictureError=i.onVerifyPictureError||a,this.platform=i.platform||"",this.subFrom=i.subFrom||"",u.fetch()},setMobile:function(i){i&&(this.mobile=i)},getImageCode:function(){return r.trim(this.$("."+this.codeVerifyClass).val())},getSms:function(i){var t=this;if(u.loadingLock)return void motify.log("数据加载中，稍后再试");if(i=i||{},i.mobile&&(this.mobile=i.mobile),!this.mobile)return!1;var e={smsFetch:t.onSmsFetchHandler,image:t.onImageHandler};return t.startTimer.call(t),(e[t.verifyType]||a).call(t),this},startTimer:function(){this.onTimerStart(),this.btnCountdown(this.duration)},stopTimer:function(){clearTimeout(this.timer),this.onTimerClose()},btnCountdown:function(i){var t=this;this.onTimeChange({second:i}),--i>=0?this.timer=setTimeout(function(){t.btnCountdown(i)},this.step):(this.onTimeEnd(),this.timer="")},onVerifyImageShow:function(i){this.$(".js-image-verify").removeClass("hide"),this.$(".js-verify-image").attr("src",i)},onVerifyImageHide:function(){this.$(".js-image-verify").addClass("hide")},onSmsFetchHandler:function(){var i=1;return function(){var t=this,e={verifyTimes:i,mobile:this.mobile,biz:this.biz,token:u.get()};this.platform&&(e.platform=this.platform),this.subFrom&&(e.sub_from=this.subFrom),r._ajax({url:this.smsFetchUrl,dataType:"jsonp",data:e,success:function(e){if(0==e.code)return void i++;t.stopTimer.call(t),t.onGetCodeError.call(t),10111===e.code?(t.verifyType="image",t.onVerifyImageShow(t.imgUrl),t.onVerifyPictureShow()):(i++,motify.log(e.msg))},error:function(e,o,n){i++,t.stopTimer.call(t),t.onGetCodeError.call(t),motify.log("获取验证码失败，请稍后再试")},complete:function(i,t){}}).always(function(){u.fetch()})}}(),onImageHandler:function(){var i=this,t=this.mobile;r._ajax({url:this.imgVerifyUrl,dataType:"jsonp",data:{mobile:t,captcha_code:this.getImageCode()},success:function(e){if(0===e.code)return i.verifyType="smsFetch",i.mobile=t,i.onVerifyImageHide(),i.onVerifyPictureSuccess(),void i.onSmsFetchHandler();i.stopTimer.call(i),i.onVerifyPictureError.call(i),10100===e.code?(motify.log(e.msg),i.reloadCaptcha()):motify.log(e.msg)},error:function(t,e,o){i.stopTimer.call(i),i.onVerifyPictureError.call(i),motify.log("图形验证失败，重试一下吧~"),i.reloadCaptcha()},complete:function(i,t){}})},reloadCaptcha:function(){var i=s.add(this.imgUrl,{stamp:new Date});this.$el.find(".js-verify-image").attr("src",i)}}),e.exports=n}),window.Utils=window.Utils||{},$.extend(window.Utils,{validMobile:function(i){return i=""+i,/^((\+86)|(86))?(1)\d{10}$/.test(i)},validPhone:function(i){return i=""+i,/^0[0-9\-]{10,13}$/.test(i)},validNumber:function(i){return/^\d+$/.test(i)},validHKPhone:function(i){return/^(5|6|8|9)\d{7}$/.test(i+"")},validTWPhone:function(i){return/^09\d{2}-?\d{3}-?\d{3}$/.test(i+"")},validEmail:function(i){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(i)},validPostalCode:function(i){return i=""+i,/^\d{6}$/.test(i)}}),define("wap/components/util/valid",function(){}),require(["zenjs/util/ua","zenjs/sms_fetch/main","wap/components/util/valid"],function(i,t){new(Backbone.View.extend({events:{"click .js-auth-code":"onWithdrawClick","click .js-postInfo":"onPostClick"},initialize:function(){var e,o,n=this;i.isMobile?(e="app",o="wsc",i.isWxd()?o="wxd":i.isWsc()?o="wsc":i.isPf()?o="pf":e="wap"):e="pc",n.nAuthCode=this.$(".js-auth-code"),this.sms=new t({el:this.$el,biz:"set_trade_captcha",onTimeChange:function(i){var t=i.second;n.nAuthCode.text("等待 "+t+"秒")},onTimeEnd:function(){n.nAuthCode.text("再次获取"),n.nAuthCode.prop("disabled",!1),n.nAuthCode.removeClass("disabled")},onTimerStart:function(){n.nAuthCode.prop("disabled",!0),n.nAuthCode.addClass("disabled")},onVerifyPictureError:function(){n.nAuthCode.removeAttr("disabled"),n.nAuthCode.removeClass("disabled"),n.nAuthCode.text("再次获取")},onGetCodeError:function(){n.nAuthCode.removeAttr("disabled"),n.nAuthCode.removeClass("disabled"),n.nAuthCode.text("再次获取")},onVerifyPictureShow:function(){motify.log("操作过于频繁，请先输入图像验证码再获取")},platform:e,subFrom:o})},onWithdrawClick:function(i){var t=this,e=$.trim(t.$(".js-mobile").val());if(!window.Utils.validMobile(e))return void motify.log("请填写正确的手机号");this.sms.setMobile(e),this.sms.getSms()},onPostClick:function(){var i=this,t=$.trim(i.$(".js-mobile").val()),e=$.trim(i.$(".js-yzm").val());return window.Utils.validMobile(t)?window.Utils.validPostalCode(e)?void $._ajax({url:"/v2/trade/directseller/wxwallet.json",type:"POST",dataType:"json",data:{sms_captcha:e,sales_id:$('input[name="sales_id"]').val(),openid:$('input[name="openid"]').val(),nickname:$('input[name="nickname"]').val(),headimg:$('input[name="headimg"]').val()},beforeSend:function(){i.$(".js-postInfo").prop("disabled",!0)},success:function(t){0==t.code?window.location.href="/v2/trade/directseller/withdrawaccount":(motify.log(t.msg,3e3),i.$(".js-postInfo").prop("disabled",!1))},error:function(t,e,o){motify.log("获取失败",3e3),i.$(".js-postInfo").prop("disabled",!1)}}):void motify.log("请填写正确的验证码"):void motify.log("请填写正确的手机号")}}))({el:"body"})}),define("main",function(){});