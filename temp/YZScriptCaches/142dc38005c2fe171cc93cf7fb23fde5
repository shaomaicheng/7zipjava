!function(e,t){t("object"==typeof exports&&exports?exports:e.Mustache={})}(this,function(e){function t(e){return"function"==typeof e}function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e,t){return d.call(e,t)}function o(e){return!i(m,e)}function r(e){return String(e).replace(/[&<>"'\/]/g,function(e){return g[e]})}function s(t,i){function r(e){if("string"==typeof e&&(e=e.split(w,2)),!h(e)||2!==e.length)throw new Error("Invalid tags: "+e);s=new RegExp(n(e[0])+"\\s*"),u=new RegExp("\\s*"+n(e[1])),p=new RegExp("\\s*"+n("}"+e[1]))}if(!t)return[];var s,u,p,f=[],d=[],m=[],g=!1,b=!1;r(i||e.tags);for(var x,q,U,j,T,C,E=new c(t);!E.eos();){if(x=E.pos,U=E.scanUntil(s))for(var P=0,$=U.length;$>P;++P)j=U.charAt(P),o(j)?m.push(d.length):b=!0,d.push(["text",j,x,x+1]),x+=1,"\n"===j&&function(){if(g&&!b)for(;m.length;)delete d[m.pop()];else m=[];g=!1,b=!1}();if(!E.scan(s))break;if(g=!0,q=E.scan(k)||"name",E.scan(v),"="===q?(U=E.scanUntil(_),E.scan(_),E.scanUntil(u)):"{"===q?(U=E.scanUntil(p),E.scan(y),E.scanUntil(u),q="&"):U=E.scanUntil(u),!E.scan(u))throw new Error("Unclosed tag at "+E.pos);if(T=[q,U,x,E.pos],d.push(T),"#"===q||"^"===q)f.push(T);else if("/"===q){if(!(C=f.pop()))throw new Error('Unopened section "'+U+'" at '+x);if(C[1]!==U)throw new Error('Unclosed section "'+C[1]+'" at '+x)}else"name"===q||"{"===q||"&"===q?b=!0:"="===q&&r(U)}if(C=f.pop())throw new Error('Unclosed section "'+C[1]+'" at '+E.pos);return l(a(d))}function a(e){for(var t,n,i=[],o=0,r=e.length;r>o;++o)(t=e[o])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(i.push(t),n=t));return i}function l(e){for(var t,n,i=[],o=i,r=[],s=0,a=e.length;a>s;++s)switch(t=e[s],t[0]){case"#":case"^":o.push(t),r.push(t),o=t[4]=[];break;case"/":n=r.pop(),n[5]=t[2],o=r.length>0?r[r.length-1][4]:i;break;default:o.push(t)}return i}function c(e){this.string=e,this.tail=e,this.pos=0}function u(e,t){this.view=null==e?{}:e,this.cache={".":this.view},this.parent=t}function p(){this.cache={}}var f=Object.prototype.toString,h=Array.isArray||function(e){return"[object Array]"===f.call(e)},d=RegExp.prototype.test,m=/\S/,g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},v=/\s*/,w=/\s+/,_=/\s*=/,y=/\s*\}/,k=/#|\^|\/|>|\{|&|=|!/;c.prototype.eos=function(){return""===this.tail},c.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},c.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},u.prototype.push=function(e){return new u(e,this)},u.prototype.lookup=function(e){var n,i=this.cache;if(e in i)n=i[e];else{for(var o,r,s=this;s;){if(e.indexOf(".")>0)for(n=s.view,o=e.split("."),r=0;null!=n&&r<o.length;)n=n[o[r++]];else n=s.view[e];if(null!=n)break;s=s.parent}i[e]=n}return t(n)&&(n=n.call(this.view)),n},p.prototype.clearCache=function(){this.cache={}},p.prototype.parse=function(e,t){var n=this.cache,i=n[e];return null==i&&(i=n[e]=s(e,t)),i},p.prototype.render=function(e,t,n){var i=this.parse(e),o=t instanceof u?t:new u(t);return this.renderTokens(i,o,n,e)},p.prototype.renderTokens=function(n,i,o,r){function s(e){return u.render(e,i,o)}for(var a,l,c="",u=this,p=0,f=n.length;f>p;++p)switch(a=n[p],a[0]){case"#":if(!(l=i.lookup(a[1])))continue;if(h(l))for(var d=0,m=l.length;m>d;++d)c+=this.renderTokens(a[4],i.push(l[d]),o,r);else if("object"==typeof l||"string"==typeof l)c+=this.renderTokens(a[4],i.push(l),o,r);else if(t(l)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");null!=(l=l.call(i.view,r.slice(a[3],a[5]),s))&&(c+=l)}else c+=this.renderTokens(a[4],i,o,r);break;case"^":(!(l=i.lookup(a[1]))||h(l)&&0===l.length)&&(c+=this.renderTokens(a[4],i,o,r));break;case">":if(!o)continue;null!=(l=t(o)?o(a[1]):o[a[1]])&&(c+=this.renderTokens(this.parse(l),i,o,l));break;case"&":null!=(l=i.lookup(a[1]))&&(c+=l);break;case"name":null!=(l=i.lookup(a[1]))&&(c+=e.escape(l));break;case"text":c+=a[1]}return c},e.name="mustache.js",e.version="0.8.1",e.tags=["{{","}}"];var b=new p;e.clearCache=function(){return b.clearCache()},e.parse=function(e,t){return b.parse(e,t)},e.render=function(e,t,n){return b.render(e,t,n)},e.to_html=function(n,i,o,r){var s=e.render(n,i,o);return t(r)?void r(s):s},e.escape=r,e.Scanner=c,e.Context=u,e.Writer=p});var appUtils={};appUtils.updateUrlWithStamp=function(e,t){var t=(t||"t")+"=",n=new RegExp(t+"\\d+"),i=+new Date;if(e.indexOf(t)>-1)return e.replace(n,t+i);if(e.indexOf("?")>-1){var o=e.split("?");return o[1]?o[0]+"?"+t+i+"&"+o[1]:o[0]+"?"+t+i}return e.indexOf("#")>-1?e.split("#")[0]+"?"+t+i+location.hash:e+"?"+t+i},appUtils.preset={errorModal:{content:{html:"糟糕，网络不给力"},confirm:{html:"重新进入",click:function(){window.location.href=appUtils.updateUrlWithStamp(window.location.href)}},cancel:"remove"}},appUtils.modal=function(){function e(){i&&i.remove(),i=$($("#apps-modal-tpl").html()),o={};for(var e in s)o[e]=i.find(".js-apps-modal-"+e)}function t(t){e();var n,i,r;for(n in t)if("string"!=typeof t[n])for(i in t[n])r=o[n][i],$.isFunction(r)&&r.call(o[n],t[n][i]);else"remove"==t[n]&&o[n].remove()}function n(e){return $.extend(!0,{},s,e)}var i,o,r={open:function(e){t(n(e)),$(document.body).append(i)},close:function(e){e===!0?i.find(".apps-modal").remove():i&&i.remove()}},s={content:{html:""},confirm:{html:"确定",click:$.noop},cancel:{html:"取消",click:r.close}};return r}(),appUtils.process=function(){function e(e){s.cancel.html=e,a.cancel.html=e}function t(){return 0!==o?10999==o?(r.open(s),!1):10998==o?(r.open(a),!1):(r.open(c),!1):0===i.costPoint||void 0==i.costPoint||(r.open(l),!1)}var n,i=_apps_global,o=i.errorCode,r=appUtils.modal,s={content:{html:i.errorMsg},confirm:{html:"登录",click:function(){location.href=i.login}},cancel:{html:"取消",click:function(){r.close()}}},a={content:{html:i.errorMsg},confirm:{html:"关注",click:function(){window.showGuide&&window.showGuide("follow")}},cancel:{html:"取消",click:function(e){r.close()}}},l={content:{html:'每次抽奖将消耗<span class="important"> '+i.costPoint+"积分</span>"},confirm:{html:"赌一把",click:function(){r.close(),n.onconfirm&&n.onconfirm()}},cancel:{html:"舍不得",click:function(){r.close()}}};"/v2/apps/shake"==location.pathname&&(l.content.html='每次抽奖将消耗<span class="important"> '+i.costPoint+"积分，确定参加吗？</span>",l.confirm.html="我要参加",l.cancel.html="进店逛逛",l.cancel.click=function(){r.close(),location.href=_apps_global.home_page_url});var c={content:{html:i.errorMsg},confirm:{html:"知道了",click:function(){r.close()}},cancel:"remove"};return n={check:t,setCancelText:e,onconfirm:$.noop}}(),appUtils.atLeast=function(e,t){function n(){r.resolve.apply(null,arguments)}var i,o=!1,r={};return setTimeout(function(){o?t.apply(null,i):r.resolve=function(){t.apply(null,arguments)}},e),r.resolve=function(){i=arguments,o=!0},{resolve:n}},appUtils.randInt=function(e,t){var n=e+Math.random()*(t-e);return parseInt(n,10)},appUtils.format=function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,n){return void 0!==t[n]?t[n]:e})},appUtils.getUrlParam=function(e,t){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i="router"===t?window.location.href:window.location.search,o=i.substr(1).match(n);return null!==o?window.unescape(o[2]):null},function(e,t,n){var i,o=_apps_global,r=t(".apps-guess-stage"),s={life:o.error_num||0,ownPoints:+o.own_points},a=o.alias,l={},c=appUtils.randInt(0,5);void 0==o.questions&&(o.questions={list:[]}),t(".js-template").each(function(){var e=this.id.replace("template-","");l[e]=t(this).html()});var u=function(e,n){var i;return function(){i||(i=t("#template-"+e).html(),i=t(i),n!==!1&&i.on("click",function(){i.remove(),i=null}),t(".apps-game").append(i))}},p=u("pop-gameover",!1),f=function(){var e=t('<div class="question-pop-slide"></div>');return{pop:function(t){e.appendTo(r),e.css("marginTop"),e.addClass("question-pop-slide-down"),e.html(l[t])},close:function(){e.removeClass("question-pop-slide-down")}}}();i=function(){function n(e){var n,i,o,r=w[e],a=r.data,c=r.template;return"string"==typeof a.swer&&(a.swer=a.swer.split("")),i=Mustache.render(l["question-upside"],{index:e+1,content:a.content,image:""==a.image?null:a.image,audio:""==a.audio?null:a.audio,life:s.life,ownPoints:s.ownPoints}),n=Mustache.render(c,a),n=t(n),v.forEach(function(t){t("question",n,a,e)}),o=Mustache.render(l["question-footer"]),t(i).add(n).add(o)}function i(){var e=l.intro;return v.forEach(function(t){t("intro",e)}),e}function h(){var e=g>=w.length?1:0;t._ajax({url:"/v2/apps/crazyguess/crazyguess.json",type:"post",data:{alias:a,seq:1+~~g,error_num:Math.abs(s.life),is_finished:e,id:1}}).then(function(t){0===t.code&&(o.detail_url=t.data.detail_url,e&&d())})}function d(){setTimeout(function(){u("help-finish")()},1e3)}var m,g=+o.question_seq||0,v=[];1==g&&0!=o.is_play&&(g=0),0===o.is_play&&u("cantplay",!1)();var w=o.questions.list.map(function(e){return{template:l["question-type"+e.type],data:e}}),_=function(){var t=["-0","1-5","6-10","11-15","16-"],n=[{title:"博古通今",percent:90},{title:"学富五车",percent:70},{title:"才华横溢",percent:50},{title:"见多识广",percent:30},{title:"奋发图强",percent:10}],i=["你击败了全国"+(90+c)+"%的人，获得“博古通今”称号！你的脑洞略大于宇宙。","你击败了全国"+(70+c)+"%的人，获得“学富五车”称号！天下才气你独占八斗。","你击败了全国"+(50+c)+"%的人，获得“才华横溢”称号！你的未来无可限量！","你击败了全国"+(30+c)+"%的人，获得“见多识广”称号！你的学识已足够过好此生！","你击败了全国"+(10+c)+"%的人，获得“奋发图强”称号！有志者，事竟成！"];return function(){var r,a,u=Math.abs(s.life);t.some(function(e,t){var n=e.split("-").map(function(e){return parseInt(e,10)}),i=!0,o=!0;return isNaN(n[0])||(i=u>=n[0]),isNaN(n[1])||(o=u<=n[1]),i=i&&o,i&&(r=t),i}),a=n[r];var p=e.Mustache.render(l.complete,{levelTitle:a.title,percent:a.percent+c,ownPoints:s.ownPoints,noPrize:0==o.prize_type||1==o.prize_type&&"0"==o.coupon_id||2==o.prize_type&&"0"==o.present_id,present:"0"!=o.present_id&&2==o.prize_type});return e.attachUrl=function(){"0"==o.coupon_id&&"0"==o.present_id?e.location.href=o.detail_url:e.location.href=o.detail_url||_global.url.wap+"/showcase/usercenter?kdt_id="+o.kdt_id},v.forEach(function(e){e("complete",p)}),"function"==typeof e.setShareData&&e.setShareData({title:i[r]}),p}}(),y=function(){t._ajax({url:"/v2/apps/crazyguess/crazyguess.json",type:"post",defaultError:!1,data:{alias:a,seq:~~g,error_num:Math.abs(s.life),is_finished:-1,id:1}})};return m={render:function(){if(t(e).scrollTop(0),0===g){r.html(i());var o,s=t("body").width();return s>640&&(s=640),o=s/640,t(".question-intro-wrap").width(s).height(1143*o),t(".question-intro-btn").css({width:355*o,height:110*o,left:325*o,top:515*o,marginLeft:-355*o/2}),t(".apps-game").css({minHeight:"initial"}),void t(".apps-guess-stage").css({paddingBottom:0})}if(t(".apps-game").css({minHeight:"100%"}),t(".apps-guess-stage").css({paddingBottom:"30px"}),g>w.length)return void r.html(_());var a=n(g-1);r.html(a)},renderPreviewQuestion:function(i,o){t(e).scrollTop(0),w[i]={template:l["question-type"+o.type],data:o};var s=n(i);r.html(s),r.find(".js-question-footer").remove()},to:function(e){g=e,this.render()},next:function(){switch(+o.send_method){case 0:g>0&&g<=w.length&&(s.ownPoints+=+o.point);break;case 1:g==w.length&&(s.ownPoints+=+o.point)}g>0&&h(),g++,m.render()},onRender:function(e){v.push(e)},slide:f,updateError:y,needHelp:u("needhelp"),popGameover:p}}();var h=function(){function e(e){function n(){o.removeClass("question-audio-player-playing"),i.removeEventListener("ended",n)}var i=document.querySelector(".js-audio"),o=t(e.target);o.toggleClass("question-audio-player-playing",i.paused),i.paused?i.play():i.pause(),i.addEventListener("ended",n)}function n(){for(var e in s)r.delegate(".js-"+e,"click",s[e])}var o=u("help"),s={"next-stage":i.next,"play-audio":e,"pop-help":o};return{init:n}}();e.game_stage=i,e.game_player=s,e.gameIns={init:function(){e.game_scenario&&(i.onRender(game_scenario.compile),i.onRender(game_scenario.setUpSharement));var t=appUtils.getUrlParam("_s");t?i.to(t):i.render(),h.init()},partialInit:function(){i.render()},initHelp:function(){var e;t("body").delegate(".js-choose","click",function(){e||(t(".js-pop-help").removeClass("question-animate-flash"),t(".js-join-btn").removeClass("question-animate-flash2"),e=!0,setTimeout(function(){e=!1},1500),t("body").width(),t(".js-pop-help").addClass("question-animate-flash"),t(".js-join-btn").addClass("question-animate-flash2"))})}}}(this,$),window.addEventListener("message",function(e){var t=JSON.parse(e.data);game_stage.renderPreviewQuestion(t.index,t.data),$(".apps-game").css({minHeight:"100%"}),$(".apps-guess-stage").css({paddingBottom:"30px"})},!1),function(e,t,n){function i(e){var n=t(".js-life"),i=n.offset();i.left+=n.width()/2-5,a.life++,n.html(a.life);var o=t('<div class="question-animate-deduct">1</div>').offset(i).appendTo(document.body);if(setTimeout(function(){o.remove()},1e3),1==--e.max_times)return void s.needHelp();e.max_times<=0&&setTimeout(function(){s.updateError(),s.popGameover()},500)}function o(e,n){var i,o,r=t(".question-blank-result-item"),s=new t.Deferred;return 0===r.length?(r=t(".question-choice-list-item").first(),i=r.offset(),i.left=i.left+10,i.top-=15):r.length>4?(r=r.eq(3),i=r.offset(),i.left=i.left+10,i.top+=r.height()+5):(r=r.last(),i=r.offset(),i.left=i.left+r.width()+5,i.top+=r.height()/2-6),o=t('<div class="question-animate-float">'+e+"</div>").addClass(n).offset(i).appendTo(document.body),setTimeout(function(){o.remove()},2e3),setTimeout(function(){s.resolve()},2100),s.promise()}var r=_apps_global,s=e.game_stage,a=e.game_player,l=r.alias,c=function(){function n(e,n){function r(){return f.filter(function(e){return null!=e})}function a(){var e=t(this),i=f.indexOf(null);r().length>=n.swer.length||(i===-1?f.push(e):f.splice(i,1,e),e.hide(),c(),r().length==n.swer.length&&u())}function l(){var e,n=t(this),i=n.index();e=f.splice(i,1,null)[0],e&&e.show(),c()}function c(){e.removeClass("question-blank-result-error"),h.each(function(e){t(this).empty()}),f.forEach(function(e,t){e&&h.eq(t).html(e.html())})}function u(){f.reduce(function(e,n){return e+t(n).html()},"")==n.swer.join("")?(o("答对了","gold").then(s.next),e.undelegate(".js-choose","click",a).undelegate(".js-seleted","click",l)):p()}function p(){e.addClass("question-blank-result-error"),i(n),o("答错咯")}var f=[],h=e.find(".js-seleted");e.delegate(".js-choose","click",a).delegate(".js-seleted","click",l)}function a(e,n){function r(){var i,c,u=t(this);u.data("checked")||(e.find(".js-choose").data("checked",!1),u.data("checked",!0),e.find("."+l).removeClass(l),c=u.parents(".question-choice-list-item"),i=c.index(),i=[].concat(i),i=n.swer.every(function(e,t){return i[t]==e}),i?(u.addClass("question-choice-list-item-checked"),e.undelegate(".js-choose","click",r),o("答对了","gold").then(s.next)):a(c))}function a(e){e.addClass(l),i(n),o("答错咯")}var l="question-choice-list-item-error";e.delegate(".js-choose","click",r)}var c=[n,a];return{compile:function(e,t,n){"question"==e&&c[n.type](t,n)},setUpSharement:function(t,n,i,o){"question"==t?(e.__link=e._global.url.wap+"/apps/guess?alias="+l+"&_s="+(1+~~o),e.__title=r.help_text||i.content,e.__cover=i.image?i.image:null):(e.__link=null,e.__title=null,e.__cover=null)}}}();e.game_scenario=c}(this,$),$(function(){appUtils.process.setCancelText("取消答题"),appUtils.process.check()?gameIns.init():(gameIns.partialInit(),$(".apps-guess-stage").on("click",appUtils.process.check))});