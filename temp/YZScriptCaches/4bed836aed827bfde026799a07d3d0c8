window.Zepto&&function(e){e.fn.serializeArray=function(){var i,t,o=[],n=function(e){if(e.forEach)return e.forEach(n);o.push({name:i,value:e})};return this[0]&&e.each(this[0].elements,function(o,s){t=s.type,i=s.name,i&&"fieldset"!=s.nodeName.toLowerCase()&&!s.disabled&&"submit"!=t&&"reset"!=t&&"button"!=t&&"file"!=t&&("radio"!=t&&"checkbox"!=t||s.checked)&&n(e(s).val())}),o},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(i){e.push(encodeURIComponent(i.name)+"="+encodeURIComponent(i.value))}),e.join("&")},e.fn.submit=function(i){if(0 in arguments)this.bind("submit",i);else if(this.length){var t=e.Event("submit");this.eq(0).trigger(t),t.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),define("vendor/zepto/form",function(){}),window.Utils=window.Utils||{},define("wap/components/util/form",["vendor/zepto/form"],function(e){window.Utils.getFormData=function(e){var i=e.serializeArray(),t={};return $.map(i,function(e){t[e.name]=e.value}),t}}),define("zenjs/sms_fetch/main",["require","exports","module","bower_components/ajax/ajax","zenjs/util/args","jquery"],function(e,i,t){function o(){this.loadingLock=!1,this.isUsed=void 0}function n(e){e=e||{},this.$el=r(e.el||e.$el||"<div></div>"),this.el=this.$el[0],this.$=function(e){return this.$el.find(e)},this.initialize&&this.initialize(e)}e("bower_components/ajax/ajax");var s=e("zenjs/util/args"),r=e("jquery"),a=function(){};o.prototype={fetch:function(){if(this.isUsed!==!1){var e=this;this.loadingLock=!0,r._ajax({url:window._global.url.www.replace(/^https?:\/\//,"//")+"/common/token/token.jsonp",type:"get",dataType:"jsonp"}).done(function(i){0==i.code?(e.token=i.data,e.loadingLock=!1,e.isUsed=!1):motify.log(i.msg)}).fail(function(){motify.log("token 获取失败")})}},get:function(){return this.isUsed=!0,this.token}};var c=new o;r.extend(n.prototype,{initialize:function(e){this.duration=e.time||60,this.step=e.step||1100,this.codeVerifyClass=e.codeVerifyClass||"js-verify-code",this.verifyType="smsFetch";var i=window._global.url.www.replace(/^https?:\/\//,"//");this.smsFetchUrl=i+"/common/sms/captcha.jsonp",this.imgUrl=i+"/common/sms/imgcaptcha",this.imgVerifyUrl=i+"/common/sms/imgcaptcha.jsonp",this.biz=e.biz||"kdt_account_captcha",this.onTimeChange=e.onTimeChange||a,this.onTimeEnd=e.onTimeEnd||a,this.onTimerStart=e.onTimerStart||a,this.onTimerClose=e.onTimerClose||a,this.onVerifyPictureShow=e.onVerifyPictureShow||a,this.onGetCodeError=e.onGetCodeError||a,this.onVerifyPictureSuccess=e.onVerifyPictureSuccess||a,this.onVerifyPictureError=e.onVerifyPictureError||a,this.platform=e.platform||"",this.subFrom=e.subFrom||"",c.fetch()},setMobile:function(e){e&&(this.mobile=e)},getImageCode:function(){return r.trim(this.$("."+this.codeVerifyClass).val())},getSms:function(e){var i=this;if(c.loadingLock)return void motify.log("数据加载中，稍后再试");if(e=e||{},e.mobile&&(this.mobile=e.mobile),!this.mobile)return!1;var t={smsFetch:i.onSmsFetchHandler,image:i.onImageHandler};return i.startTimer.call(i),(t[i.verifyType]||a).call(i),this},startTimer:function(){this.onTimerStart(),this.btnCountdown(this.duration)},stopTimer:function(){clearTimeout(this.timer),this.onTimerClose()},btnCountdown:function(e){var i=this;this.onTimeChange({second:e}),--e>=0?this.timer=setTimeout(function(){i.btnCountdown(e)},this.step):(this.onTimeEnd(),this.timer="")},onVerifyImageShow:function(e){this.$(".js-image-verify").removeClass("hide"),this.$(".js-verify-image").attr("src",e)},onVerifyImageHide:function(){this.$(".js-image-verify").addClass("hide")},onSmsFetchHandler:function(){var e=1;return function(){var i=this,t={verifyTimes:e,mobile:this.mobile,biz:this.biz,token:c.get()};this.platform&&(t.platform=this.platform),this.subFrom&&(t.sub_from=this.subFrom),r._ajax({url:this.smsFetchUrl,dataType:"jsonp",data:t,success:function(t){if(0==t.code)return void e++;i.stopTimer.call(i),i.onGetCodeError.call(i),10111===t.code?(i.verifyType="image",i.onVerifyImageShow(i.imgUrl),i.onVerifyPictureShow()):(e++,motify.log(t.msg))},error:function(t,o,n){e++,i.stopTimer.call(i),i.onGetCodeError.call(i),motify.log("获取验证码失败，请稍后再试")},complete:function(e,i){}}).always(function(){c.fetch()})}}(),onImageHandler:function(){var e=this,i=this.mobile;r._ajax({url:this.imgVerifyUrl,dataType:"jsonp",data:{mobile:i,captcha_code:this.getImageCode()},success:function(t){if(0===t.code)return e.verifyType="smsFetch",e.mobile=i,e.onVerifyImageHide(),e.onVerifyPictureSuccess(),void e.onSmsFetchHandler();e.stopTimer.call(e),e.onVerifyPictureError.call(e),10100===t.code?(motify.log(t.msg),e.reloadCaptcha()):motify.log(t.msg)},error:function(i,t,o){e.stopTimer.call(e),e.onVerifyPictureError.call(e),motify.log("图形验证失败，重试一下吧~"),e.reloadCaptcha()},complete:function(e,i){}})},reloadCaptcha:function(){var e=s.add(this.imgUrl,{stamp:new Date});this.$el.find(".js-verify-image").attr("src",e)}}),t.exports=n}),require(["wap/components/util/form","zenjs/sms_fetch/main","zenjs/util/args","bower_components/youzanjsbridge/api","zenjs/util/ua"],function(e,i,t,o,n){function s(e){return $.each(e,function(i,t){e[i]=$.trim(t)}),e}function r(e){return e.phone?/^1\d{10}$/.test(e.phone)?!!e.code||(l.log("请先填写你的短信验证码"),f.focus(),!1):(l.log("请填写11位手机号码"),u.focus(),!1):(l.log("请先填写你的手机号码"),u.focus(),!1)}function a(e){var i=window._global.url.uic.replace(/^https?:\/\//,"//")+"/buyer/user/updatemaininfo.json";$.ajax({url:i,type:"POST",dataType:"json",data:e,timeout:15e3,xhrFields:{withCredentials:!0},beforeSend:function(){},success:function(i){if(0===i.code){var t=window._global.redirect_url;"wxd"===p||"wsc"===p||"youzanmars"===g?($(".js-change-phone-form").addClass("hide"),$(".js-success-tip").removeClass("hide"),$(".js-goto-login").removeClass("hide")):t?(l.log("修改手机号成功",0),setTimeout(function(){t+=-1===t.indexOf("?")?"?":"&",t+="phone="+e.phone,window.location.href=t},1e3)):($(".js-change-phone-form").addClass("hide"),$(".js-success-tip").removeClass("hide"))}else l.log(i.msg)},error:function(){b.stopTimer(),l.log("获取验证码失败，请稍后再试")},complete:function(){}})}var c=window.Utils,l=window.motify,m=$(".js-send-auth"),u=$(".js-txt-telphone"),f=$(".js-txt-auth"),h=$(".js-login-cancel"),d=$(".js-help-info"),p=t.get("kdtfrom"),g=_global.platform;"wxd"!==p&&"wsc"!==p&&"youzanmars"!==g&&$(".js-login-cancel").removeClass("hide");var y,v;n.isMobile?(y="app",v="wsc",n.isWxd()?v="wxd":n.isWsc()?v="wsc":n.isPf()?v="pf":y="wap"):y="pc";var b=new i({el:$(".js-change-phone-form"),onTimeChange:function(e){var i=e.second;$(m).text("等待 "+i+"秒")},onTimeEnd:function(){m.text("再次获取"),m.prop("disabled",!1),m.removeClass("disabled"),f.attr("placeholder","没有收到验证码？")},onTimerStart:function(){m.prop("disabled",!0),m.addClass("disabled")},onVerifyPictureError:function(){m.prop("disabled",!1),m.removeClass("disabled"),m.text("再次获取")},onGetCodeError:function(){m.prop("disabled",!1),m.removeClass("disabled"),m.text("再次获取")},onVerifyPictureShow:function(){d.html("操作过于频繁，请先输入图像验证码再获取")},biz:"kdt_account_change_mobile",platform:y,subFrom:v});m.on("click",function(e){e.preventDefault();var i=$.trim(u.val());b.setMobile(i),b.getSms()}),h.click(function(){event.preventDefault(),window.history.back()});var w=$(".js-change-phone-form");w.on("submit",function(e){e.preventDefault();var i=c.getFormData(w);i=s(i),r(i)&&a(i)}),$(".js-goto-login").on("click",function(){o.doAction({action:"back"})})}),define("main",function(){});