define("bower_components/imagePreview/views/wx_preview",[],function(){function t(t){var i=t.attr("data-src")||t.attr("src"),e=i.replace(/!.*?\.jpg/i,"!640x320.jpg").replace(/\?imageView2\/.*/i,"!640x320.jpg");return 0===e.indexOf("//")&&(e=window.location.protocol+e),e}function i(t){var i,e=t.closest("a");return!!(e.length&&(i=e.attr("href"))&&/^(http|tel|mailto|#)/i.test(i))}function e(){var i=t($(this));s(i,[i])}var n=[],s=function(t,i){window.WeixinJSBridge&&window.WeixinJSBridge.invoke("imagePreview",{current:t,urls:i})},o={init:function(o){o=o?o:".js-view-image-list";var a=$(o);if(!a.data("swp-preview-init")){a.data("swp-preview-init",!0);$(".js-view-image").each(function(){var e=$(this),o=t(e);i(e)||e.width()>=0&&o&&(n.push(o),e.on("click",function(){s(o,n)}))}),a.each(function(e){var n=$(this);n.on("click","img",function(e){var o=n.find(".js-view-image-item");if(0===o.length&&(o=n.find("img")),!i($(e.target))){o=o.map(function(){return t($(this))}).toArray();var a=t($(this));o.indexOf(a)<0&&(o=[a]),s(a,o)}})}),$(document.body).off("click",".js-view-single-image",e).on("click",".js-view-single-image",e)}},clear:function(){n=[]}};return window.imagePreview=o,o}),define("zenjs/backbone/base_view",["require","backbone","../core/trigger_method"],function(t){var i=t("backbone"),e=t("../core/trigger_method");return i.View.extend({clean:function(){return this.stopListening(),this},triggerMethod:e})}),define("bower_components/zenlist/list",["require","exports","module","zenjs/backbone/base_view"],function(t,i,e){var n=function(){},s=t("zenjs/backbone/base_view");e.exports=s.extend({initialize:function(t){return this.options=t=t||{},this.items=[],this.itemView=t.itemView,this.itemOptions=t.itemOptions||{},this.collection=t.collection,this.onAfterListChange=t.onAfterListChange||n,this.onAfterListLoad=t.onAfterListLoad||n,this.onAfterListDisplay=t.onAfterListDisplay||n,this.onListEmpty=t.onListEmpty||t.onEmptyList||this._onListEmpty,this.onItemClick=t.onItemClick||n,this.onViewItemAdded=t.onViewItemAdded||n,this.displaySize=t.displaySize||-1,this.emptyHTML=t.emptyHTML||"",this.emptyText=t.emptyText||"列表为空",this},render:function(t){return this.displaySize=(t||{}).displaySize==-1?-1:this.displaySize,this.clean(),this._setupListeners(),this.addAll(),this.onAfterListDisplay({list:this.collection}),this},fetchRender:function(t){return this.collection.fetch({data:t,success:_(function(t,i){this.render(),this.onAfterListLoad(this.collection,i),this.onFetchSuccess&&this.onFetchSuccess()}).bind(this),error:_.bind(function(){this.onAfterListLoad(this.collection,response)},this)}),this},_setupListeners:function(){this.collection&&(this.stopListening(this.collection),this.listenTo(this.collection,"add",this.addItem,this),this.listenTo(this.collection,"reset sort",this.render,this),this.listenTo(this.collection,"remove",this.onItemRemoved,this))},addItemListeners:function(t){var i=this;this.listenTo(t,"all",function(){var i="item:"+arguments[0],e=_.toArray(arguments);e.splice(0,1),e.unshift(i,t),this.trigger.apply(this,e),"item:click"==i&&this.onItemClick()}),this.listenTo(t.model,"change",function(){i.onAfterListChange({list:this.collection})})},addAll:function(){0===this.collection.length?this.fetching||this.triggerMethod("list:empty"):this.collection.each(function(t){this.addItem(t)},this)},removeAll:function(){for(var t=this.items.length-1;t>=0;t--)this.removeView(this.items[t]);this.onAfterListChange({list:this.collection})},addItem:function(t,i,e){if(!(this.displaySize>=0&&this.items.length>=this.displaySize)){1==this.collection.length&&(this.listEl||this.$el).html("");var n=new this.itemView(_.extend({},this.options.itemOptions,{model:t,index:this.collection.indexOf(t)}));this.items.push(n),this.addItemListeners(n),n.render(),this.onViewItemAdded({list:this.items,viewItem:n,model:t});return 0===(e||{}).at?(this.listEl||this.$el).prepend(n.el):(this.listEl||this.$el).append(n.el),n}},removeItem:function(t){var i=this.getViewByModel(t);i&&this.removeView(i)},removeView:function(t){var i;this.stopListening(t),t&&(this.stopListening(t.model),t.remove(),i=this.items.indexOf(t),this.items.splice(i,1)),0===this.collection.length&&(this.fetching||this.triggerMethod("list:empty"))},onItemRemoved:function(t){this.onAfterListChange({list:this.collection,action:"remove",model:t}),this.removeItem(t)},getViewByModel:function(t){return _.find(this.items,function(i,e){return i.model===t})},dispatchEventToAllViews:function(t,i){for(var e=this.items.length-1;e>=0;e--)this.items[e].trigger(t,i)},remove:function(){s.prototype.remove.call(this,arguments),this.removeAll(),this.collection.reset(),delete this.collection},clean:function(){s.prototype.clean.call(this,arguments),this.removeAll(),(this.listEl||this.$el).html(""),this.stopListening(this.collection)},_onListEmpty:function(){this.$el.html(this.emptyHTML||(this.emptyText?'<p style="text-align:center;line-height:60px;">'+this.emptyText+"</p>":""))}})}),window.Utils=window.Utils||{},$.extend(window.Utils,{getCdnImageUrl:function(t,i){if(!t)return window._global.url.cdn_static+"/image/wap/no_pic.png";if(i=t.match(/.+\!\d+x\d+.+/)?"":i&&i.length>0?i:"!100x100.jpg",t.match(/^(https?:)?\/\//i)){for(var e=[/^(https?:)?\/\/imgqn.koudaitong.com/,/^(https?:)?\/\/kdt-img.koudaitong.com/,/^(https?:)?\/\/img.yzcdn.cn/,/^(https?:)?\/\/dn-kdt-img.qbox.me/],n=0;n<e.length;n++)t=t.replace(e[n],window._global.url.imgqn);return t+i}return window._global.url.imgqn+"/"+t+i}}),define("wap/components/util/kdt",function(){}),define("text!wap/showcase/offline_shop/templates/infoWindow_content.html",[],function(){return'<div class="infoWindow-content clearfix">\n    <h3><%= name %></h3>\n    <div class="address"><%= address %></div>\n    <div class="navi">\n        <a class="tag">\n            到这里去\n        </a>\n        <div class="js-navi-to navi-to" data-id="<%= id %>" data-address="<%= address %>"></div>\n    </div>\n</div>\n'}),define("wap/showcase/offline_shop/views/map_marker_item",["require","zenjs/util/ua","text!wap/showcase/offline_shop/templates/infoWindow_content.html"],function(t){var i=(t("zenjs/util/ua"),t("text!wap/showcase/offline_shop/templates/infoWindow_content.html"));return Backbone.View.extend({initialize:function(t){this.options=t,this.map=t.map,this.markerClickHandler=_(t.markerClickHandler).bind(this)||function(){},this.markerAdded=!1,this.address=this.model.get("area")+this.model.get("address"),this.lng=this.model.get("lng"),this.lat=this.model.get("lat"),this.lat&&this.lng&&(this.lng=this.lng-.0065,this.lat=this.lat-.006,this.Point=new AMap.LngLat(this.lng,this.lat),this.shopMarker=new AMap.Marker({position:this.Point}),this.infoWindowContentHtml=_.template(i)({address:this.address,name:this.model.get("name"),id:this.model.get("id")}),this.infoWindow=new AMap.InfoWindow({content:this.infoWindowContentHtml,offset:new AMap.Pixel(0,-15)}),AMap.event.addListener(this.shopMarker,"click",_(this.onMarkerClicked).bind(this)))},render:function(){},onMarkerClicked:function(){return this.openInfoWindow(),this.markerClickHandler(this.model),this},showPlaceInMap:function(t){return this.shopMarker&&!this.markerAdded&&(this.shopMarker.setMap(this.map),t&&this.onMarkerClicked(),this.markerAdded=!0),this},openInfoWindow:function(){if(this.infoWindow&&!this.infoWindow.getIsOpen())return this.infoWindow.open(this.map,this.Point),this},getPoint:function(){return this.Point},getMarker:function(){return this.shopMarker}})}),define("text!wap/showcase/offline_shop/templates/offline_shop_detail.html",[],function(){return'<div class="name-card name-card-3col name-card-store clearfix">\n    <div class="thumb js-view-image-list">\n        <% if(image && image.length > 0){ %>\n            <img class="js-view-image-item" src="<%= getCdnImageUrl(image[0]) %>">\n        <% } %>\n    </div>\n    <a href="tel:<%= phone1 + phone2 %>"><div class="phone"></div></a>\n    <div class="detail">\n        <h3>\n            <%= area + address %>\n        </h3>\n\n        <p class="c-gray-dark ellipsis" style="margin-top: 1px">\n        <% \n            var workHour = business_hours_advanced_text || business_hours;\n        %>\n        <% if (workHour) { %>\n            营业时间：<%= workHour %><br>\n        <% } %>\n            电话：<%= phone1 + phone2 %>\n        </p>\n\n    </div>\n</div>\n'}),require(["zenjs/util/ua","bower_components/imagePreview/views/wx_preview","bower_components/zenlist/list","wap/components/util/kdt","wap/showcase/offline_shop/views/map_marker_item","text!wap/showcase/offline_shop/templates/offline_shop_detail.html"],function(t,i,e,n,s,o){function a(t){p.html(f(_.extend(t.toJSON(),{getCdnImageUrl:window.Utils.getCdnImageUrl})))}i.init();var r=$("#js-map");if(r.length){var l=$(window).width(),h=$(window).height();r.width(l).height(h-90);var c=new AMap.Map("js-map");AMap.plugin(["AMap.ToolBar","AMap.Scale"],function(){var t=new AMap.ToolBar,i=new AMap.Scale;c.addControl(t),c.addControl(i)});var d=window._global.shop,m=new Backbone.Collection(window._global.shop_list),p=$("#shop-detail-container"),f=_.template(o),w=new e({itemView:s,collection:m,itemOptions:{map:c,markerClickHandler:a}}).render(),u=function(t){var i=w.getViewByModel(t),e=i.getPoint();if(e)c.setZoomAndCenter(17,e),i.showPlaceInMap(!0);else{var n=t.get("area");c.setCity(n),a(t),motify.log("门店: "+t.get("name")+" 地理位置未指定",-1)}},g=Backbone.Router.extend({routes:{"":"default","id/:id":"openBdMap"},default:function(){var t=m.get(d.id);u(t)},openBdMap:function(i){var e=m.get(i);if(!t.isWeixin()&&window.location.hash){var n=e.get("area")+e.get("address");window.location.href="http://m.amap.com/?k="+n}else u(e)}});new g;Backbone.history.start(),$(".map-container").on("click",".js-navi-to",function(i){var e=$(i.target);t.isWeixin()?(window.location.hash="id/"+e.data("id"),t&&window.showGuide("browser",{isIOS:t.isIOS()})):window.location.href="http://m.amap.com/?k="+e.data("address")}),$("#js-view-all").on("click",function(){var t=!1,i=[];return function(){motify.clear(),t||(_.each(w.items,function(t){var e=t.getMarker();e&&(t.showPlaceInMap(!1),i.push(e))}),t=!0),i.length>0?c.setFitView(i):motify.log("所有门店都未指定地理位置",-1)}}())}}),define("main",function(){});